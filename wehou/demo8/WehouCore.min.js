var WEHOUCORE={};WEHOUCORE.w=480;WEHOUCORE.h=560;WEHOUCORE.time=0;WEHOUCORE.cheat=0;WEHOUCORE.lmpos=new THREE.Vector2(0,-270);WEHOUCORE.bspos=[new THREE.Vector2(0,-350),new THREE.Vector2(0,-350),new THREE.Vector2(0,-350)];WEHOUCORE.bshit=[-1,-1,-1];WEHOUCORE.webgl={};WEHOUCORE.gameover=0;WEHOUCORE.deal={};WEHOUCORE.deal.graze=function(){};WEHOUCORE.deal.hit=function(){WEHOUCORE.gameover=1};WEHOUCORE.deal.cheathit=function(){};WEHOUCORE.deal.hitting=function(){};WEHOUCORE.deal.partend=function(){};WEHOUCORE.musiclistener={enable:true,clock:0};WEHOUCORE.nowstory={};WEHOUCORE.nowboss=[];WEHOUCORE.randomseed=new Date().getTime()%1000000;WEHOUCORE.randomuse=0;WEHOUCORE.imglist=[];WEHOUCORE.regimg=function(a){WEHOUCORE.imglist.push(a);return a};WEHOUCORE.zcount=2;WEHOUCORE.zcounter=function(c,a){if(c){WEHOUCORE.zcount=c}else{WEHOUCORE.zcount+=a?a:1}return WEHOUCORE.zcount};WEHOUCORE.random=function(){var a=WEHOUCORE.randomseed+WEHOUCORE.randomuse*178279;a=(a/1000)*(a%1000);var a=a%1000/1000;WEHOUCORE.randomuse++;if(WEHOUCORE.randomuse>10000){WEHOUCORE.randomuse=0}return a};WEHOUCORE.initcoreenv=function(c){var b=c.clientWidth;var a=c.clientHeight;WEHOUCORE.webgl.renderer=new THREE.WebGLRenderer({antialias:true});WEHOUCORE.webgl.renderer.setSize(b,a);c.appendChild(WEHOUCORE.webgl.renderer.domElement);WEHOUCORE.webgl.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-60000,60000);WEHOUCORE.webgl.scene=new THREE.Scene()};WEHOUCORE.a2a=function(d,b){var c=new THREE.Vector2();c.x=d.x*Math.cos(b)-d.y*Math.sin(b);c.y=d.x*Math.sin(b)+d.y*Math.cos(b);return c};WEHOUCORE.p2p=function(f,e,c,b){if(c<=0){return 0}var a=(f.x-e.x)*(f.x-e.x)+(f.y-e.y)*(f.y-e.y);if(c==9999){return Math.sqrt(a)}else{if(!b&&(a<(c+32)*(c+32))){if(a>c*c){return 2}else{return 1}}if(a>c*c){return 0}else{return 1}}};WEHOUCORE.p2l=function(e,h,g,i,r){var q=WEHOUCORE.p2p(e,h,9999,1),o=WEHOUCORE.p2p(e,g,9999,1),n=WEHOUCORE.p2p(g,h,9999,1),f=0;if(q*q>=o*o+n*n){f=o}else{if(o*o>=q*q+n*n){f=q}else{var t=(q+o+n)/2;t=Math.sqrt(t*(t-q)*(t-o)*(t-n));f=2*t/n}}if(i){if(f>i){if(r&&f<=i+32){return 2}else{return 0}}else{return 1}}else{return f}};WEHOUCORE.mirror=function(e,g,f,d){var n=(f.y-g.y)/(f.x-g.x+1e-7);var h=-1/n;var c=(g.y-e.y-(n*g.x-h*e.x))/(h-n);var i=n*(c-g.x)+g.y;if(d){d.x=2*c-e.x;d.y=2*i-e.y}else{return new THREE.Vector2(2*c-2*e.x,2*i-2*e.y)}};WEHOUCORE.slowmove=[];WEHOUCORE.slowmove[0]=function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e*e+a}return g/2*((e-=2)*e*e+2)+a};WEHOUCORE.slowmove[1]=function(e,a,g,f){return g*e/f+a};WEHOUCORE.slowmove[2]=function(e,a,g,f){return g*((e=e/f-1)*e*e+1)+a};WEHOUCORE.slowmove[3]=function(e,a,h,g,f){if(f==undefined){f=1.70158}return h*((e=e/g-1)*e*((f+1)*e+f)+1)+a};WEHOUCORE.ballTest=function(h,d,c,f){var g=h.ms.position;var a=d.length;var b=false;for(var e=0;e<a;e++){if(!f){if((!d[e].hited)&&WEHOUCORE.p2p(g,d[e].ms.position,c,1)){d[e].hited=1;b=true}}else{if(WEHOUCORE.p2p(g,d[e].ms.position,c,1)){b=true}}}return b};WEHOUCORE.laserTest=function(a,o,q,b){var g=q.length;var h=WEHOUCORE.a2a(new THREE.Vector2(0,-o*a.scale.y+a.geometry.d+20),a.rotation.z);var f=WEHOUCORE.a2a(new THREE.Vector2(0,-a.geometry.d-20),a.rotation.z);var e=new THREE.Vector2(a.position.x+h.x,a.position.y+h.y);var d=new THREE.Vector2(a.position.x+f.x,a.position.y+f.y);var n=false;for(var c=0;c<g;c++){if((!q[c].hited)&&WEHOUCORE.p2l(q[c].ms.position,e,d,3)){q[c].hited=1;q[c].hited_n1=e;q[c].hited_n2=d;n=true}}return n};WEHOUCORE.canvas2mesh=function(c,a,e,d){var b=new THREE.Mesh(new THREE.PlaneGeometry(a||c.width,e||c.height,0,0),new THREE.MeshBasicMaterial({map:new THREE.Texture(c),transparent:true,depthWrite:false,depthTest:false}));b.material.map.needsUpdate=true;return b};WEHOUCORE.imgSet=function(){this.l=new Array()};WEHOUCORE.imgSet.prototype.add=function(q,d,g,a,b,n){for(var e=0;e<q.length;e++){WEHOUCORE.imglist.push(q[e]);var f=THREE.ImageUtils.loadTexture(q[e]);if(a){f.minFilter=THREE.NearestFilter}if(b){var h=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(q[e])})}else{var h=new THREE.ShaderMaterial({uniforms:n?(function(){n.uniforms.texture1={type:"t",value:f};return n.uniforms})():{texture1:{type:"t",value:f}},vertexShader:n?n.vert:"varying vec2 vUv;varying float alphas;void main(){	vUv=uv;	mat4 mv=modelMatrix;	alphas=mv[2][2];	if(mv[0][2]>0.0){		vUv.x=vUv.x+mv[0][2]*floor(mv[2][0]);		vUv.y=vUv.y-mv[0][2]*floor(mv[2][1]);	}else if(mv[0][2]<0.0){		vUv.x=fract(mv[2][0])+fract(mv[2][1])-vUv.x;		vUv.x=vUv.x-mv[0][2]*floor(mv[2][0]);		vUv.y=vUv.y+mv[0][2]*floor(mv[2][1]);	}	mv[0][2]=0.0;	mv[2][0]=0.0;	mv[2][1]=0.0;	gl_Position=projectionMatrix*mv*vec4(position,1.0);}",fragmentShader:n?n.frag:"uniform sampler2D texture1;varying vec2 vUv;varying float alphas;void main(){	vec2 uv=vUv;	vec4 fc=texture2D(texture1,uv);	fc[3]=fc[3]*alphas;	gl_FragColor=fc;}"})}h.transparent=true;if(d==1){h.blending=THREE.AdditiveBlending}else{if(d==2){h.blending=THREE.SubtractiveBlending}}var o=new Array();o.push(h);this.l.push(h)}};WEHOUCORE.shaderSet=function(){this.l=new Array()};WEHOUCORE.shaderSet.prototype.add=function(d,a,c){var b=new THREE.ShaderMaterial(d);b.transparent=true;if(c){b.blending=THREE.AdditiveBlending}if(a){b.action=a}this.l.push(b);return this.l.length-1};WEHOUCORE.shaderSet.prototype.deal=function(){for(var a=0;a<this.l.length;a++){if(this.l[a].action){this.l[a].action(this.l[a].uniforms)}}};WEHOUCORE.planeSet=function(){this.l=new Array()};WEHOUCORE.planeSet.prototype.add=function(b,e,c,f){var g=new THREE.PlaneGeometry(b,e,0,0);if(f){if(f.d){g.d=f.d}g.cut=[0,1];if(f.cut&&f.cut.length==4){g.cut=[f.cut[1],f.cut[0]-f.cut[1]];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][1].u=f.cut[0];g.faceVertexUvs[0][0][2].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][3].v=f.cut[2];g.faceVertexUvs[0][0][1].v=g.faceVertexUvs[0][0][2].v=f.cut[3];if(f.rt){g.faceVertexUvs[0][0][1].u=g.faceVertexUvs[0][0][2].u=f.cut[0];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][1].v=f.cut[2];g.faceVertexUvs[0][0][2].v=g.faceVertexUvs[0][0][3].v=f.cut[3]}}if(f.end&&f.end!=0){g.vertices[2].y-=g.vertices[0].y;g.vertices[0].y=0;g.vertices[3].y-=g.vertices[1].y;g.vertices[1].y=0}if(f.rep!=1){var a=0;if(f.rep>8){f.rep/=3;a=1}g.rep=[f.rep,Math.abs(f.cut[0]-f.cut[1]),a,f.cut[0],f.cut[1]]}}var d=new THREE.Mesh(g,c);this.l.push(d);return this.l.length-1};WEHOUCORE.bberSet=function(){this.l=new Array()};WEHOUCORE.bberSet.prototype.add=function(b,a){var c=a||1;this.l.push(new WEHOUCORE["Bb"+c](this,b))};WEHOUCORE.lineSet=function(a,b){this.l=new Array();this.bl=b;this.bl.parent=this;this.st=new Array();this.ms=a.mesh||null;this.delms=(a.delmesh==undefined)?true:a.delmesh;if(this.ms==null){this.delms=false}this.slx=a.slowx||0;this.sly=a.slowy||0;this.hit=(a.hit==undefined)?99999:a.hit;this.hit_dis=(a.hit_dis==undefined)?60:a.hit_dis;this.k_dis=a.kick_dis||0;if(!this.ms){this.ms={};this.ms.position=new THREE.Vector2()}this.times=0;this.alltimes=0;this.player=a.player||"act";this.lt=new THREE.Vector2();this.eve=a.reload||[];this.l_fun=a.loopfunction||null};WEHOUCORE.lineSet.prototype.addline=function(a){this.l=this.l.concat(a)};WEHOUCORE.lineSet.prototype.addst=function(a){this.st=this.st.concat(a)};WEHOUCORE.lineSet.prototype.gogogo=function(g,e){if(this.alltimes&&(this.alltimes==this.l[this.l.length-1])){this.st=[[]];this.l=[0,new THREE.Vector2(-9998,-9998),new THREE.Vector2(0,0),50,new THREE.Vector2(-500,400),new THREE.Vector2(0,0),0];this.t=null;this.times=0}for(var c=0;c<this.eve.length;c++){if(this.eve[c][0]=="h"?this.ms.hit<this.eve[c][1]:this.eve[c][0]=="t"?this.alltimes>=this.eve[c][1]:0){if(typeof this.eve[c][2]=="function"){this.eve[c][2](this)}else{this.st=this.eve[c][2]}this.eve[c][1]=this.eve[c][0]=="h"?-1000:100000}}var f=0,d=0,o=0;if(e){for(var c=3;c<this.l.length-2;c+=3){if(this.times>=this.l[c-3]&&this.times<this.l[c]){o=c;if(this.times==this.l[c-3]){this.t=this.t||new THREE.Vector2(this.l[1].x==-9998?this.ms.position.x:this.l[1].x,this.l[1].y==-9998?this.ms.position.y:this.l[1].y);this.lt.x=this.t.x;this.lt.y=this.t.y;this.t.x=(this.l[c+1].x==-9999)?((Math.abs(WEHOUCORE.lmpos.x)<=(WEHOUCORE.w/2-80))?WEHOUCORE.lmpos.x:Math.abs(WEHOUCORE.lmpos.x)/WEHOUCORE.lmpos.x*(WEHOUCORE.w/2-80)):(this.l[c+1].x==-9998)?this.lt.x:this.l[c+1].x;this.t.y=(this.l[c+1].y==-9999)?((Math.abs(WEHOUCORE.lmpos.y)<=(WEHOUCORE.h/2-80))?WEHOUCORE.lmpos.y:Math.abs(WEHOUCORE.lmpos.y)/WEHOUCORE.lmpos.y*(WEHOUCORE.h/2-80)):(this.l[c+1].y==-9998)?this.lt.y:this.l[c+1].y;if(this.l[c+2]){this.t.x+=-WEHOUCORE.random()*(this.l[c+2].x+5)+this.l[c+2].x/2;this.t.y+=-WEHOUCORE.random()*(this.l[c+2].y+5)+this.l[c+2].y/2}}var q=this.st[(c-3)/3];var n=(typeof this.slx==="function")?this.slx(this.times-this.l[c-3],this.lt.x,this.t.x-this.lt.x,this.l[c]-this.l[c-3]):WEHOUCORE.slowmove[this.slx](this.times-this.l[c-3],this.lt.x,this.t.x-this.lt.x,this.l[c]-this.l[c-3]);var h=(typeof this.sly==="function")?this.sly(this.times-this.l[c-3],this.lt.y,this.t.y-this.lt.y,this.l[c]-this.l[c-3]):WEHOUCORE.slowmove[this.sly](this.times-this.l[c-3],this.lt.y,this.t.y-this.lt.y,this.l[c]-this.l[c-3]);f=n-this.ms.position.x;d=h-this.ms.position.y;this.ms.position.set(n,h,WEHOUCORE.zcounter(0,1000));WEHOUCORE.bspos[g].x=n;WEHOUCORE.bspos[g].y=h;for(var b=0;b<q.length;b++){this.bl.l[q[b]].p.x=this.bl.l[q[b]].pl?this.bl.l[q[b]].gp.x+n:(this.bl.l[q[b]].gp.x>10000?this.bl.l[q[b]].gp.x-20000+WEHOUCORE.lmpos.x:this.bl.l[q[b]].gp.x);this.bl.l[q[b]].p.y=this.bl.l[q[b]].pl?this.bl.l[q[b]].gp.y+h:(this.bl.l[q[b]].gp.y>10000?this.bl.l[q[b]].gp.y-20000+WEHOUCORE.lmpos.y:this.bl.l[q[b]].gp.y);this.bl.l[q[b]].bread()}break}}}for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].going(g*50+a+2)}if(this.k_dis&&WEHOUCORE.p2p(WEHOUCORE.bspos[g],WEHOUCORE.lmpos,this.k_dis,1)){WEHOUCORE.deal.hit()}if(this.ms[this.player]){this.ms.deal(this.alltimes,f,d,n,h);this.ms[this.player](this.alltimes)}this.times++;this.alltimes++;if(this.times>this.l[this.l.length-4]){this.times=0;if(this.l_fun){this.l_fun(this,o)}}};WEHOUCORE.lineSet.prototype.show=function(){if(this.ms){WEHOUCORE.webgl.scene.add(this.ms);this.ms.hit=this.hit;this.ms.hit_dis=this.hit_dis;if(this.ms.hit){WEHOUCORE.nowstory.self.addHiter(this.ms)}else{WEHOUCORE.nowstory.self.delHiter(this.ms)}}};WEHOUCORE.lineSet.prototype.clear=function(b){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clear(this.ms.position,800,b)}};WEHOUCORE.lineSet.prototype.clean=function(){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clean()}if(this.delms){WEHOUCORE.webgl.scene.remove(this.ms);if(this.ms.hit){WEHOUCORE.nowstory.self.delHiter(this.ms)}this.ms.clear();this.ms.deallocate()}};WEHOUCORE.selfSet=function(){this.l=new Array();this.share=new Array();this.hitlist=[];WEHOUCORE.nowstory.self=this};WEHOUCORE.selfSet.prototype.add=function(c){var a=new WEHOUCORE.bberSet();for(var b=0;b<c.length;b++){a.add(c[b])}this.l.push(a)};WEHOUCORE.selfSet.prototype.addShared=function(c){var a=new WEHOUCORE.bberSet();for(var b=0;b<c.length;b++){a.add(c[b])}this.share.push(a)};WEHOUCORE.selfSet.prototype.addHiter=function(a){this.hitlist.push(a)};WEHOUCORE.selfSet.prototype.delHiter=function(b){var a=this.hitlist.indexOf(b);if(a!==-1){this.hitlist.splice(a,1)}};WEHOUCORE.selfSet.prototype.isPower=0;WEHOUCORE.selfSet.prototype.isSlow=false;WEHOUCORE.selfSet.prototype.isPress=false;WEHOUCORE.selfSet.prototype.runGroup=function(){if(this.isPress){var c=this.l[this.isPower*2+(this.isSlow?1:0)];for(var a=0;a<c.l.length;a++){c.l[a].p.x=c.l[a].gp.x+WEHOUCORE.lmpos.x;c.l[a].p.y=c.l[a].gp.y+WEHOUCORE.lmpos.y;c.l[a].bread()}c=this.share[0];if(c!=null){for(var a=0;a<c.l.length;a++){c.l[a].p.x=c.l[a].gp.x+WEHOUCORE.lmpos.x;c.l[a].p.y=c.l[a].gp.y+WEHOUCORE.lmpos.y;c.l[a].bread()}}}for(var b=0;b<this.l.length;b++){var c=this.l[b];for(var a=0;a<c.l.length;a++){c.l[a].going(1)}}var c=this.share[0];for(var a=0;a<c.l.length;a++){c.l[a].going(1)}};WEHOUCORE.effectSet=function(){this.l=new WEHOUCORE.bberSet();this.pushlist=[];WEHOUCORE.nowstory.effect=this};WEHOUCORE.effectSet.prototype.add=function(b){for(var a=0;a<b.length;a++){this.l.add(b[a],2)}};WEHOUCORE.effectSet.prototype.push=function(b,a){this.pushlist.push([b,a.x,a.y])};WEHOUCORE.effectSet.prototype.runGroup=function(){var b=this.l;for(var a=0;a<this.pushlist.length;a++){var c=this.pushlist[a][0];b.l[c].p.x=this.pushlist[a][1];b.l[c].p.y=this.pushlist[a][2];b.l[c].ot=0;b.l[c].bread()}for(var a=0;a<b.l.length;a++){b.l[a].going(1)}this.pushlist=[]};WEHOUCORE.itemSet=function(){this.l=new WEHOUCORE.bberSet();this.autoy_base=100;this.autoy=this.autoy_base;this.pushlist=[];WEHOUCORE.nowstory.item=this};WEHOUCORE.itemSet.prototype.add=function(b){for(var a=0;a<b.length;a++){this.l.add(b[a],3)}};WEHOUCORE.itemSet.prototype.push=function(b){for(var a=0;a<b.length;a++){this.pushlist.push(b[a])}};WEHOUCORE.itemSet.prototype.runGroup=function(){var b=this.l;for(var a=0;a<this.pushlist.length;a++){var c=this.pushlist[a][0];b.l[c].p.x=this.pushlist[a][1];b.l[c].p.y=this.pushlist[a][2];b.l[c].num=this.pushlist[a][3];b.l[c].ds=this.pushlist[a][4];b.l[c].bread()}for(var a=0;a<b.l.length;a++){b.l[a].going(WEHOUCORE.lmpos.y>this.autoy?1:0)}this.pushlist=[]};WEHOUCORE.storySet=function(a){this.name=a;this.l=new Array();this.s=new Array();this.t=0;this.at=0;this.p=0;this.self=new WEHOUCORE.selfSet();this.effect=new WEHOUCORE.effectSet();this.item=new WEHOUCORE.itemSet();WEHOUCORE.nowstory=this};WEHOUCORE.storySet.prototype.setName=function(a){this.name=a};WEHOUCORE.storySet.prototype.add=function(g,f,e,d){var b=new WEHOUCORE.bberSet();for(var c=0;c<f.length;c++){b.add(f[c])}var a=new WEHOUCORE.lineSet(g,b);a.addline(e);a.addst(d);this.l.push(a);return this.l.length-1};WEHOUCORE.storySet.prototype.adds=function(a){this.s.push(a)};WEHOUCORE.storySet.prototype.actlist=new Array();WEHOUCORE.storySet.prototype.deal=function(){WEHOUCORE.zcounter(2);var c=this.s[this.p];var b=c.time;if(c.group){for(var a=0;a<c.group.length;a++){var d=this.l[c.group[a]];if(this.t==0){d.show();d.gogogo(a,true)}else{if(this.t==b-1){d.clean();WEHOUCORE.deal.partend();WEHOUGAME.slowtime=1;WEHOUCORE.bshit[a]=-2}else{if(this.t>=b-30){if(c.circleclear){d.clear(1-(b-this.t)/30);WEHOUGAME.slowtime=4;WEHOUGAME.mainstory.effect.push(1,WEHOUCORE.bspos[0])}else{d.clear(2);if(c.timeenditem){for(var e=0;e<c.timeenditem.length;e++){WEHOUCORE.nowstory.item.push([[c.timeenditem[e][0],0,0,c.timeenditem[e][1],c.timeenditem[e][2]]])}c.timeenditem=null}}d.gogogo(a,false);WEHOUCORE.bshit[a]=-1}else{d.gogogo(a,true);if((!c.bt)&&d.ms&&d.ms.hit_dis){WEHOUCORE.bshit[a]=d.ms.hit/d.hit;if(d.ms.hit<=0){d.ms.hit=d.hit;if(c.enditem){for(var e=0;e<c.enditem.length;e++){WEHOUCORE.nowstory.item.push([[c.enditem[e][0],d.ms.position.x,d.ms.position.y,c.enditem[e][1],c.enditem[e][2]]])}}this.storyCT("jumpnext");WEHOUCORE.bshit[a]=-3}}}}}}}this.self.runGroup();this.effect.runGroup();this.item.runGroup();if(c.act){for(var a=0;a<c.act.length;a+=2){if(c.act[a]==9999){WEHOUCORE.lmpos.x=9999;WEHOUCORE.gameover=1}else{this.actlist[c.act[a]](c.act[a+1],this.at,c.time-30)}}}if(c.listener){if(WEHOUCORE.musiclistener.enable){if(this.t<=b-30&&c.listener.music){if(c.listener.music[0]&&c.listener.music[0].currentTime>=c.listener.music[1]-0.5){WEHOUCORE.musiclistener.clock=1;this.storyCT("jumpnext")}}}else{if(WEHOUCORE.musiclistener.clock){WEHOUCORE.musiclistener.clock=0;this.storyCT("jumpnext")}}}if(this.at<c.time){this.at++}if(!c.statics){this.t++}else{this.t=1}if(this.t==b){this.p++;this.t=0;this.at=0}};WEHOUCORE.storySet.prototype.storyCT=function(a){if(a=="jumpnext"){this.at=this.t=this.s[this.p].time-30;this.s[this.p].statics=false}};WEHOUCORE.Ball=function(q,n,h,f,g,e,d,c,o,i){this.ms=q;this.ms.addMatrix=new THREE.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(this.ms.geometry&&this.ms.geometry.rep){this.ms.adsta=0}this.bp=new THREE.Vector2(this.ms.position.x,this.ms.position.y);this.t=new THREE.Vector2(n.x-this.bp.x,n.y-this.bp.y);var b=Math.sqrt((this.t.x)*(this.t.x)+(this.t.y)*(this.t.y));this.t.x=(this.t.x)*this.tdis/b+this.bp.x;this.t.y=(this.t.y)*this.tdis/b+this.bp.y;this.v=h;this.va=f;this.a=g;this.btime=0;this.bb=e||[];this.gz=0;this.alpha=d||1;this.valpha=c||0;this.vsize=i||new THREE.Vector2(0,0);if(o){this.ms.scale.x=o.x;this.ms.scale.y=o.y}};WEHOUCORE.Ball.prototype.tdis=3600;WEHOUCORE.Bb1=function(b,c){this.parent=b;this.type=c.type||"ball";this.motion=c.motion||"normal";if(this.type=="line"){this.lmat=c.linematerial||null;this.cut=c.materialcut||[0,1];this.llong=c.linelong||50;this.ms=null;this.aptime=c.appeartime||0}else{if(this.type=="laser"){this.ms=c.mesh||null;this.msm=c.meshget||"random";var a=this.ms.geometry?this.ms.geometry:this.ms[0].geometry;this.longl=Math.abs(a.vertices[2].y);this.shortl=Math.abs(a.vertices[0].x)*2;this.att=(c.appearline==undefined)?30:c.appearline;if(this.att<=10){this.att=0}this.rnum=c.numberrandom||0;this.rat=1}else{this.ms=c.mesh||null;this.msm=c.meshget||"random";this.rnum=c.numberrandom||0;this.rat=(c.rotating==undefined)?1:c.rotating;this.outer=c.outfield||false;this.aptime=c.appeartime||0;if(this.type=="self"){this.dmg=c.damage;this.islaser=c.likelaser||0;if(this.islaser){var a=this.ms.geometry?this.ms.geometry:this.ms[0].geometry;this.longl=Math.abs(a.vertices[2].y);this.shortl=Math.abs(a.vertices[0].x)*2}}else{if(this.type=="enemy"){this.hit=c.hitblood||40;this.hit_dis=c.hitdistance||20;this.item=c.item||[]}}}}if(this.motion!="mesh"){this.gp=c.position||new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.rp=c.positionrandom||new THREE.Vector2(0,0);this.p_fun=c.positionfunction||0;this.pl=(c.positionlock===undefined)?true:c.positionlock;this.v=c.speed||[3];this.ve=c.speedchange||[0,0];this.rv=c.speedrandom||0;this.t=c.target||WEHOUCORE.lmpos;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}this.rt=c.targetrandom||0;if(this.motion=="normal"){this.m_v_f=c.mspeedfunction||0;this.va=c.palstance||[0];this.m_va_f=c.mpalstancefunction||0;this.a=c.acceleration||[0];this.m_a_f=c.maccelerationfunction||0;this.rva=c.palstancerandom||0;this.rvauto=c.autopalstance||false;this.fout=c.faceout||false}else{if(this.motion=="gravity"){this.g=c.gravity||new THREE.Vector2(0,-0.03);this.f=c.decay||new THREE.Vector2(0.7,0.8)}}this.num=c.number||1;this.ne=c.numberchange||[0,0];this.angle=c.angle||[-360];this.angle_fun=c.anglefunction||0;this.aoff=c.angleoffset||0;this.ae=c.anglechange||[0,0];this.ae2=c.anglesizechange||[0,0];this.rangle=c.anglerandom||0;this.tangle=c.anglefactor||[];this.aall=[0,0,0,0,0];this.ds=c.distance||0}else{this.gp=new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.pl=true;this.vert=c.vert||[];this.num=this.vert.length;this.docopy=c.vertcopy===undefined?true:c.vertcopy;if(!this.vert[0].w){this.docopy=true}if(this.docopy){for(k=0;k<this.num;k++){this.vert[k]=new THREE.Vector4(this.vert[k].x,this.vert[k].y,this.vert[k].z,1)}}this.bk=c.goback||0;this.fout=c.faceout||false;if(c.setmove){this.setmove=c.setmove}if(c.setrotate){this.setrotate=c.setrotate}if(c.setsize){this.setsize=c.setsize}if(c.setmoverandom){this.rsetmove=c.setmoverandom}if(c.setrotaterandom){this.rsetrotate=c.setrotaterandom}if(c.setsizerandom){this.rsetsize=c.setsizerandom}this.meshv=c.meshmove||new THREE.Vector3(0,0,0);this.meshr=c.meshrotate||new THREE.Vector3(0,0,0);this.meshs=c.meshsize||new THREE.Vector3(1,1,1);this.tmat4=new THREE.Matrix4();this.tmat4.setPosition(this.meshv);this.tmat4.setRotationFromEuler(this.meshr,THREE.Object3D.defaultEulerOrder);this.tmat4.scale(this.meshs)}this.vsize=c.sizespeed||0;this.alpha_fun=c.alphafun||null;this.m_fun=c.ballfunction||new THREE.Vector2(0,0);this.lock=c.locked||false;if(this.lock){this.changep=new THREE.Vector2(0,0)}this.bt=c.lifetime||300;this.time=c.period||30;this.dwf=c.diewithfather||false;this.protect=c.protect||false;this.cstable=c.cloudprotect==undefined?true:c.cloudprotect;this.ot=0;this.toff=c.timeoffset||0;this.ballbox=new Array();this.event=c.bulletevents||[];this.myeve=c.myevents||[];this.myeve2=c.mybulevents||[];this.deve=c.dieevents||[];this.se=c.birthse||0;this.secount=0;this.sep=c.seperiod||1;this.bplay=c.bossplay||["",0]};WEHOUCORE.Bb1.prototype.bread=function(x){var y;if((this.ot-this.toff>=0)&&(this.ot-this.toff)%this.time==0){if(this.se&&WEHOUCORE.nowstory.seplay&&this.secount%this.sep==0){WEHOUCORE.nowstory.seplay(this.se-1)}this.secount++;this.bplay[0]&&WEHOUGAME.playBoss(this.bplay[1]?this.bplay[1]:0,this.bplay[0]);if(this.motion!="mesh"){var e=new THREE.Vector2();e.x=this.t.x;e.y=this.t.y;if(e.x==30000){e.x=this.parentball.t.x}if(e.y==30000){e.y=this.parentball.t.y}e.sub(e,this.p);if(Math.abs(e.x)<2&&Math.abs(e.y)<2){e.y=-100}var u=this.num+(this.rnum?-Math.floor(WEHOUCORE.random()*this.rnum):0)+Math.floor(this.aall[2]);var t=(this.rp.x>0),n;if(!t&&this.rp.x){n=-WEHOUCORE.random()*this.rp.x+this.rp.x/2}var r=(this.rp.x>0),h;if(!r&&this.rp.y){h=-WEHOUCORE.random()*this.rp.y+this.rp.y/2}}else{u=this.num}for(var y=0;y<u;y++){if(this.ms){if(!this.ms.position){if(this.msm=="linear"){var c=this.ms[y%this.ms.length].clone()}else{var D=Math.floor(WEHOUCORE.random()*this.ms.length);var c=this.ms[D].clone()}}else{var c=this.ms.clone()}}else{var c=new Object();c.position=new Object()}if(this.type=="enemy"){c.hit=this.hit;c.hit_dis=this.hit_dis;WEHOUCORE.nowstory.self.addHiter(c)}if(this.motion!="mesh"){c.position.x=this.p.x+(this.rp.x?(t?(WEHOUCORE.random()*this.rp.x-this.rp.x/2):n):0);c.position.y=this.p.y+(this.rp.y?(r?(WEHOUCORE.random()*this.rp.y-this.rp.y/2):h):0);if(this.p_fun){this.p_fun(this,y,c.position)}c.position.z=2;if(e.x>=10000){e.x=c.position.x+e.x-20000}if(e.y>=10000){e.y=c.position.y+e.y-20000}var a=0,C;if(this.angle.length==1&&this.angle[0]<0){C=[(-this.angle[0])/u]}else{C=this.angle}if(u%2==1){if(y==(u-1)/2){a=0}else{if(y<(u-1)/2){for(j=y;j<(u-1)/2;j++){a+=(C[j]===undefined?C[0]:C[j])+this.aall[3]}}else{if(y>(u-1)/2){for(j=y-1;j>(u-1)/2-1;j--){a-=(C[j]===undefined?C[0]:C[j])+this.aall[3]}}}}}else{if(y<u/2){for(j=y;j<=u/2-1;j++){a+=(C[j]===undefined?C[0]:C[j])+this.aall[3];if(j==u/2-1){a-=((C[j]===undefined?C[0]:C[j])+this.aall[3])/2}}}else{if(y>=u/2){for(j=y-1;j>=u/2-1;j--){a-=(C[j]===undefined?C[0]:C[j])+this.aall[3];if(j==u/2-1){a+=((C[j]===undefined?C[0]:C[j])+this.aall[3])/2}}}}}a+=this.rangle?Math.floor(WEHOUCORE.random()*this.rangle-this.rangle/2):0;a+=this.aall[0];a+=this.aoff;if(this.tangle.length){a+=Math.sin(WEHOUCORE.time/this.tangle[0])*this.tangle[1]}if(this.angle_fun){a=this.angle_fun(this,y,a)}var B=WEHOUCORE.a2a(e,a/180*Math.PI);this.rt?B.add(B,new THREE.Vector2(WEHOUCORE.random()*this.rt-this.rt/2,WEHOUCORE.random()*this.rt-this.rt/2)):0}else{c.position.x=this.vert[y].x;c.position.y=this.vert[y].y;c.position.z=2}if(this.rat>2&&this.ms){c.rotation.z=WEHOUCORE.random()*Math.PI*2}if(this.motion=="normal"){B.add(B,this.p);var f=new WEHOUCORE.Ball(c,B,this.v[0]==30000?(this.parentball.v):(this.v[y]||this.v[0])+this.aall[1]+(this.rv?(WEHOUCORE.random()*this.rv-this.rv/2):0),(this.va[y]||this.va[0])+(this.rva?(WEHOUCORE.random()*this.rva-this.rva/2):0),this.a[y]||this.a[0],0,0,0,0,new THREE.Vector2(this.vsize,this.vsize))}else{if(this.motion=="gravity"){var g=this.v[0]==30000?(this.parentball.v):(this.v[y]||this.v[0])+this.aall[1]+(this.rv?(WEHOUCORE.random()*this.rv-this.rv/2):0);var s=Math.sqrt(B.x*B.x+B.y*B.y);var f=new WEHOUCORE.Ball(c,B,new THREE.Vector2(B.x*g/s,B.y*g/s),0,new THREE.Vector2(this.g.x,this.g.y),0,0,0,0,new THREE.Vector2(this.vsize,this.vsize))}else{if(this.motion=="mesh"){var A=new THREE.Matrix4(),d=false;if(this.rsetmove||this.setmove){var z=new THREE.Vector3(0,0,0);if(this.rsetmove){z.x+=WEHOUCORE.random()*this.rsetmove.x;z.y+=WEHOUCORE.random()*this.rsetmove.y;z.z+=WEHOUCORE.random()*this.rsetmove.z}if(this.setmove){z.x+=this.setmove.x;z.y+=this.setmove.y;z.z+=this.setmove.z}A.setPosition(z);d=true}if(this.rsetrotate||this.setrotate){var z=new THREE.Vector3(0,0,0);if(this.rsetrotate){z.x+=WEHOUCORE.random()*this.rsetrotate.x;z.y+=WEHOUCORE.random()*this.rsetrotate.y;z.z+=WEHOUCORE.random()*this.rsetrotate.z}if(this.setrotate){z.x+=this.setrotate.x;z.y+=this.setrotate.y;z.z+=this.setrotate.z}A.setRotationFromEuler(z,THREE.Object3D.defaultEulerOrder);d=true}if(this.rsetsize||this.setsize){var z=new THREE.Vector3(0,0,0);if(this.rsetsize){z.x+=WEHOUCORE.random()*this.rsetsize.x;z.y+=WEHOUCORE.random()*this.rsetsize.y;z.z+=WEHOUCORE.random()*this.rsetsize.z}if(this.setsize){z.x+=this.setsize.x;z.y+=this.setsize.y;z.z+=this.setsize.z}A.scale(z);d=true}var q=this.vert[y].clone();if(d){q=A.multiplyVector4(q)}var f=new WEHOUCORE.Ball(c,new THREE.Vector2(0,0),this.tmat4,0,q,0,0,0,0,new THREE.Vector2(this.vsize,this.vsize))}}}if(this.motion=="function"){var f=new WEHOUCORE.Ball(c,B,0,0,0)}if(this.type=="line"){var b=new THREE.PlaneGeometry(1,1,0,this.llong-1);for(m=0;m<this.llong*2;m++){b.vertices[m].x=f.bp.x;b.vertices[m].y=f.bp.y}for(m=0;m<this.llong-1;m++){var o=b.faceVertexUvs[0][m];for(p=0;p<2;p++){o[p].u=o[p].v;o[p].v=this.cut[0]}for(p=2;p<4;p++){o[p].u=o[p].v;o[p].v=this.cut[1]}}f.lms=new THREE.Mesh(b,this.lmat);f.lms.position.z=20;f.lms.geometry.uvsNeedUpdate=true;f.lms.geometry.verticesNeedUpdate=true;f.lms.geometry.dynamic=true;WEHOUCORE.webgl.scene.add(f.lms)}if(this.lock){f.lockp=new THREE.Vector2(this.p.x,this.p.y);f.changp=new THREE.Vector2(0,0)}if(this.parentball){f.parentball=this.parentball}this.ballbox.push(f);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}if(this.motion!="mesh"){this.aall[0]+=this.ae[0];if((this.ae[0]>0&&this.aall[0]>this.ae[1])||(this.ae[0]<0&&this.aall[0]<this.ae[1])){this.aall[0]=0}this.aall[1]+=this.ve[0];if((this.ve[0]>0&&this.aall[1]>this.ve[1])||(this.ve[0]<0&&this.aall[1]<this.ve[1])){this.aall[1]=0}this.aall[2]+=this.ne[0];if((this.ne[0]>0&&this.aall[2]>this.ne[1])||(this.ne[0]<0&&this.aall[2]<this.ne[1])){this.aall[2]=0}this.aall[3]+=this.ae2[0];if((this.ae2[0]>0&&this.aall[3]>this.ae2[1])||(this.ae2[0]<0&&this.aall[3]<this.ae2[1])){this.aall[3]=0}}}return 11};WEHOUCORE.Bb1.prototype.eventer=function(f,h,e){var i=h,d;for(d=0;d<i.length;d+=3){switch(i[d]){case"a":if(this.motion=="normal"){f.a=i[d+1]+WEHOUCORE.random()*i[d+2]-i[d+2]/2}else{if(this.motion=="gravity"){f.a.x=i[d+1].x;f.a.y=i[d+1].y}else{f.a=i[d+1]}}break;case"v":if(this.motion=="normal"){f.v=i[d+1]+WEHOUCORE.random()*i[d+2]-i[d+2]/2}else{if(this.motion=="gravity"){if(i[d+1].x){f.v.x=i[d+1].x;f.v.y=i[d+1].y}else{var g=f.t;var b=Math.sqrt(g.x*g.x+g.y*g.y);f.v.x=g.x*i[d+1]/b;f.v.y=g.y*i[d+1]/b}}else{f.v=i[d+1]}}break;case"va":f.va=i[d+1]+WEHOUCORE.random()*i[d+2]-i[d+2]/2;break;case"valpha":f.valpha=i[d+1];break;case"t":f.t=i[d+1].clone();if(f.t.x>=10000){if(f.t.x==29999){f.t.x=f.ms.position.x+WEHOUCORE.lmpos.x-f.bp.x}else{f.t.x=f.ms.position.x+f.t.x-20000}}if(f.t.y>=10000){if(f.t.y==29999){f.t.y=f.ms.position.y+WEHOUCORE.lmpos.y-f.bp.y}else{f.t.y=f.ms.position.y+f.t.y-20000}}if(i[d+1].x!=29999){f.bp.x=f.ms.position.x;f.bp.y=f.ms.position.y}i[d+2].x?(f.t.x+=+WEHOUCORE.random()*i[d+2].x-i[d+2].x/2):0;i[d+2].y?(f.t.y+=+WEHOUCORE.random()*i[d+2].y-i[d+2].y/2):0;f.t.sub(f.t,f.ms.position);var b=Math.sqrt((f.t.x)*(f.t.x)+(f.t.y)*(f.t.y));f.t.x=(f.t.x)*f.tdis/b+f.ms.position.x;f.t.y=(f.t.y)*f.tdis/b+f.ms.position.y;break;case"ms":var a=f.ms.position.clone();WEHOUCORE.webgl.scene.remove(f.ms);f.ms.deallocate();f.ms=i[d+1].clone();f.ms.position=a;WEHOUCORE.webgl.scene.add(f.ms);break;case"bb":if(i[d+1]){f.bb=[i[d+1][0],i[d+1][1]];this.parent.l[f.bb[0]].p.x=f.ms.position.x;this.parent.l[f.bb[0]].p.y=f.ms.position.y;if(i[d+2]){f.bb[2]=i[d+2]}}else{f.bb=0}break;case"cp":if(f.parentball){f[i[d+1]]=f.parentball[i[d+1]]}break;case"p":if(i[d+1].x!=29999){f.ms.position.x=i[d+1].x}if(i[d+1].y!=29999){f.ms.position.y=i[d+1].y}break;case"-x":if((!f.gx)||(f.btime-f.gx>5)){if(this.event[e][0]=="+x"||this.event[e][0]=="-x"){f.ms.position.x=this.event[e][1]*2-f.ms.position.x;f.t.x=2*this.event[e][1]-f.t.x;f.bp.x=2*this.event[e][1]-f.bp.x}else{f.t.x=2*f.ms.position.x-f.t.x;f.bp.x=2*f.ms.position.x-f.bp.x}f.gx=f.btime}break;case"-y":if((!f.gy)||(f.btime-f.gy>5)){if(this.event[e][0]=="+y"||this.event[e][0]=="-y"){f.ms.position.y=this.event[e][1]*2-f.ms.position.y;f.t.y=2*this.event[e][1]-f.t.y;f.bp.y=2*this.event[e][1]-f.bp.y}else{f.t.y=2*f.ms.position.y-f.t.y;f.bp.y=2*f.ms.position.y-f.bp.y}f.gy=f.btime}break;case"mirror":if((!f.gm)||(f.btime-f.gm>5)){WEHOUCORE.mirror(f.t,f.hited_n1,f.hited_n2,f.t);WEHOUCORE.mirror(f.bp,f.hited_n1,f.hited_n2,f.bp);if(i[d+1]){var c=WEHOUCORE.mirror(f.ms.position,f.hited_n1,f.hited_n2);f.t.sub(f.t,c)}else{WEHOUCORE.mirror(f.ms.position,f.hited_n1,f.hited_n2,f.ms.position)}f.gm=f.btime}break;case"jumpnext":WEHOUCORE.nowstory.storyCT("jumpnext");break;case"se":WEHOUCORE.nowstory.seplay(i[d+1]-1);break;case"eff":WEHOUCORE.nowstory.effect.push(i[d+1],f.ms.position);break;case"die":f.btime=this.bt-1;break;case"func":i[d+1](f,this);break;default:f[i[d]]=i[d+1]}}};WEHOUCORE.Bb1.prototype.going=function(a){for(l=0;l<this.myeve2.length;l++){if(this.ot==this.myeve2[l][0]){for(var P=0;P<this.ballbox.length;P++){this.eventer(this.ballbox[P],this.myeve2[l][1])}}}for(var P=0;P<this.ballbox.length;P++){var O=this.ballbox[P];if(O.btime<this.bt){if(this.outer&&(O.ms.position.x>(WEHOUCORE.w/2+30)||O.ms.position.x<-(WEHOUCORE.w/2+30)||O.ms.position.y>(WEHOUCORE.h/2+30)||O.ms.position.y<-(WEHOUCORE.h/2+30))){O.btime=this.bt+11;if(this.ms){O.ms.scale.x=0;O.ms.scale.y=0}continue}if(this.dwf&&O.parentball&&O.parentball.dieflag){O.btime=this.bt}for(l=0;l<this.event.length;l++){var L=this.event[l];var D=0;switch(L[0]){case"t":D=O.btime==this.event[l][1];break;case"-x":D=O.ms.position.x<=(L[1]>=30000?WEHOUCORE.bspos[0].x+(L[1]-40000):L[1]>=10000?WEHOUCORE.lmpos.x+(L[1]-20000):L[1])&&(!O.gx)&&(O.gx=1);break;case"+x":D=O.ms.position.x>=(L[1]>=30000?WEHOUCORE.bspos[0].x+(L[1]-40000):L[1]>=10000?WEHOUCORE.lmpos.x+(L[1]-20000):L[1])&&(!O.gx)&&(O.gx=1);break;case"+y":D=O.ms.position.y>=(L[1]>=30000?WEHOUCORE.bspos[0].x+(L[1]-40000):L[1]>=10000?WEHOUCORE.lmpos.y+(L[1]-20000):L[1])&&(!O.gy)&&(O.gy=1);break;case"-y":D=O.ms.position.y<=(L[1]>=30000?WEHOUCORE.bspos[0].x+(L[1]-40000):L[1]>=10000?WEHOUCORE.lmpos.y+(L[1]-20000):L[1])&&(!O.gy)&&(O.gy=1);break;case"nt":D=O.btime&&((O.btime-L[1][1])%L[1][0])==0;break;case"ds":D=(!O.gds)&&WEHOUCORE.p2p(O.ms.position,L[1][0],L[1][1],1)==1&&(O.gds=1);break;case"-ds":D=(!O.gds)&&!(WEHOUCORE.p2p(O.ms.position,L[1][0],L[1][1],1)==1)&&(O.gds=1);break;case"hit":D=O.btime>=2&&(this.type=="laser"?WEHOUCORE.laserTest(O.ms,this.longl,this.parent.l[L[1][0]].ballbox,L[1][1]):WEHOUCORE.ballTest(O,this.parent.l[L[1][0]].ballbox,L[1][1],L[1][2]));break;case"hited":D=O.hited==1&&(L[1]?(O.hited=0):(O.hited=2))+1;break;case"hitl":D=(WEHOUCORE,p2l(O.ms,O.hited_n1=L[1][0],O.hited_n2=L[1][1],L[1][2])&&(O.hited=1));break;case"ft":D=O.parentball.btime==L[1];break;case"func":D=L[1](O,this);break}if(D){var o=L[2];this.eventer(O,o,l)}}var E=0;if(O.btime==0){E=this.ds}if(this.type!="laser"&&this.type!="self"&&O.btime<=10+this.aptime&&this.ms){var H=this.aptime?(O.btime<5?O.btime:(O.btime>=5+this.aptime?O.btime-this.aptime:5)):O.btime;var q=3-(O.btime)*0.2;q=q<1?1:q;O.alpha=H/10;O.ms.scale.x=q;O.ms.scale.y=q}if(this.type=="laser"){if((this.att==0)&&O.btime*this.v[0]<=this.longl){O.ms.scale.y=O.btime*O.v/this.longl}else{if((this.att>0)&&O.btime==0){O.ms.scale.x=0}else{if((this.att>0)&&O.btime==1){O.ms.scale.x=4/this.shortl}else{if((this.att>0)&&O.btime>this.att-10&&O.btime<this.att){O.ms.scale.x=(10-this.att+O.btime)/10}else{if((this.att>0)&&O.btime==this.att){O.ms.scale.x=1}}}}}}if(this.motion=="normal"){if(this.m_a_f){O.a=this.m_a_f(O,P,O.a,this)}O.v+=O.a;if(this.m_v_f){O.v=this.m_v_f(O,P,O.v,this)}if(this.m_va_f){O.va=this.m_va_f(O,P,O.va,this)}if(this.lock){O.ms.position.x-=O.changp.x;O.ms.position.y-=O.changp.y}O.t.sub(O.t,O.bp);var d=(O.t.x)*(O.v+E)/O.tdis,b=(O.t.y)*(O.v+E)/O.tdis;O.ms.position.x+=d?d:0;O.ms.position.y+=b?b:0;O.ms.position.z=WEHOUCORE.zcounter();if(O.va){if(O.va>1000){var K=O.va-2000;var R=new THREE.Vector2(O.t.x,O.t.y);O.t=WEHOUCORE.a2a(O.t,K/180*Math.PI);R.sub(O.t,R);R.multiplyScalar(Math.sqrt((O.ms.position.x-O.bp.x)*(O.ms.position.x-O.bp.x)+(O.ms.position.y-O.bp.y)*(O.ms.position.y-O.bp.y))/O.tdis);O.ms.position.x+=R.x;O.ms.position.y+=R.y;d+=R.x;b+=R.y}else{var Q=0;if(this.rvauto){var I=(O.t.x-WEHOUCORE.lmpos.x)*(O.ms.position.y-WEHOUCORE.lmpos.y)-(O.t.y-WEHOUCORE.lmpos.y)*(O.ms.position.x-WEHOUCORE.lmpos.x);if(I>0){Q=-O.va}else{if(I<0){Q=O.va}}}else{Q=O.va}O.t=WEHOUCORE.a2a(O.t,Q/180*Math.PI)}}O.t.add(O.t,O.bp);if(this.lock){var n;if(!O.parentball){n={x:this.parent.parent.ms.position.x,y:this.parent.parent.ms.position.y}}else{n={x:O.parentball.ms.position.x,y:O.parentball.ms.position.y}}O.changp.x=n.x-O.lockp.x;O.changp.y=n.y-O.lockp.y;O.ms.position.x+=O.changp.x;O.ms.position.y+=O.changp.y;if(this.fout){d=O.ms.position.x-n.x;b=O.ms.position.y-n.y}}else{if(this.fout){d=O.ms.position.x-O.bp.x;b=O.ms.position.y-O.bp.y}}}else{if(this.motion=="gravity"){O.v.x+=O.a.x;O.v.y+=O.a.y;var d=O.v.x*this.f.x,b=O.v.y*this.f.y;O.ms.position.x+=d;O.ms.position.y+=b;O.ms.position.z=WEHOUCORE.zcounter()}else{if(this.motion=="mesh"){O.a=O.v.multiplyVector4(O.a);d=O.ms.position.x;b=O.ms.position.y;O.ms.position.x=O.a.x;O.ms.position.y=O.a.y;if(this.lock){var u=new THREE.Vector2();if(!O.parentball){u.x=this.parent.parent.ms.position.x;u.y=this.parent.parent.ms.position.y}else{u.x=O.parentball.ms.position.x;u.y=O.parentball.ms.position.y}O.ms.position.x+=u.x;O.ms.position.y+=u.y}if(this.bk){var g=O.a.z>=this.bk[0]?1:(O.a.z<=this.bk[1]?0:(O.a.z-this.bk[1])/(this.bk[0]-this.bk[1]));O.alpha=(O.btime<10)?(g>O.alpha?O.alpha:g):g}if(this.fout){d=O.a.x;b=O.a.y}else{d=O.ms.position.x-d;b=O.ms.position.y-b}O.ms.position.z=WEHOUCORE.zcounter()}else{if(this.motion=="function"){var S={x:O.ms.position.x,y:O.ms.position.y};this.m_fun(O,P,O.ms.position,this);O.ms.position.z=WEHOUCORE.zcounter();d=O.ms.position.x-S.x;b=O.ms.position.y-S.y}}}}if(O.vsize.x&&O.vsize.y){if(this.motion!="mesh"){O.ms.scale.x+=O.vsize.x;O.ms.scale.y+=O.vsize.y}else{var f=O.a.z*O.vsize.x*0.002;O.ms.scale.x=1+f;O.ms.scale.y=1+f}}if(O.valpha){O.alpha+=O.valpha;if(O.alpha>1){O.alpha=1}if(O.alpha<0){O.alpha=0}}if(this.alpha_fun){this.alpha_fun(O,this)}if((!(this.type=="line"))&&this.ms){O.ms.scale.z=O.alpha;if(O.ms.geometry.rep){O.ms.addMatrix.elements[2]=O.ms.geometry.rep[1];O.ms.addMatrix.elements[8]=Math.floor(O.btime/10)%O.ms.geometry.rep[0];if(O.ms.geometry.rep[2]){if(Math.abs(d)>0.3){if(O.ms.adsta<15){O.ms.addMatrix.elements[9]=1;O.ms.addMatrix.elements[8]=Math.floor(O.ms.adsta/5);O.ms.adsta++}else{O.ms.addMatrix.elements[9]=2}}else{if(O.ms.adsta>0){O.ms.addMatrix.elements[9]=1;O.ms.addMatrix.elements[8]=Math.floor(O.ms.adsta/5);O.ms.adsta--}else{O.ms.addMatrix.elements[9]=0}}if(d<0){O.ms.addMatrix.elements[8]+=O.ms.geometry.rep[3];O.ms.addMatrix.elements[9]+=O.ms.geometry.rep[4];O.ms.addMatrix.elements[2]=-O.ms.addMatrix.elements[2]}}}}if(this.rat==1&&this.ms){O.ms.rotation.z=(d!=0?Math.PI/2+Math.atan(b/d):Math.PI);if(this.type=="ball"){O.ms.rotation.z+=Math.PI}if((d>0&&b<0)||(d>=0&&b>=0)){O.ms.rotation.z+=Math.PI}}else{if(this.rat==2&&this.ms){O.ms.rotation.z+=0.05}}var h=0;var e=false;if(this.type=="line"){O.lms.scale.z=O.alpha;var r=Math.sqrt(d*d+b*b),N=0;var s=new THREE.Vector2(5*b/r,-5*d/r);var M=new THREE.Vector2((O.lms.geometry.vertices[N].x+O.lms.geometry.vertices[N+1].x)/2,(O.lms.geometry.vertices[N].y+O.lms.geometry.vertices[N+1].y)/2);for(N=0;N<this.llong*2-2;N+=2){O.lms.geometry.vertices[N].x=O.lms.geometry.vertices[N+2].x;O.lms.geometry.vertices[N].y=O.lms.geometry.vertices[N+2].y;O.lms.geometry.vertices[N+1].x=O.lms.geometry.vertices[N+3].x;O.lms.geometry.vertices[N+1].y=O.lms.geometry.vertices[N+3].y;var A=new THREE.Vector2((O.lms.geometry.vertices[N+2].x+O.lms.geometry.vertices[N+3].x)/2,(O.lms.geometry.vertices[N+2].y+O.lms.geometry.vertices[N+3].y)/2);var F=WEHOUCORE.p2l(WEHOUCORE.lmpos,M,A,5,!e);if(F==1){h=1}else{if(F==2){e=true}}M=A}if(O.btime<this.aptime){h=0;O.lms.scale.z=O.alpha<0.5?O.alpha:0.5}O.lms.geometry.vertices[N].x=O.ms.position.x+s.x;O.lms.geometry.vertices[N].y=O.ms.position.y+s.y;O.lms.geometry.vertices[N].z=0;O.lms.geometry.vertices[N+1].x=O.ms.position.x-s.x;O.lms.geometry.vertices[N+1].y=O.ms.position.y-s.y;O.lms.geometry.vertices[N+1].z=0;O.lms.position.z=WEHOUCORE.zcounter();O.lms.geometry.verticesNeedUpdate=true}if(this.type=="laser"&&O.btime>=this.att&&O.alpha>=0.9&&O.ms.geometry.d){var C=WEHOUCORE.a2a(new THREE.Vector2(0,-this.longl*O.ms.scale.y+O.ms.geometry.d+20),O.ms.rotation.z);var B=WEHOUCORE.a2a(new THREE.Vector2(0,-O.ms.geometry.d-20),O.ms.rotation.z);var z=new THREE.Vector2(O.ms.position.x+C.x,O.ms.position.y+C.y);var y=new THREE.Vector2(O.ms.position.x+B.x,O.ms.position.y+B.y);var F=WEHOUCORE.p2l(WEHOUCORE.lmpos,z,y,O.ms.geometry.d*O.ms.scale.x,1);if(F==1){h=1}else{if(F==2){e=true}}}if(this.type=="self"){var G=WEHOUCORE.nowstory.self.hitlist;for(w=0;w<G.length;w++){var v=false;if(this.islaser){var C=WEHOUCORE.a2a(new THREE.Vector2(0,-this.longl*O.ms.scale.y+O.ms.geometry.d+20),O.ms.rotation.z);var B=WEHOUCORE.a2a(new THREE.Vector2(0,-O.ms.geometry.d-20),O.ms.rotation.z);if(WEHOUCORE.p2l(G[w].position,new THREE.Vector2(O.ms.position.x+C.x,O.ms.position.y+C.y),new THREE.Vector2(O.ms.position.x+B.x,O.ms.position.y+B.y),G[w].hit_dis*O.ms.scale.x)){v=true}}else{if(WEHOUCORE.p2p(O.ms.position,G[w].position,G[w].hit_dis*O.ms.scale.x,1)){v=true}}if(v){O.btime=this.bt-1;G[w].hit-=this.dmg;WEHOUCORE.deal.hitting();break}}}if(this.type=="enemy"){if(O.ms.hit<0){O.btime=this.bt-1;WEHOUCORE.nowstory.self.delHiter(O.ms);var x=0;if(x=this.item.length){for(var S=0;S<x;S++){WEHOUCORE.nowstory.item.push([[this.item[S][0],O.ms.position.x,O.ms.position.y,this.item[S][1],this.item[S][2]]])}}}}if(O.bb&&O.bb.length){if(O.bb[2]==5||O.bb[2]==9){this.parent.l[O.bb[0]].p.x=this.parent.l[O.bb[0]].gp.x;this.parent.l[O.bb[0]].p.y=this.parent.l[O.bb[0]].gp.y}else{this.parent.l[O.bb[0]].p.x=O.ms.position.x;this.parent.l[O.bb[0]].p.y=O.ms.position.y}this.parent.l[O.bb[0]].ot=O.bb[1];this.parent.l[O.bb[0]].parentball=O;this.parent.l[O.bb[0]].bread();O.bb[1]++;if(O.bb[2]==1||O.bb[2]==5){O.bb=0}}var F=0;if((this.cstable?(O.btime>10+this.aptime&&O.alpha>=0.85):1)&&(((this.type=="ball"||this.type=="enemy")&&this.ms&&O.ms.geometry.d&&((F=WEHOUCORE.p2p(O.ms.position,WEHOUCORE.lmpos,O.ms.geometry.d*O.ms.scale.x,0))==1)))||h==1){if(WEHOUCORE.cheat==0){WEHOUCORE.deal.hit();if((!this.protect)&&(this.type=="ball"||this.type=="enemy")){O.btime=this.bt-1}}else{WEHOUCORE.deal.cheathit();if((!this.protect)&&(this.type=="ball"||this.type=="enemy")){O.btime=this.bt-1}}}if(F==2){e=true}if(e){WEHOUCORE.deal.graze()}O.btime++}else{if(O.btime-this.bt<=10){if(O.btime==this.bt){O.dieflag=true;O.bb=null;for(l=0;l<this.deve.length;l++){if(this.deve[l][0]=="bb"){O.bb=[this.deve[l][1][0],this.deve[l][1][1]]}else{if(this.deve[l][0]=="eff"){WEHOUCORE.nowstory.effect.push(this.deve[l][1],O.ms.position.x,O.ms.position.y)}else{this[this.deve[l][0]]=this.deve[l][1]}}}}if(O.bb&&O.bb.length){this.parent.l[O.bb[0]].p.x=O.ms.position.x;this.parent.l[O.bb[0]].p.y=O.ms.position.y;this.parent.l[O.bb[0]].ot=O.bb[1];this.parent.l[O.bb[0]].parentball=O;this.parent.l[O.bb[0]].bread();O.bb[1]++}if((this.type=="ball"||this.type=="enemy")&&this.ms){var q=(10-O.btime+this.bt)*0.1;O.ms.scale.x=q;O.ms.scale.y=q}else{if(this.type=="laser"){O.ms.scale.x=(10-O.btime+this.bt)/10}else{if(this.type=="line"){O.lms.scale.z-=0.1}else{if(this.type=="self"){O.ms.position.y+=(10-O.btime+this.bt)*1;if(O.btime-this.bt==10){O.ms.scale.x=0}}}}}O.btime++}}}for(var P=0;P<this.ballbox.length;){if(this.ballbox[P].btime>this.bt+10){if(this.type=="ball"||this.type=="laser"||this.type=="self"||this.type=="enemy"){var J=this.ballbox.shift().ms;if(this.type=="enemy"){WEHOUCORE.nowstory.self.delHiter(J)}if(this.ms){WEHOUCORE.webgl.scene.remove(J);J.deallocate()}}else{if(this.type=="line"){var J=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(J);J.deallocate()}}}else{break}}for(l=0;l<this.myeve.length;l++){if(this.ot==this.myeve[l][0]||this.myeve[l][0]==-1){if(this.myeve[l][1]=="t"){this.t.x=this.myeve[l][2].x;this.t.y=this.myeve[l][2].y;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}}else{if(this.myeve[l][1]=="func"){this.myeve[l][2](this)}else{this[this.myeve[l][1]]=this.myeve[l][2]}}}}if(this.ot!=0||this.ballbox.length>0||this.toff){this.ot++}return 22};WEHOUCORE.Bb1.prototype.clear=function(g,e,d){var c=this.ballbox.length;for(var f=0;f<c;f++){var b=this.ballbox[f];if(((b.ms.position.x-g.x)*(b.ms.position.x-g.x)+(b.ms.position.y-g.y)*(b.ms.position.y-g.y)<=e*e*d*d)&&this.ballbox[f].btime<=this.bt){this.ballbox[f].btime=this.bt+1}}};WEHOUCORE.Bb1.prototype.clean=function(){var b=this.ballbox.length;for(var d=0;d<b;d++){if(this.type=="ball"||this.type=="laser"||this.type=="enemy"||this.type=="self"){var c=this.ballbox.shift().ms;WEHOUCORE.nowstory.self.delHiter(c);if(this.ms){WEHOUCORE.webgl.scene.remove(c);c.deallocate()}}else{if(this.type=="line"){var c=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(c);c.deallocate()}}}};WEHOUCORE.Bb1.prototype.renew=function(){this.ot=0;this.aall&&(this.aall=[0,0,0,0,0])};WEHOUCORE.Bb2=function(a,b){this.parent=a;this.ms=b.mesh||null;this.rnum=b.numberrandom||0;this.lock=b.locked||false;this.gp=b.position||new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.rp=b.positionrandom||new THREE.Vector2(0,0);this.pl=(b.positionlock===undefined)?true:b.positionlock;this.num=b.number||1;this.ds=b.distance||0;this.bt=b.lifetime||300;this.time=b.period||30;this.ot=0;this.ballbox=new Array();this.alpha=b.alpha||1;this.valpha=b.valpha||0;this.size=b.size||new THREE.Vector2(1,1);this.vsize=b.vsize||new THREE.Vector2(0,0);this.asize=b.asize||0;this.angle=b.angle||0;this.rangle=b.anglerandom||0};WEHOUCORE.Bb2.prototype.bread=function(g){var d;if(this.ot%this.time==0){var a=this.num+(this.rnum?-Math.floor(WEHOUCORE.random()*this.rnum):0);var n=(this.rp.x>0),f;if(!n&&this.rp.x){f=-WEHOUCORE.random()*this.rp.x+this.rp.x/2}var h=(this.rp.x>0),e;if(!h&&this.rp.y){e=-WEHOUCORE.random()*this.rp.y+this.rp.y/2}for(var d=0;d<a;d++){var o;if(this.ms){if(!this.ms.position){var b=Math.floor(WEHOUCORE.random()*this.ms.length);o=this.ms[b].clone();o.ms=this.ms[b].ms}else{o=this.ms.clone();if(this.ms.ms){o.ms=this.ms.ms}}}else{o=new Object();o.position=new Object()}o.position.x=this.p.x+(this.rp.x?(n?(WEHOUCORE.random()*this.rp.x-this.rp.x/2):f):0);o.position.y=this.p.y+(this.rp.y?(h?(WEHOUCORE.random()*this.rp.y-this.rp.y/2):e):0);o.position.z=2;o.rotation.z=(this.angle+WEHOUCORE.random()*this.rangle)*Math.PI/180;var c=new WEHOUCORE.Ball(o,new THREE.Vector2(1000,1000),0,0,0,[],this.alpha,this.valpha,this.size,this.vsize.clone());if(this.parentball){c.parentball=this.parentball}this.ballbox.push(c);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}}this.ot++;return 11};WEHOUCORE.Bb2.prototype.going=function(d){for(var b=0;b<this.ballbox.length;b++){var c=this.ballbox[b];c.vsize.x+=this.asize;c.vsize.y+=this.asize;if(c.vsize.x){c.ms.scale.x+=c.vsize.x}if(c.vsize.y){c.ms.scale.y+=c.vsize.y}if(c.valpha){c.alpha+=c.valpha}if(c.alpha>1){c.alpha=1}if(c.alpha<0){c.alpha=0}c.ms.scale.z=c.alpha;c.ms.position.z=WEHOUCORE.zcounter();c.btime++}for(var b=0;b<this.ballbox.length;){if(this.ballbox[b].btime>this.bt){var a=this.ballbox.shift().ms;if(this.ms){WEHOUCORE.webgl.scene.remove(a);a.deallocate()}}else{break}}return 22};WEHOUCORE.Bb2.prototype.clear=function(){var b=this.ballbox.length;for(var c=0;c<b;c++){if(this.ballbox[c].btime<this.bt){this.ballbox[c].btime=this.bt}}};WEHOUCORE.Bb3=function(a,b){this.parent=a;this.ms=b.mesh||null;this.p=b.position||new THREE.Vector2(0,0);this.num=b.number||1;this.getds=b.getdistance||80;this.getv=b.getspeed||8;this.getf=b.getfunction||0;this.ds=b.distance||0;this.ballbox=new Array()};WEHOUCORE.Bb3.prototype.bread=function(d){for(var c=0;c<this.num;c++){var b;if(this.ms){b=this.ms.clone();if(this.ms.ms){b.ms=this.ms.ms}}else{b=new Object();b.position=new Object()}b.position.x=this.p.x-WEHOUCORE.random()*this.ds+this.ds/2;b.position.y=this.p.y-WEHOUCORE.random()*this.ds+this.ds/2;b.position.z=2;var a=new WEHOUCORE.Ball(b,new THREE.Vector2(1000,1000),2,0,0);if(this.parentball){a.parentball=this.parentball}this.ballbox.push(a);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}return 11};WEHOUCORE.Bb3.prototype.going=function(f){for(var c=0;c<this.ballbox.length;c++){var e=this.ballbox[c];if(!e.va){var a=Math.sqrt((e.ms.position.x-WEHOUCORE.lmpos.x)*(e.ms.position.x-WEHOUCORE.lmpos.x)+(e.ms.position.y-WEHOUCORE.lmpos.y)*(e.ms.position.y-WEHOUCORE.lmpos.y));if(f||a<this.getds){e.a=1}if(e.a){e.ms.rotation.z=0;var d=this.getv/a;e.ms.position.x+=(WEHOUCORE.lmpos.x-e.ms.position.x)*d;e.ms.position.y+=(WEHOUCORE.lmpos.y-e.ms.position.y)*d;if(a<20){e.va=1;e.ms.position.x=-2000;this.getf&&this.getf()}}else{if(e.btime<=16){e.ms.rotation.z=(16-e.btime)*0.3}else{if(e.btime<=58){e.v-=0.1}else{if(WEHOUGAME.grazelock<=20){e.ms.position.y+=1.5}}}e.ms.position.y+=e.v;if(e.ms.position.y<-WEHOUCORE.w/2-40){e.va=1;e.ms.position.x=-2000}}}e.ms.position.z=WEHOUCORE.zcounter();e.btime++}for(var c=0;c<this.ballbox.length;){if(this.ballbox[c].va){var b=this.ballbox.shift().ms;if(this.ms){WEHOUCORE.webgl.scene.remove(b);b.deallocate()}}else{break}}return 22};WEHOUCORE.Bb3.prototype.clear=function(){var b=this.ballbox.length;for(var c=0;c<b;c++){this.ballbox[c].va=1}};