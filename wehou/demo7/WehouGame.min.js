var WEHOUGAME={};WEHOUGAME.mainstory=new WEHOUCORE.storySet("unknown");WEHOUGAME.renderintime=1;WEHOUGAME.rendereachtime=1;WEHOUGAME.slowtime=1;WEHOUGAME.onpause=false;WEHOUGAME.gotime=0;WEHOUGAME.lastshowtime=0;WEHOUGAME.power=0;WEHOUGAME.graze=0;WEHOUGAME.miss=0;WEHOUGAME.misscd=0;WEHOUGAME.basescore=1000;WEHOUGAME.score=0;WEHOUGAME.hiscore=0;WEHOUGAME.kd=[];WEHOUGAME.lmturn=0;WEHOUGAME.inrep=false;WEHOUGAME.onsp=false;WEHOUGAME.repdata;WEHOUGAME.dom=null;WEHOUGAME.tempcanvas=new Array();WEHOUGAME.tempmesh=new Array();WEHOUGAME.tempspbg=new Array();WEHOUGAME.myplalist=new WEHOUCORE.planeSet();WEHOUGAME.myimglist=new WEHOUCORE.imgSet();WEHOUGAME.myshaderlist=new WEHOUCORE.shaderSet();WEHOUGAME.myplalistbre=new WEHOUCORE.planeSet();WEHOUGAME.myplalistot=new WEHOUCORE.planeSet();WEHOUGAME.myplalistsdr=new WEHOUCORE.planeSet();WEHOUGAME.myimglistbre=new WEHOUCORE.imgSet();WEHOUGAME.myplalistbos=new WEHOUCORE.planeSet();WEHOUGAME.myplalistbox=new WEHOUCORE.planeSet();WEHOUGAME.myimglistbos=new WEHOUCORE.imgSet();WEHOUGAME.mymusiclist=new Array();WEHOUGAME.mymusicon=[];WEHOUGAME.myselist=new Array();WEHOUGAME.myaudio=new AudioContext()||NULL;WEHOUGAME.addBulletImg=function(b,a){WEHOUGAME.myimglistbre.add(b,a===undefined?1:a,1,1);return WEHOUGAME.myimglistbre.l.length-1};WEHOUGAME.getBulletImg=function(a){return WEHOUGAME.myimglistbre.l[a]};WEHOUGAME.addBullet=function(c,b,f,l,e,j,g,a){WEHOUGAME.myplalistbre.add(b,f,c,{d:l,end:(e=="laser"?1:0),rep:j||1,cut:(g?g:null),rt:(a?1:0)});return WEHOUGAME.myplalistbre.l.length-1};WEHOUGAME.getBullet=function(a){return WEHOUGAME.myplalistbre.l[a]};WEHOUGAME.addPla=function(c,b,d,e,a){WEHOUGAME.myplalistot.add(b,d,c,{end:0,cut:(e?e:null),rt:(a?1:0)});return WEHOUGAME.myplalistot.l.length-1};WEHOUGAME.getPla=function(a){return WEHOUGAME.myplalistot.l[a]};WEHOUGAME.addShader=function(c,b,d,f,a,e){WEHOUGAME.myplalistsdr.add(b,d,WEHOUGAME.myshaderlist.l[WEHOUGAME.myshaderlist.add({uniforms:{texture1:{type:"t",value:c.map}},vertexShader:f,fragmentShader:a})],{cut:e});return WEHOUGAME.myplalistsdr.l.length-1};WEHOUGAME.getShader=function(a){return WEHOUGAME.myplalistsdr.l[a]};WEHOUGAME.addBossImg=function(a){WEHOUGAME.myimglistbos.add(a,0,0);return WEHOUGAME.myimglistbos.l.length-1};WEHOUGAME.getBossImg=function(a){return WEHOUGAME.myimglistbos.l[a]};WEHOUGAME.addBoss=function(e,o,f,m,a){var d=WEHOUGAME.myplalistbox.add(0,0,e,{cut:[0,0,0,0]});var g=WEHOUGAME.myplalistbos.add(o,f,e,{cut:m});var l=WEHOUGAME.myplalistbos.l[d];l.position.y=10;l.addMatrix=new THREE.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);l.addMatrix.elements[2]=Math.min(Math.abs(m[0]-m[1]),Math.abs(m[2]-m[3]));var j=WEHOUGAME.myplalistbox.l[d];j.add(WEHOUGAME.myplalist.l[0].clone());j.add(WEHOUGAME.myplalist.l[4].clone());j.add(WEHOUGAME.myplalist.l[5].clone());j.add(l);l.video=a;l.now_video="normal";l.face=1;l.now_time=0;l.now_mod=1;j.deal=function(q,c,s,b,r){function n(u){switch(u){case 0:l.now_video="back";break;case 1:l.now_video="normal";break;case 2:l.now_video="turn";break;case 3:l.now_video="unturn";break;case 4:l.now_video="run";break}l.now_time=0;l.now_mod=u}if(Math.abs(c)>0.5&&l.now_mod==1){n(2)}else{if(Math.abs(c)<0.5&&l.now_mod==4){n(3)}}if(l.now_mod==2||l.now_mod==3){if(c>=0.01){l.face=1}else{if(c<=-0.01){l.face=-1}}}var h=l.video[l.now_video];if(c>0.5&&l.now_mod==-1&&!h[h.length-1]){l.face=1}else{if(c<-0.5&&l.now_mod==-1&&!h[h.length-1]){l.face=-1}}for(var p=1;p<=(h.length-2)/3;p++){if(l.now_time==h[p*3]){if(l.face==1){l.addMatrix.elements[2]=Math.abs(l.addMatrix.elements[2]);l.addMatrix.elements[8]=h[p*3-2]}else{l.addMatrix.elements[2]=-Math.abs(l.addMatrix.elements[2]);l.addMatrix.elements[8]=h[p*3-2]+1}l.addMatrix.elements[9]=h[p*3-1];if(h[h.length-1]){l.face=h[h.length-1]}break}}l.now_time++;if(l.now_time==h[0]){if(l.now_mod==4){n(4)}else{if(l.now_mod==2){n(4);l.face=1}else{if(l.now_mod==3){n(1);l.face=1}else{n(1)}}}}};j.act=function(c){var b=Math.sin(WEHOUCORE.time/50)*0.4;var h=this.children[0];h.rotation.z+=0.1;h.scale.x=2.35+b;h.scale.y=2.35+b;if(c==1){var h=this.children[1];h.scale.x=0;h.scale.y=0;var h=this.children[2];h.scale.x=0;h.scale.y=0}};j.sp=function(h){var c=Math.sin(WEHOUCORE.time/50)*0.4;var n=this.children[0];n.rotation.z+=0.1;n.scale.x=2.35+c;n.scale.y=2.35+c;this.children[1].rotation.z-=0.02;this.children[2].rotation.z+=0.02;if(h<60){var b=WEHOUCORE.slowmove[3](h,0,1,60);var n=this.children[1];n.scale.x=n.scale.y=b;var n=this.children[2];n.scale.x=n.scale.y=b}};j.end=function(b){var c=this.children[0];c.rotation.z+=0.1;c.scale.x+=0.05;c.scale.y+=0.05;if(b==1){var c=this.children[1];c.scale.x=0;c.scale.y=0;var c=this.children[2];c.scale.x=0;c.scale.y=0}if(c.material.opacity>0){c.material.opacity-=0.005}};j.onting=function(b){if(b==1){var c=this.children[0];c.scale.x=0;c.scale.y=0;var c=this.children[1];c.scale.x=0;c.scale.y=0;var c=this.children[2];c.scale.x=0;c.scale.y=0}}};WEHOUGAME.getBoss=function(a){return WEHOUGAME.myplalistbox.l[a]};WEHOUGAME.playBoss=function(b,a){t=WEHOUGAME.myplalistbos.l[b];t.now_video=a;t.now_time=0;t.now_mod=-1};WEHOUGAME.addMusic=function(b,a){var c=new Audio(b);if(a){c.loop=1}WEHOUGAME.mymusiclist.push(c)};WEHOUGAME.getMusic=function(a){return WEHOUGAME.mymusiclist[a]};WEHOUGAME.addSe=function(b){var a=new BufferLoader(WEHOUGAME.myaudio,b,function(c){WEHOUGAME.myselist=c});a.load()};WEHOUGAME.playSenow=new Array();WEHOUGAME.playSe=function(d,a,c){for(var b=0;b<WEHOUGAME.playSenow.length;b++){if(WEHOUGAME.playSenow[b][0]==d){return}}WEHOUGAME.playSenow.push([d,0,0])};if(WEHOUGAME.myaudio){WEHOUGAME.mainstory.seplay=WEHOUGAME.playSe;WEHOUGAME.playSenode=WEHOUGAME.myaudio.createGain();WEHOUGAME.playSenode.gain.value=0.15;WEHOUGAME.playSenode.connect(WEHOUGAME.myaudio.destination)}WEHOUGAME.runSe=function(){for(var a=0;a<WEHOUGAME.playSenow.length;a++){var b=WEHOUGAME.myaudio.createBufferSource();b.buffer=WEHOUGAME.myselist[WEHOUGAME.playSenow[a][0]];b.connect(WEHOUGAME.playSenode);b.start(0)}WEHOUGAME.playSenow=[]};WEHOUGAME.userInt=function(){};WEHOUGAME.intGame=function(e){if(!WEHOUGAME.dom){WEHOUGAME.dom=e;e.innerHTML+="<div id='bg' style='width:800px;height:600px;position:absolute;top:-25px;left:-30px;background-image:url(img/bg.jpg);background-repeat:no-repeat;'></div><div id='canvas-bg' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0px;left:0px;'></div><div id='canvas-core' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0;left:0;'></div><div id='canvas-ui' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0;left:0;'></div><div id='loadmsg'>加载基础代码中</div>";e.innerHTML+="<div id='hiscore' style='position:absolute;top:81px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#aaa;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='score' style='position:absolute;top:114px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#ddd;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='basescore' style='position:absolute;top:147px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#6cf;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div></div><div id='miss' style='position:absolute;top:182px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#f99;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div>";e.innerHTML+="<div id='game-talk' style='width:800px;height:600px;position:absolute;top:-25px;left:-30px;overflow:hidden;'></div>";if(!document.createElement("canvas").getContext("experimental-webgl")){alert("你的浏览器并不能很好的支持本游戏。\n请更换为chrome");WEHOUCORE.time=-10}}WEHOUCORE.initcoreenv(document.getElementById("canvas-core"));WEHOUGAME.ui={};WEHOUGAME.ui.renderer=new THREE.WebGLRenderer({antialias:true});WEHOUGAME.ui.renderer.setSize(WEHOUCORE.w,WEHOUCORE.h);document.getElementById("canvas-ui").appendChild(WEHOUGAME.ui.renderer.domElement);WEHOUGAME.ui.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-20000,20000);WEHOUGAME.ui.camera.lookAt(new THREE.Vector3(0,0,0));WEHOUGAME.ui.scene=new THREE.Scene();document.getElementById("canvas-bg").appendChild(WEHOUGAME.bg.renderer.domElement);WEHOUGAME.bg.renderer.setClearColorHex(0,1);WEHOUGAME.bg.scene=new THREE.Scene();WEHOUGAME.bg.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-2000,2000);WEHOUGAME.bg.renderer.render(WEHOUGAME.bg.scene,WEHOUGAME.bg.camera);WEHOUGAME.bg.rtt=new THREE.WebGLRenderTarget(500,550,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat});WEHOUGAME.bg.uniforms={texture1:{type:"t",value:WEHOUGAME.bg.rtt},texture2:{type:"t",value:0},uvb:{type:"v2",value:new THREE.Vector2(-1,-1)},move:{type:"v3",value:new THREE.Vector3(60,40,1.8)},is:{type:"f",value:-1},w:{type:"v2",value:new THREE.Vector2(WEHOUCORE.w,WEHOUCORE.h)},time:{type:"f",value:0},isover:{type:"f",value:0}};var n=new THREE.ShaderMaterial({uniforms:WEHOUGAME.bg.uniforms,vertexShader:"varying vec2 vUv;void main() {	vUv = uv;	gl_Position = projectionMatrix * modelViewMatrix * vec4( position,1.0 );}",fragmentShader:"uniform sampler2D texture1;uniform sampler2D texture2;uniform float is;uniform float isover;uniform float time;uniform vec3 move;uniform vec2 uvb;uniform vec2 w;varying vec2 vUv;void main(){	vec2 tuv=vec2(vUv.x*w.x-w.x/2.0,vUv.y*w.y-w.y/2.0);	vec2 uv2=vec2(vUv.x,vUv.y);	float dis=200.0;	if(is>0.0){		dis=sqrt((tuv.x-uvb.x)*(tuv.x-uvb.x)+(tuv.y-uvb.y)*(tuv.y-uvb.y));		if(dis<140.0){			uv2.x=uv2.x+(tuv.x-uvb.x)/1000.0*(140.0-dis)/140.0*sin(time+uv2.x*10.0);			uv2.y=uv2.y+(tuv.y-uvb.y)/1000.0*(140.0-dis)/140.0*sin(time+uv2.y*10.0);		}	}	vec4 fc=texture2D(texture1,uv2);	if(isover>0.5){		vec2 uv3=vec2(uv2.x*move.z+time/move.x,uv2.y*move.z+time/move.y);		vec4 fd=texture2D(texture2,uv3);		if(fd[3]>0.8){			fc.x=1.0-(1.0-fc.x)/fd.x;			fc.y=1.0-(1.0-fc.y)/fd.y;			fc.z=1.0-(1.0-fc.z)/fd.z;		}	}	if(is>0.0&&dis<80.0){		fc.x=fc.x+(1.0-fc.x)*(80.0-dis)/600.0;	}	gl_FragColor = fc;}"});WEHOUGAME.bg.face=new THREE.Mesh(new THREE.PlaneGeometry(WEHOUCORE.w,WEHOUCORE.h,0,0),n);WEHOUGAME.bg.scene.add(WEHOUGAME.bg.face);WEHOUGAME.addSe(["se/se_boon00.ogg","se/se_kira00.ogg","se/se_boon01.ogg","se/se_lazer01.ogg","se/se_timeout2.ogg","se/se_pldead00.ogg","se/se_cat00.ogg","se/se_enep01.ogg","se/se_nep00.ogg","se/se_don00.ogg","se/se_ch01.ogg"]);WEHOUGAME.tempspbg[0]=THREE.ImageUtils.loadTexture(WEHOUCORE.regimg("img/sp_1_bg.jpg"));WEHOUGAME.tempspbg[1]=THREE.ImageUtils.loadTexture(WEHOUCORE.regimg("img/sp_1_fl.png"));WEHOUGAME.myimglist.add(["img/sysimg_01.png"],1,0);WEHOUGAME.myimglist.add(["img/img_player.png"],0,0);WEHOUGAME.myimglist.add(["img/eff_line.png"],1,0,0,1);WEHOUGAME.myimglist.l[2].map.wrapS=WEHOUGAME.myimglist.l[2].map.wrapT=THREE.RepeatWrapping;WEHOUGAME.myimglist.l[2].opacity=0.4;WEHOUGAME.myplalist.add(96,96,WEHOUGAME.myimglist.l[0],{cut:[0,1/4,5/8,7/8]});WEHOUGAME.myplalist.l[0].position.set(0,0,-2000);WEHOUGAME.myplalist.add(40,50,WEHOUGAME.myimglist.l[1],{cut:[0,1/8,1,13/16]});WEHOUGAME.myplalist.l[1].addMatrix=new THREE.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);WEHOUGAME.myplalist.l[1].addMatrix.elements[2]=1/8;WEHOUGAME.myplalist.add(77,77,WEHOUGAME.myimglist.l[0],{cut:[0,1/8,7/8,1]});WEHOUCORE.webgl.scene.add(WEHOUGAME.myplalist.l[1]);WEHOUCORE.webgl.scene.add(WEHOUGAME.myplalist.l[2]);var c=function(s,r,q){var p=new THREE.PlaneGeometry(400,12,s,0);for(i=0;i<s+1;i++){var o=WEHOUCORE.a2a(new THREE.Vector2(0,r),2*Math.PI/s*i);p.vertices[i].x=o.x;p.vertices[i].y=o.y}for(i=0;i<s+1;i++){var o=WEHOUCORE.a2a(new THREE.Vector2(0,q),2*Math.PI/s*i);p.vertices[i+s+1].x=o.x;p.vertices[i+s+1].y=o.y}return p};var m=c(59,190,210),a=[0,1,4/8,5/8];m.faceVertexUvs[0]=[];var h=59,f=1;for(iz=0;iz<1;iz++){for(ix=0;ix<59;ix++){m.faceVertexUvs[0].push([new THREE.UV((ix/h)*4,a[3]),new THREE.UV((ix/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[3])])}}WEHOUGAME.myplalist.l[4]=new THREE.Mesh(m,WEHOUGAME.myimglist.l[2]);WEHOUGAME.myplalist.l[4].position.set(0,0,-1500);m=c(59,212,232),a=[0,1,2/8,3/8];m.faceVertexUvs[0]=[];var h=59,f=1;for(iz=0;iz<1;iz++){for(ix=0;ix<59;ix++){m.faceVertexUvs[0].push([new THREE.UV((ix/h)*4,a[3]),new THREE.UV((ix/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[3])])}}WEHOUGAME.myplalist.l[5]=new THREE.Mesh(m,WEHOUGAME.myimglist.l[2]);WEHOUGAME.myplalist.l[5].position.set(0,0,-1600);my2dpiclist=new Array();var g=new Image();g.src=WEHOUCORE.regimg("img/sysimg_01.png");my2dpiclist.push(g);g=new Image();g.src=WEHOUCORE.regimg("img/imgend.png");my2dpiclist.push(g);WEHOUGAME.tempcanvas[0]=document.createElement("canvas");WEHOUGAME.tempcanvas[0].width=455;WEHOUGAME.tempcanvas[0].height=40;WEHOUGAME.tempmesh[0]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[0]);WEHOUGAME.tempcanvas[1]=document.createElement("canvas");WEHOUGAME.tempcanvas[1].width=280;WEHOUGAME.tempcanvas[1].height=100;WEHOUGAME.tempmesh[1]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[1]);WEHOUGAME.tempcanvas[2]=document.createElement("canvas");WEHOUGAME.tempcanvas[2].width=300;WEHOUGAME.tempcanvas[2].height=50;WEHOUGAME.tempmesh[2]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[2]);WEHOUGAME.tempcanvas[3]=document.createElement("canvas");WEHOUGAME.tempcanvas[3].width=300;WEHOUGAME.tempcanvas[3].height=300;WEHOUGAME.tempmesh[3]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[3]);WEHOUGAME.tempcanvas[4]=document.createElement("canvas");WEHOUGAME.tempcanvas[4].width=500;WEHOUGAME.tempcanvas[4].height=550;WEHOUGAME.tempmesh[4]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[4]);WEHOUGAME.tempcanvas[5]=document.createElement("canvas");WEHOUGAME.tempcanvas[5].width=280;WEHOUGAME.tempcanvas[5].height=100;WEHOUGAME.tempmesh[5]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[5]);WEHOUGAME.tempcanvas[6]=document.createElement("canvas");WEHOUGAME.tempcanvas[6].width=300;WEHOUGAME.tempcanvas[6].height=6;WEHOUGAME.tempmesh[6]=new THREE.Mesh(c(59,66,72),new THREE.MeshBasicMaterial({map:new THREE.Texture(WEHOUGAME.tempcanvas[6]),transparent:true,depthWrite:false,depthTest:false}));var l=WEHOUGAME.tempcanvas[4].getContext("2d");l.font="bold 24px 黑体";l.textBaseline="hanging";l.textAlign="center";l.fillStyle="rgba(255,255,255,1)";l.lineWidth=2;l.strokeText("少女加载中",250,240);l.fillText("少女加载中",250,240);WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[4]);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);WEHOUGAME.userInt();WEHOUGAME.mainstory.effect.add([{mesh:WEHOUGAME.getBullet(WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(1),30,30,0,"ball",1,[3/8,4/8,7/8,6/8])),period:50,position:vec2(0,0),positionrandom:vec2(0,0),lifetime:100,valpha:-0.01,size:vec2(0,0),vsize:vec2(0.08,0.08),asize:-0.0008,anglerandom:360},{mesh:WEHOUGAME.getBullet(WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(1),128,128,0,"ball",1,[8/16,9/16,15/16,1])),period:50,position:vec2(0,0),positionrandom:vec2(50,50),lifetime:100,valpha:-0.01,size:vec2(0,0),vsize:vec2(0.1,0.1),asize:-0.0005,anglerandom:360}]);WEHOUGAME.afterInt&&WEHOUGAME.afterInt();var g=new Image();g.src=WEHOUCORE.regimg("img/imgload.png");g.onload=function(){var r=function(){var s=WEHOUGAME.tempcanvas[4].getContext("2d");s.clearRect(0,0,500,550);s.drawImage(g,0,0,500,550);WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);var u=function(x){x.stopPropagation();x.preventDefault();inrepstart=1;var w=new FileReader();w.readAsDataURL(x.dataTransfer.files[0]);w.onload=function(B){var A=this.result;var z=WEHOUGAME.tempcanvas[3].getContext("2d");var y=new Image();y.src=A;y.onload=function(){z.drawImage(y,0,0);WEHOUGAME.repdata=z.getImageData(0,0,300,300);var C="",D="";for(k=0;WEHOUGAME.repdata.data[k*2+10]!=255;k++){C+=String.fromCharCode(WEHOUGAME.repdata.data[k*2+10])}for(k=0;WEHOUGAME.repdata.data[k*2+64]!=255;k++){D+=String.fromCharCode(WEHOUGAME.repdata.data[k*2+64])}var E=WEHOUGAME.repdata.data[256-6]*65536+WEHOUGAME.repdata.data[256-4]*256+WEHOUGAME.repdata.data[256-2]*1;WEHOUCORE.randomseed=E;WEHOUGAME.inrep=true;WEHOUCORE.musiclistener.enable=false;WEHOUGAME.repdata.data[255]=255;if(C==WEHOUGAME.mainstory.name){alert("游戏地图为"+C+"的机师为"+D+"的一个replay加载成功")}else{alert("replay加载成功,但本游戏地图（"+WEHOUGAME.mainstory.name+"）与存档（"+C+"）不对应")}WEHOUGAME.gamestart()}};return false};var v=function(w){w.stopPropagation();w.preventDefault()};document.body.addEventListener("drop",u,false);document.body.addEventListener("dragover",v,false);document.body.onkeydown=function(w){if(w.keyCode==90){WEHOUGAME.gamestart()}else{if(w.keyCode==67){WEHOUCORE.cheat=1}}}};var p=WEHOUCORE.imglist;var q=document.getElementById("loadmsg");q.innerHTML="0/"+p.length;var o=function(u){if(u<=p.length){q.innerHTML=u+"/"+p.length;var s=new Image();s.src=p[u-1];s.onload=o(u+1);s.onerror=function(){alert("资源"+p[u-1]+"加载失败")}}else{q.innerHTML="";r()}};o(1)};var l=WEHOUGAME.tempcanvas[1].getContext("2d");l.font="bold 24px Tahoma";l.textBaseline="hanging";l.textAlign="center";l.fillStyle="#ffffff";l.lineWidth=2;l=WEHOUGAME.tempcanvas[0].getContext("2d");l.font="bold 21px 黑体";l.textBaseline="hanging";l.textAlign="right";l.fillStyle="#ffffff";l.lineWidth=2;l=WEHOUGAME.tempcanvas[2].getContext("2d");l.font="bold 19px 黑体";l.textBaseline="hanging";l.textAlign="center";l.fillStyle="#000000";l=WEHOUGAME.tempcanvas[5].getContext("2d");l.font="bold 8px Tahoma";l.textBaseline="hanging";l.textAlign="left";l.fillStyle="#a8f085";l.lineWidth=1;WEHOUGAME.mainstory.actlist[0]=function(r,q){var p;if(q==0){if(r==""){p=WEHOUGAME.tempcanvas[0].getContext("2d");p.clearRect(0,0,555,40);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[0])}else{p=WEHOUGAME.tempcanvas[0].getContext("2d");p.clearRect(0,0,555,40);p.drawImage(my2dpiclist[0],0,128+64,400,50,200,0,400,50);p.strokeText(r,450,8);p.fillText(r,450,8);WEHOUGAME.tempmesh[0].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[0])}}if(q<=100&&q>20){WEHOUGAME.tempmesh[0].position.x=24;WEHOUGAME.tempmesh[0].position.y=WEHOUCORE.slowmove[0](q-20,-250,506,80)}else{if(q<20){var o=19-q;WEHOUGAME.tempmesh[0].position.x=24-o*50;WEHOUGAME.tempmesh[0].position.y=-250;WEHOUGAME.tempmesh[0].scale.x=o/5+1;WEHOUGAME.tempmesh[0].scale.y=o/5+1;WEHOUGAME.tempmesh[0].material.opacity=(19-o)/20}}};WEHOUGAME.mainstory.actlist[1]=function(s,q){var p=s.length/2;if(q<=p*110){if((q)%110==0){var o=s,r=(q)/110;if(r<p){l=WEHOUGAME.tempcanvas[2].getContext("2d");l.clearRect(0,0,400,70);if(o[r*2]==1){l.drawImage(my2dpiclist[0],0,256,256,44,0,0,300,50);l.fillText(o[r*2+1],150,29);WEHOUGAME.tempmesh[2].material.map.needsUpdate=true;WEHOUGAME.tempmesh[2].position.x=WEHOUCORE.bspos[0].x;WEHOUGAME.tempmesh[2].position.y=WEHOUCORE.bspos[0].y-50;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[2])}else{l.drawImage(my2dpiclist[0],0,304,256,44,0,0,300,50);l.fillText(o[r*2+1],150,9);WEHOUGAME.tempmesh[2].material.map.needsUpdate=true;WEHOUGAME.tempmesh[2].position.x=WEHOUCORE.lmpos.x;WEHOUGAME.tempmesh[2].position.y=WEHOUCORE.lmpos.y+50;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[2])}}else{l=WEHOUGAME.tempcanvas[2].getContext("2d");l.clearRect(0,0,400,70);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[2])}}}};WEHOUGAME.mainstory.actlist[2]=function(q,p,o){if(p==0){WEHOUGAME.gotime=q;WEHOUGAME.tempmesh[1].position.y=250;WEHOUGAME.tempmesh[1].material.opacity=0}else{if(p==o){WEHOUGAME.gotime=0}}};WEHOUGAME.mainstory.actlist[3]=function(p,o){if(o==0){WEHOUGAME.power=p}};WEHOUGAME.mainstory.actlist[4]=function(q,o){if(o==0){var p=WEHOUGAME.myplalistbos.l[q[0]];p.geometry.faceVertexUvs[0][0][0].u=p.geometry.faceVertexUvs[0][0][1].u=q[1][0];p.geometry.faceVertexUvs[0][0][2].u=p.geometry.faceVertexUvs[0][0][3].u=q[1][1];p.geometry.faceVertexUvs[0][0][0].v=p.geometry.faceVertexUvs[0][0][3].v=q[1][2];p.geometry.faceVertexUvs[0][0][1].v=p.geometry.faceVertexUvs[0][0][2].v=q[1][3];p.geometry.uvsNeedUpdate=true}};WEHOUGAME.mainstory.actlist[5]=function(p,o){if(o==0){if(!p){p=[]}WEHOUGAME.mymusicon=p;if(p.length){p[0].currentTime=p[1];p[0].volume=0.3;p[0].play()}}};WEHOUGAME.mainstory.actlist[6]=function(r,x,v){if(x==0){if(r[0]!=""){var w=WEHOUGAME.tempcanvas[5].getContext("2d");w.clearRect(0,0,280,100);w.strokeText(r[0],0,8);w.fillText(r[0],0,8);var p,o,u="",s=Math.floor(r[1]/10),q=r[1]%10;for(p=1;p<=s;p++){u="★★★★★★★★★★";w.strokeText(u,0,8+p*14);w.fillText(u,0,8+p*14)}u="";for(o=0;o<q;o++){u+="★"}w.strokeText(u,0,8+p*14);w.fillText(u,0,8+p*14);WEHOUGAME.tempmesh[5].position.x=-106;WEHOUGAME.tempmesh[5].position.y=232;WEHOUGAME.tempmesh[5].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[5])}else{WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[5])}}if(x<100&&r[2]==1){WEHOUGAME.tempmesh[5].position.y=232+(100-x)*0.2;WEHOUGAME.tempmesh[5].material.opacity=1-(100-x)*0.01}if(x==v&&r[3]){WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[5])}};WEHOUGAME.mainstory.actlist[7]=function(q,p){if(p==0){WEHOUGAME.topscore+=WEHOUGAME.score;if(WEHOUGAME.miss==0){WEHOUGAME.topscore+=WEHOUGAME.score*0.5}if(WEHOUGAME.topscore>WEHOUGAME.hiscore){WEHOUGAME.hiscore=WEHOUGAME.topscore;if(window.localStorage){localStorage.d6_hs=WEHOUGAME.hiscore;WEHOUGAME.hiscore=localStorage.d6_hs}}WEHOUGAME.miss=0;WEHOUGAME.misscut=q[1];WEHOUGAME.score=q[0];if(q[2]){WEHOUGAME.timecut=q[2]}else{WEHOUGAME.timecut=0}document.getElementById("topscore").innerHTML=WEHOUGAME.topscore;document.getElementById("hiscore").innerHTML=WEHOUGAME.hiscore;document.getElementById("miss").innerHTML="";var o=document.getElementById("misscut");if(WEHOUGAME.misscut<1){o.innerHTML=WEHOUGAME.misscut*100+"%"}else{o.innerHTML=""}}};WEHOUGAME.mainstory.actlist[8]=function(p,o){if(o==p[3]){p[0].position.set(0,60,10000);p[1].position.set(0,110,11000);p[2].position.set(140,60,9000);p[0].scale.z=0;p[1].scale.z=0;p[2].scale.z=0;WEHOUCORE.webgl.scene.add(p[0]);WEHOUCORE.webgl.scene.add(p[1]);WEHOUCORE.webgl.scene.add(p[2])}else{if(o==p[4]){WEHOUCORE.webgl.scene.remove(p[0]);WEHOUCORE.webgl.scene.remove(p[1]);WEHOUCORE.webgl.scene.remove(p[2])}else{if(o-p[3]<=50){p[1].scale.z=(o-p[3])/50;p[2].scale.z=(o-p[3])/50;p[2].rotation.z=(o-p[3])/50-1}if(o-p[3]<=90&&o-p[3]>40){p[0].scale.z=(o-p[3]-40)/50}if(p[4]-o<=50){p[0].scale.z=(p[4]-o)/50;p[1].scale.z=(p[4]-o)/50;p[2].scale.z=(p[4]-o)/50}p[2].position.z=WEHOUCORE.zcounter();p[0].position.z=WEHOUCORE.zcounter();p[1].position.z=WEHOUCORE.zcounter()}}};var d=0,j=0,b=0;WEHOUGAME.mainstory.actlist[9]=function(w,p,o){if(p==0){var v=document.getElementById("game-talk"),u="",q=0;d=0;j=0,b=0;for(var r=0;r<w[0].length-1;r++){u+="<div id=talkface_"+r+" style='background-image:url(img/face.png);background-position:-"+w[0][r][2]+"px -"+w[0][r][3]+"px;width:"+w[0][r][4]+"px;height:"+w[0][r][5]+"px;position:absolute;bottom:0;"+(w[0][r][1]==0?"left:0;":"right:"+(200-q*60)+"px;")+"'></div>";if(w[0][r][1]){q++}}u+="<div id=talkface_msg style='background-color:rgba(255,238,170,0.9);border:3px solid #000;position:absolute;bottom:100px;font-size:20px;font-family:黑体;padding:10px 20px;border-radius:14px;'>我说，这是测试的文字。<br>你明白我的意思啦~</div>";v.innerHTML=u;if(w[0][r][0]){b=99999}}else{if(p==o){document.getElementById("game-talk").innerHTML=""}}for(r=1;r<w.length;r++){if(p+j==w[r][0]){d=r;for(var s=0;s<w[0].length-1;s++){var v=document.getElementById("talkface_"+s);if(s==w[r][1]){v.style.opacity=1;v.style.margin="0"}else{v.style.opacity=0.75;v.style.margin="0 -50px -20px -50px"}}var v=document.getElementById("talkface_msg");if(w[0][w[r][1]][1]){v.style.right="300px";v.style.left=""}else{v.style.left="150px";v.style.right=""}v.innerHTML=w[r][2]}}if(WEHOUGAME.kd[5]){if(b){b--;return}if(w[d+1]){j=w[d+1][0]-p-1}else{WEHOUGAME.mainstory.storyCT("jumpnext");b=99999;return}b=10}};WEHOUGAME.mainstory.actlist[10]=function(w,s,r){var u=w[0],p=WEHOUCORE.bshit[u];var o=WEHOUGAME.tempcanvas[6].getContext("2d");var q=function(){for(xxx=1;xxx<w[1].length-1;xxx++){o.fillStyle="#63f";o.fillRect(300*w[1][xxx]-1,0,3,6);o.fillStyle="#fff";o.fillRect(300*w[1][xxx],1,1,4)}};if(s==0){o.clearRect(0,0,300,6);o.fillStyle="#f00";o.fillRect(0,1,300,1);o.fillRect(0,4,300,1);q();WEHOUGAME.tempmesh[6].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[6]);WEHOUGAME.tempmesh[6].position.z=-100}else{if(s==r&&w[3]){WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[6])}}if(p>=0){o.clearRect(0,2,300,2);o.fillStyle="#fff";if(w[2]!=99){o.fillRect(0,2,300*((w[1][w[2]]-w[1][w[2]+1])*p+w[1][w[2]+1]),2)}else{o.fillRect(0,2,300*p,2)}q();WEHOUGAME.tempmesh[6].material.map.needsUpdate=true}else{if(p==-3&&w[3]){WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[6])}}WEHOUGAME.tempmesh[6].position.x=WEHOUCORE.bspos[u].x;WEHOUGAME.tempmesh[6].position.y=WEHOUCORE.bspos[u].y};WEHOUGAME.mainstory.actlist[11]=function(q,p,o){if(p==1){WEHOUGAME.playSe(6);WEHOUGAME.onsp=true;WEHOUGAME.bg.uniforms.texture1.value=WEHOUGAME.tempspbg[2*q[0]];WEHOUGAME.bg.uniforms.texture2.value=WEHOUGAME.tempspbg[2*q[0]+1];WEHOUGAME.bg.uniforms.texture1.value.wrapS=WEHOUGAME.bg.uniforms.texture1.value.wrapT=THREE.RepeatWrapping;WEHOUGAME.bg.uniforms.texture2.value.wrapS=WEHOUGAME.bg.uniforms.texture2.value.wrapT=THREE.RepeatWrapping;WEHOUGAME.bg.uniforms.isover.value=1;if(q[1]){var p=WEHOUGAME.bg.uniforms.move.value;p.x=q[1].x;p.y=q[1].y;p.z=q[1].z}}if(p==o){WEHOUGAME.onsp=false;WEHOUGAME.bg.uniforms.texture1.value=WEHOUGAME.bg.rtt;WEHOUGAME.bg.uniforms.isover.value=0}};WEHOUCORE.deal.cheathit=WEHOUCORE.deal.hit=function(){if(!WEHOUGAME.misscd){WEHOUGAME.playSe(5);WEHOUGAME.misscd=60;WEHOUGAME.miss++;WEHOUGAME.basescore=Math.floor(WEHOUGAME.basescore*0.8)}};WEHOUCORE.deal.graze=function(){};WEHOUCORE.deal.hitting=function(){if(!WEHOUGAME.timecut){WEHOUGAME.score+=10}};WEHOUCORE.deal.partend=function(){t=WEHOUGAME.myplalistbos.l[0];t.now_video="normal";t.now_time=0;t.now_mod=1};WEHOUCORE.webgl.renderer.clear()};WEHOUGAME.puase=function(){if(WEHOUGAME.onpause){WEHOUGAME.onpause=false;if(WEHOUGAME.mymusicon.length){WEHOUGAME.mymusicon[0].play()}WEHOUGAME.render()}else{WEHOUGAME.onpause=true;if(WEHOUGAME.mymusicon.length){WEHOUGAME.mymusicon[0].pause()}}};WEHOUGAME.gamestart=function(){if(document.URL.substr(-2)=="#2"){WEHOUGAME.renderintime=2}var a=WEHOUGAME.tempcanvas[4].getContext("2d");a.clearRect(0,0,800,600);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[4]);if(window.localStorage&&localStorage.d7_hs){WEHOUGAME.hiscore=localStorage.d7_hs}WEHOUGAME.kd=[0,0,0,0,0,0,0,0,0,0,0];if(!WEHOUGAME.inrep){document.body.onkeydown=function(b){if(b.keyCode==37){WEHOUGAME.kd[0]=1}if(b.keyCode==38){WEHOUGAME.kd[1]=1}if(b.keyCode==39){WEHOUGAME.kd[2]=1}if(b.keyCode==40){WEHOUGAME.kd[3]=1}if(b.keyCode==90){WEHOUGAME.kd[5]=1}if(b.keyCode==88){WEHOUGAME.kd[6]=1}if(b.keyCode==27){WEHOUGAME.puase()}WEHOUGAME.kd[4]=b.shiftKey;b.stopPropagation()};document.body.onkeyup=function(b){if(b.keyCode==37){WEHOUGAME.kd[0]=0}if(b.keyCode==38){WEHOUGAME.kd[1]=0}if(b.keyCode==39){WEHOUGAME.kd[2]=0}if(b.keyCode==40){WEHOUGAME.kd[3]=0}if(b.keyCode==90){WEHOUGAME.kd[5]=0}if(b.keyCode==88){WEHOUGAME.kd[6]=0}WEHOUGAME.kd[4]=b.shiftKey;b.stopPropagation()}}else{document.body.onkeydown=function(b){if(b.keyCode==88){history.go(0)}};document.body.onkeyup=function(b){}}a=WEHOUGAME.tempcanvas[3].getContext("2d");if(!WEHOUGAME.inrep){WEHOUGAME.repdata=a.createImageData(300,300)}else{}WEHOUGAME.render()};WEHOUGAME.gameover=function(){cxt=WEHOUGAME.tempcanvas[4].getContext("2d");cxt.drawImage(my2dpiclist[1],0,0,500,550);cxt.font="normal 22px Tahoma";cxt.textAlign="left";cxt.fillStyle="#ddd";cxt.lineWidth=6;cxt.strokeText(WEHOUGAME.score,266,230);cxt.fillText(WEHOUGAME.score,266,230);cxt.strokeText(WEHOUGAME.miss,266,270-5);cxt.fillText(WEHOUGAME.miss,266,270-5);if(window.localStorage){localStorage.d7_hs=WEHOUGAME.hiscore}WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[4]);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);document.body.onkeydown=function(d){if(d.keyCode==90){history.go(0)}else{if(d.keyCode==67){if(!WEHOUGAME.inrep){history.go(0)}var b=WEHOUCORE.randomseed;var c=prompt("请输入您的名字(只支持字母):");if(!c){history.go(0);return}if(c.length>30){c=c.substr(0,30)}for(k=0;k<WEHOUGAME.mainstory.name.length;k++){WEHOUGAME.repdata.data[k*2+10]=WEHOUGAME.mainstory.name.charCodeAt(k);WEHOUGAME.repdata.data[k*2+11]=255}WEHOUGAME.repdata.data[k*2+10]=255;WEHOUGAME.repdata.data[k*2+11]=255;WEHOUGAME.repdata.data[k*2+12]=255;WEHOUGAME.repdata.data[k*2+13]=255;for(k=0;k<c.length;k++){WEHOUGAME.repdata.data[k*2+64]=c.charCodeAt(k);WEHOUGAME.repdata.data[k*2+65]=255}WEHOUGAME.repdata.data[k*2+64]=255;WEHOUGAME.repdata.data[k*2+65]=255;WEHOUGAME.repdata.data[k*2+66]=255;WEHOUGAME.repdata.data[k*2+67]=255;WEHOUGAME.repdata.data[256-8]=255;WEHOUGAME.repdata.data[256-7]=255;WEHOUGAME.repdata.data[256-6]=(b&16711680)/65536;WEHOUGAME.repdata.data[256-5]=255;WEHOUGAME.repdata.data[256-4]=(b&65280)/256;WEHOUGAME.repdata.data[256-3]=255;WEHOUGAME.repdata.data[256-2]=(b&255)/1;WEHOUGAME.repdata.data[256-1]=255;var a=WEHOUGAME.tempcanvas[3].getContext("2d");a.putImageData(WEHOUGAME.repdata,0,0);a.font="normal 12px Tahoma";a.textAlign="left";a.fillStyle="#000";a.fillText("REPLAY: [map:"+WEHOUGAME.mainstory.name+"]",10,270);a.fillText("[player:"+c+"] [score:"+WEHOUGAME.score+"]",10,285);alert("正在输出replay图片，右键保存此图片即可");window.open(WEHOUGAME.tempcanvas[3].toDataURL("image/png"));history.go(0)}}}};WEHOUGAME.render=function(){if((!WEHOUCORE.gameover)&&(!WEHOUGAME.onpause)){requestAnimationFrame(WEHOUGAME.render)}else{if(WEHOUCORE.gameover){WEHOUGAME.gameover();return 0}}if(WEHOUCORE.time%WEHOUGAME.slowtime==0){var n;if(WEHOUGAME.inrep){var f=WEHOUGAME.repdata.data[WEHOUCORE.time*2+256];if(f&1){WEHOUGAME.kd[0]=1}else{WEHOUGAME.kd[0]=0}if(f&2){WEHOUGAME.kd[1]=1}else{WEHOUGAME.kd[1]=0}if(f&4){WEHOUGAME.kd[2]=1}else{WEHOUGAME.kd[2]=0}if(f&8){WEHOUGAME.kd[3]=1}else{WEHOUGAME.kd[3]=0}if(f&16){WEHOUGAME.kd[4]=1}else{WEHOUGAME.kd[4]=0}if(f&32){WEHOUGAME.kd[5]=1}else{WEHOUGAME.kd[5]=0}if(f&64){WEHOUGAME.kd[6]=1}else{WEHOUGAME.kd[6]=0}if(WEHOUGAME.kd[6]){WEHOUCORE.musiclistener.clock=1}}if(WEHOUGAME.kd[4]){n=2.4;WEHOUCORE.nowself.useGroup=1}else{n=5;WEHOUCORE.nowself.useGroup=0}if(WEHOUGAME.kd[0]+WEHOUGAME.kd[1]+WEHOUGAME.kd[2]+WEHOUGAME.kd[3]>=2){n*=0.707}if(WEHOUGAME.kd[0]){WEHOUCORE.lmpos.x-=n}if(WEHOUGAME.kd[1]){WEHOUCORE.lmpos.y+=n}if(WEHOUGAME.kd[2]){WEHOUCORE.lmpos.x+=n}if(WEHOUGAME.kd[3]){WEHOUCORE.lmpos.y-=n}if(WEHOUGAME.power){var l=(WEHOUGAME.power.x>=10000)?WEHOUCORE.lmpos.x+WEHOUGAME.power.x-20000:WEHOUGAME.power.x;var h=(WEHOUGAME.power.y>=10000)?WEHOUCORE.lmpos.y+WEHOUGAME.power.y-20000:WEHOUGAME.power.y;var m=WEHOUGAME.power.z,b=Math.sqrt((l-WEHOUCORE.lmpos.x)*(l-WEHOUCORE.lmpos.x)+(h-WEHOUCORE.lmpos.y)*(h-WEHOUCORE.lmpos.y));if(m<b){WEHOUCORE.lmpos.x+=(l-WEHOUCORE.lmpos.x)/b*m;WEHOUCORE.lmpos.y+=(h-WEHOUCORE.lmpos.y)/b*m}else{WEHOUCORE.lmpos.x=l;WEHOUCORE.lmpos.y=h}}var e=WEHOUCORE.w/2-20,d=WEHOUCORE.h/2-20;if(WEHOUCORE.lmpos.x>e){WEHOUCORE.lmpos.x=e}if(WEHOUCORE.lmpos.x<-e){WEHOUCORE.lmpos.x=-e}if(WEHOUCORE.lmpos.y>d){WEHOUCORE.lmpos.y=d}if(WEHOUCORE.lmpos.y<-d){WEHOUCORE.lmpos.y=-d}var j=WEHOUGAME.myplalist.l[1];j.position.set(WEHOUCORE.lmpos.x,WEHOUCORE.lmpos.y,1);if(WEHOUGAME.kd[0]&&WEHOUGAME.lmturn>-4){WEHOUGAME.lmturn--}else{if(WEHOUGAME.kd[2]&&WEHOUGAME.lmturn<4){WEHOUGAME.lmturn++}else{if(WEHOUGAME.lmturn<0){WEHOUGAME.lmturn++}else{if(WEHOUGAME.lmturn>0){WEHOUGAME.lmturn--}}}}if(WEHOUGAME.lmturn==0){j.addMatrix.elements[8]=Math.floor(WEHOUCORE.time/6)%8;j.addMatrix.elements[9]=0}else{if(WEHOUGAME.lmturn==4){j.addMatrix.elements[8]=Math.floor(WEHOUCORE.time/6)%4+4;j.addMatrix.elements[9]=4}else{if(WEHOUGAME.lmturn==-4){j.addMatrix.elements[8]=Math.floor(WEHOUCORE.time/6)%4+4;j.addMatrix.elements[9]=2}else{if(WEHOUGAME.lmturn>0){j.addMatrix.elements[8]=Math.floor(WEHOUGAME.lmturn);j.addMatrix.elements[9]=4}else{if(WEHOUGAME.lmturn<0){j.addMatrix.elements[8]=Math.floor(-WEHOUGAME.lmturn);j.addMatrix.elements[9]=2}}}}}var j=WEHOUGAME.myplalist.l[2];if(WEHOUGAME.kd[4]){j.scale.x+=j.scale.x<1?0.05:0;j.scale.y=j.scale.x}else{j.scale.x-=j.scale.x>0?0.05:0;j.scale.y=j.scale.x}j.rotation.z+=0.02;WEHOUGAME.mainstory.deal();j.position.set(WEHOUCORE.lmpos.x,WEHOUCORE.lmpos.y,WEHOUCORE.zcounter());if(WEHOUGAME.gotime>0){if(WEHOUGAME.gotime==999999){var c="∞"}else{WEHOUGAME.gotime--;var c=(WEHOUGAME.gotime/60).toFixed(1)}if(c!=WEHOUGAME.lastshowtime){cxt=WEHOUGAME.tempcanvas[1].getContext("2d");cxt.clearRect(0,0,280,100);cxt.strokeText(c+"s",150,2);cxt.fillText(c+"s",150,2);WEHOUGAME.tempmesh[1].material.map.needsUpdate=true;WEHOUGAME.lastshowtime=c;if(c<10&&c%1==0){WEHOUGAME.playSe(4)}}if(WEHOUGAME.tempmesh[1].position.y>200){WEHOUGAME.tempmesh[1].position.y-=0.5;WEHOUGAME.tempmesh[1].material.opacity+=0.008}else{WEHOUGAME.tempmesh[1].position.y=200}WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[1])}else{if(WEHOUGAME.gotime==0){WEHOUGAME.gotime=-1;cxt=WEHOUGAME.tempcanvas[1].getContext("2d");cxt.clearRect(0,0,180,100);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[1])}}if(WEHOUGAME.mymusicon.length){var a=WEHOUGAME.mymusicon;if(a[0].currentTime>=a[2]){if(!a[3]){a[0].pause()}else{a[0].currentTime=a[3];a[0].play()}}}WEHOUGAME.misscd>0?WEHOUGAME.misscd--:0;if(WEHOUGAME.score>WEHOUGAME.hiscore){WEHOUGAME.hiscore=WEHOUGAME.score}document.getElementById("score").innerHTML=WEHOUGAME.score;document.getElementById("hiscore").innerHTML=WEHOUGAME.hiscore;document.getElementById("basescore").innerHTML=WEHOUGAME.basescore;document.getElementById("miss").innerHTML=WEHOUGAME.miss;var e=WEHOUCORE.w/2+30,d=WEHOUCORE.h/2+30;if(WEHOUCORE.bspos[0].x>-e&&WEHOUCORE.bspos[0].x<e&&WEHOUCORE.bspos[0].y>-d&&WEHOUCORE.bspos[0].y<d){WEHOUGAME.bg.uniforms.is.value=1.1}else{WEHOUGAME.bg.uniforms.is.value=-1.1}WEHOUGAME.bg.uniforms.time.value+=0.13;WEHOUGAME.bg.uniforms.uvb.value.x=WEHOUCORE.bspos[0].x;WEHOUGAME.bg.uniforms.uvb.value.y=WEHOUCORE.bspos[0].y;WEHOUGAME.bg.callback&&WEHOUGAME.bg.callback(WEHOUCORE.time);if(!WEHOUGAME.inrep){if(WEHOUCORE.musiclistener.clock){WEHOUGAME.kd[6]=1;WEHOUCORE.musiclistener.clock=0}else{WEHOUGAME.kd[6]=0}WEHOUGAME.repdata.data[WEHOUCORE.time*2+256]=(WEHOUGAME.kd[0]*1+WEHOUGAME.kd[1]*2+WEHOUGAME.kd[2]*4+WEHOUGAME.kd[3]*8+WEHOUGAME.kd[4]*16+WEHOUGAME.kd[5]*32+WEHOUGAME.kd[6]*64+128);WEHOUGAME.repdata.data[WEHOUCORE.time*2+257]=255;WEHOUGAME.repdata.data[WEHOUCORE.time*2+258]=255;WEHOUGAME.repdata.data[WEHOUCORE.time*2+259]=255}}if(WEHOUCORE.time%WEHOUGAME.renderintime==0){WEHOUGAME.runSe();WEHOUGAME.myshaderlist.deal();if(!WEHOUGAME.onsp){WEHOUGAME.bg.renderer.render(WEHOUGAME.bg.bscene,WEHOUGAME.bg.bcamera,WEHOUGAME.bg.rtt,true)}WEHOUGAME.bg.renderer.render(WEHOUGAME.bg.scene,WEHOUGAME.bg.camera);WEHOUCORE.webgl.renderer.render(WEHOUCORE.webgl.scene,WEHOUCORE.webgl.camera);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);stats.update()}WEHOUCORE.time++};