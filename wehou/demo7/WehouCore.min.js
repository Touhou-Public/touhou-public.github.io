var WEHOUCORE={};WEHOUCORE.w=500;WEHOUCORE.h=550;WEHOUCORE.time=0;WEHOUCORE.cheat=0;WEHOUCORE.lmpos=new THREE.Vector2(0,-270);WEHOUCORE.bspos=[new THREE.Vector2(0,-350),new THREE.Vector2(0,-350),new THREE.Vector2(0,-350)];WEHOUCORE.bshit=[-1,-1,-1];WEHOUCORE.webgl={};WEHOUCORE.gameover=0;WEHOUCORE.deal={};WEHOUCORE.deal.graze=function(){};WEHOUCORE.deal.hit=function(){WEHOUCORE.gameover=1};WEHOUCORE.deal.cheathit=function(){};WEHOUCORE.deal.hitting=function(){};WEHOUCORE.deal.partend=function(){};WEHOUCORE.musiclistener={enable:true,clock:0};WEHOUCORE.nowstory={};WEHOUCORE.noweffect={};WEHOUCORE.nowself={};WEHOUCORE.nowboss=[];WEHOUCORE.randomseed=new Date().getTime()%1000000;WEHOUCORE.randomuse=0;WEHOUCORE.imglist=[];WEHOUCORE.regimg=function(a){WEHOUCORE.imglist.push(a);return a};WEHOUCORE.zcount=2;WEHOUCORE.zcounter=function(a){if(a){WEHOUCORE.zcount=a}else{WEHOUCORE.zcount+=1}return WEHOUCORE.zcount};WEHOUCORE.random=function(){var a=WEHOUCORE.randomseed+WEHOUCORE.randomuse*178279;a=(a/1000)*(a%1000);var a=a%1000/1000;WEHOUCORE.randomuse++;if(WEHOUCORE.randomuse>1000){WEHOUCORE.randomuse=0}return a};WEHOUCORE.initcoreenv=function(c){var b=c.clientWidth;var a=c.clientHeight;WEHOUCORE.webgl.renderer=new THREE.WebGLRenderer({antialias:true});WEHOUCORE.webgl.renderer.setSize(b,a);c.appendChild(WEHOUCORE.webgl.renderer.domElement);WEHOUCORE.webgl.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-60000,60000);WEHOUCORE.webgl.scene=new THREE.Scene()};WEHOUCORE.a2a=function(d,b){var c=new THREE.Vector2();c.x=d.x*Math.cos(b)-d.y*Math.sin(b);c.y=d.x*Math.sin(b)+d.y*Math.cos(b);return c};WEHOUCORE.p2p=function(f,c,b,e){if(b<=0){return 0}var a=(f.x-c.x)*(f.x-c.x)+(f.y-c.y)*(f.y-c.y);if(b==9999){return Math.sqrt(a)}else{if(!e&&(a<b*b+200)){WEHOUCORE.deal.graze();if(a>b*b){return 2}else{return 1}}if(a>b*b){return 0}else{return 1}}};WEHOUCORE.p2l=function(e,h,g,i){var q=WEHOUCORE.p2p(e,h,9999,1),o=WEHOUCORE.p2p(e,g,9999,1),n=WEHOUCORE.p2p(g,h,9999,1),f=0;if(q*q>=o*o+n*n){f=o}else{if(o*o>=q*q+n*n){f=q}else{var r=(q+o+n)/2;r=Math.sqrt(r*(r-q)*(r-o)*(r-n));f=2*r/n}}if(i){if(f>i){return 0}else{return 1}}else{return f}};WEHOUCORE.slowmove=[];WEHOUCORE.slowmove[0]=function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e*e+a}return g/2*((e-=2)*e*e+2)+a};WEHOUCORE.slowmove[1]=function(e,a,g,f){return g*e/f+a};WEHOUCORE.slowmove[2]=function(e,a,g,f){return g*((e=e/f-1)*e*e+1)+a};WEHOUCORE.slowmove[3]=function(e,a,h,g,f){if(f==undefined){f=1.70158}return h*((e=e/g-1)*e*((f+1)*e+f)+1)+a};WEHOUCORE.canvas2mesh=function(c,a,e,d){var b=new THREE.Mesh(new THREE.PlaneGeometry(a||c.width,e||c.height,0,0),new THREE.MeshBasicMaterial({map:new THREE.Texture(c),transparent:true,depthWrite:false,depthTest:false}));b.material.map.needsUpdate=true;return b};WEHOUCORE.imgSet=function(){this.l=new Array()};WEHOUCORE.imgSet.prototype.add=function(q,d,g,a,b,n){for(var e=0;e<q.length;e++){WEHOUCORE.imglist.push(q[e]);var f=THREE.ImageUtils.loadTexture(q[e]);if(a){f.minFilter=THREE.NearestFilter}if(b){var h=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(q[e])})}else{var h=new THREE.ShaderMaterial({uniforms:n?(function(){n.uniforms.texture1={type:"t",value:f};return n.uniforms})():{texture1:{type:"t",value:f}},vertexShader:n?n.vert:"varying vec2 vUv;varying float alphas;void main(){	vUv=uv;	mat4 mv=modelMatrix;	alphas=mv[2][2];	if(mv[0][2]>0.0){		vUv.x=vUv.x+mv[0][2]*floor(mv[2][0]);		vUv.y=vUv.y-mv[0][2]*floor(mv[2][1]);	}else if(mv[0][2]<0.0){		vUv.x=fract(mv[2][0])+fract(mv[2][1])-vUv.x;		vUv.x=vUv.x-mv[0][2]*floor(mv[2][0]);		vUv.y=vUv.y+mv[0][2]*floor(mv[2][1]);	}	mv[0][2]=0.0;	mv[2][0]=0.0;	mv[2][1]=0.0;	gl_Position=projectionMatrix*mv*vec4(position,1.0);}",fragmentShader:n?n.frag:"uniform sampler2D texture1;varying vec2 vUv;varying float alphas;void main(){	vec2 uv=vUv;	vec4 fc=texture2D(texture1,uv);	fc[3]=fc[3]*alphas;	gl_FragColor=fc;}"})}h.transparent=true;if(d==1){h.blending=THREE.AdditiveBlending}else{if(d==2){h.blending=THREE.SubtractiveBlending}}var o=new Array();o.push(h);this.l.push(h)}};WEHOUCORE.shaderSet=function(){this.l=new Array()};WEHOUCORE.shaderSet.prototype.add=function(d,a,c){var b=new THREE.ShaderMaterial(d);b.transparent=true;if(c){b.blending=THREE.AdditiveBlending}if(a){b.action=a}this.l.push(b);return this.l.length-1};WEHOUCORE.shaderSet.prototype.deal=function(){for(var a=0;a<this.l.length;a++){if(this.l[a].action){this.l[a].action(this.l[a].uniforms)}}};WEHOUCORE.planeSet=function(){this.l=new Array()};WEHOUCORE.planeSet.prototype.add=function(b,e,c,f){var g=new THREE.PlaneGeometry(b,e,0,0);if(f){if(f.d){g.d=f.d}g.cut=[0,1];if(f.cut&&f.cut.length==4){g.cut=[f.cut[1],f.cut[0]-f.cut[1]];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][1].u=f.cut[0];g.faceVertexUvs[0][0][2].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][3].v=f.cut[2];g.faceVertexUvs[0][0][1].v=g.faceVertexUvs[0][0][2].v=f.cut[3];if(f.rt){g.faceVertexUvs[0][0][1].u=g.faceVertexUvs[0][0][2].u=f.cut[0];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][1].v=f.cut[2];g.faceVertexUvs[0][0][2].v=g.faceVertexUvs[0][0][3].v=f.cut[3]}}if(f.end&&f.end!=0){g.vertices[2].y-=g.vertices[0].y;g.vertices[0].y=0;g.vertices[3].y-=g.vertices[1].y;g.vertices[1].y=0}if(f.rep!=1){var a=0;if(f.rep>8){f.rep/=3;a=1}g.rep=[f.rep,Math.abs(f.cut[0]-f.cut[1]),a,f.cut[0],f.cut[1]]}}var d=new THREE.Mesh(g,c);this.l.push(d);return this.l.length-1};WEHOUCORE.bberSet=function(){this.l=new Array()};WEHOUCORE.bberSet.prototype.add=function(c,b,a){var d=a||1;this.l.push(new WEHOUCORE["Bb"+d](c,b))};WEHOUCORE.lineSet=function(a,b){this.l=new Array();this.bl=b;this.bl.parent=this;this.st=new Array();this.ms=a.mesh||null;this.delms=(a.delmesh==undefined)?true:a.delmesh;if(this.ms==null){this.delms=false}this.slx=a.slowx||0;this.sly=a.slowy||0;this.hit=(a.hit==undefined)?99999:a.hit;this.hit_dis=(a.hit_dis==undefined)?60:a.hit_dis;this.k_dis=a.kick_dis||0;if(!this.ms){this.ms={};this.ms.position=new THREE.Vector2()}this.times=0;this.alltimes=0;this.player=a.player||"act";this.lt=new THREE.Vector2();this.eve=a.reload||[];this.l_fun=a.loopfunction||null};WEHOUCORE.lineSet.prototype.addline=function(a){this.l=this.l.concat(a)};WEHOUCORE.lineSet.prototype.addst=function(a){this.st=this.st.concat(a)};WEHOUCORE.lineSet.prototype.gogogo=function(g,e){if(this.alltimes&&(this.alltimes==this.l[this.l.length-1])){this.st=[[]];this.l=[0,new THREE.Vector2(-9998,-9998),new THREE.Vector2(0,0),50,new THREE.Vector2(-500,400),new THREE.Vector2(0,0),0];this.t=null;this.times=0}for(var c=0;c<this.eve.length;c++){if(this.eve[c][0]=="h"?this.ms.hit<this.eve[c][1]:this.eve[c][0]=="t"?this.alltimes>=this.eve[c][1]:0){this.st=this.eve[c][2];this.eve[c][1]=this.eve[c][0]=="h"?-1000:100000}}var f=0,d=0,o=0;if(e){for(var c=3;c<this.l.length-2;c+=3){if(this.times>=this.l[c-3]&&this.times<this.l[c]){o=c;if(this.times==this.l[c-3]){this.t=this.t||new THREE.Vector2(this.l[1].x==-9998?this.ms.position.x:this.l[1].x,this.l[1].y==-9998?this.ms.position.y:this.l[1].y);this.lt.x=this.t.x;this.lt.y=this.t.y;this.t.x=(this.l[c+1].x==-9999)?((Math.abs(WEHOUCORE.lmpos.x)<=(WEHOUCORE.w/2-80))?WEHOUCORE.lmpos.x:Math.abs(WEHOUCORE.lmpos.x)/WEHOUCORE.lmpos.x*(WEHOUCORE.w/2-80)):(this.l[c+1].x==-9998)?this.lt.x:this.l[c+1].x;this.t.y=(this.l[c+1].y==-9999)?((Math.abs(WEHOUCORE.lmpos.y)<=(WEHOUCORE.h/2-80))?WEHOUCORE.lmpos.y:Math.abs(WEHOUCORE.lmpos.y)/WEHOUCORE.lmpos.y*(WEHOUCORE.h/2-80)):(this.l[c+1].y==-9998)?this.lt.y:this.l[c+1].y;if(this.l[c+2]){this.t.x+=-WEHOUCORE.random()*(this.l[c+2].x+5)+this.l[c+2].x/2;this.t.y+=-WEHOUCORE.random()*(this.l[c+2].y+5)+this.l[c+2].y/2}}var q=this.st[(c-3)/3];var n=(typeof this.slx==="function")?this.slx(this.times-this.l[c-3],this.lt.x,this.t.x-this.lt.x,this.l[c]-this.l[c-3]):WEHOUCORE.slowmove[this.slx](this.times-this.l[c-3],this.lt.x,this.t.x-this.lt.x,this.l[c]-this.l[c-3]);var h=(typeof this.sly==="function")?this.sly(this.times-this.l[c-3],this.lt.y,this.t.y-this.lt.y,this.l[c]-this.l[c-3]):WEHOUCORE.slowmove[this.sly](this.times-this.l[c-3],this.lt.y,this.t.y-this.lt.y,this.l[c]-this.l[c-3]);f=n-this.ms.position.x;d=h-this.ms.position.y;this.ms.position.set(n,h,WEHOUCORE.zcounter());WEHOUCORE.bspos[g].x=n;WEHOUCORE.bspos[g].y=h;for(var b=0;b<q.length;b++){this.bl.l[q[b]].p.x=this.bl.l[q[b]].pl?this.bl.l[q[b]].gp.x+n:(this.bl.l[q[b]].gp.x>10000?this.bl.l[q[b]].gp.x-20000+WEHOUCORE.lmpos.x:this.bl.l[q[b]].gp.x);this.bl.l[q[b]].p.y=this.bl.l[q[b]].pl?this.bl.l[q[b]].gp.y+h:(this.bl.l[q[b]].gp.y>10000?this.bl.l[q[b]].gp.y-20000+WEHOUCORE.lmpos.y:this.bl.l[q[b]].gp.y);this.bl.l[q[b]].bread()}break}}}for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].going(g*50+a+2)}if(this.k_dis&&WEHOUCORE.p2p(WEHOUCORE.bspos[g],WEHOUCORE.lmpos,this.k_dis,1)){WEHOUCORE.deal.hit()}if(this.ms[this.player]){this.ms.deal(this.alltimes,f,d,n,h);this.ms[this.player](this.alltimes)}this.times++;this.alltimes++;if(this.times>this.l[this.l.length-4]){this.times=0;if(this.l_fun){this.l_fun(this,o)}}};WEHOUCORE.lineSet.prototype.show=function(){if(this.ms){WEHOUCORE.webgl.scene.add(this.ms);this.ms.hit=this.hit;this.ms.hit_dis=this.hit_dis;if(this.ms.hit){WEHOUCORE.nowself.addHiter(this.ms)}else{WEHOUCORE.nowself.delHiter(this.ms)}}};WEHOUCORE.lineSet.prototype.clear=function(b){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clear(this.ms.position,800,b)}};WEHOUCORE.lineSet.prototype.clean=function(){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clean()}if(this.delms){WEHOUCORE.webgl.scene.remove(this.ms);if(this.ms.hit){WEHOUCORE.nowself.delHiter(this.ms)}this.ms.deallocate()}};WEHOUCORE.selfSet=function(){this.l=new Array();this.useGroup=0;this.hitlist=[];WEHOUCORE.nowself=this};WEHOUCORE.selfSet.prototype.add=function(c){var a=new WEHOUCORE.bberSet();for(var b=0;b<c.length;b++){a.add(a,c[b])}this.l.push(a)};WEHOUCORE.selfSet.prototype.addHiter=function(a){this.hitlist.push(a)};WEHOUCORE.selfSet.prototype.delHiter=function(b){var a=this.hitlist.indexOf(b);if(a!==-1){this.hitlist.splice(a,1)}};WEHOUCORE.selfSet.prototype.runGroup=function(){var c=this.l[this.useGroup];for(var a=0;a<c.l.length;a++){if(WEHOUGAME.kd[5]){c.l[a].p.x=c.l[a].gp.x+WEHOUCORE.lmpos.x;c.l[a].p.y=c.l[a].gp.y+WEHOUCORE.lmpos.y;c.l[a].bread()}}for(var b=0;b<this.l.length;b++){var c=this.l[b];for(var a=0;a<c.l.length;a++){c.l[a].going(1)}}};WEHOUCORE.effectSet=function(){this.l=new WEHOUCORE.bberSet();this.pushlist=[];WEHOUCORE.noweffect=this};WEHOUCORE.effectSet.prototype.add=function(b){for(var a=0;a<b.length;a++){this.l.add(this.l,b[a],2)}};WEHOUCORE.effectSet.prototype.push=function(b,a){this.pushlist.push([b,a.x,a.y])};WEHOUCORE.effectSet.prototype.runGroup=function(){var b=this.l;for(var a=0;a<this.pushlist.length;a++){var c=this.pushlist[a][0];b.l[c].p.x=this.pushlist[a][1];b.l[c].p.y=this.pushlist[a][2];b.l[c].ot=0;b.l[c].bread()}for(var a=0;a<b.l.length;a++){b.l[a].going(1)}this.pushlist=[]};WEHOUCORE.itemSet=function(){this.l=new WEHOUCORE.bberSet();this.autoy_base=100;this.autoy=this.autoy_base;this.pushlist=[];WEHOUCORE.nowitem=this};WEHOUCORE.itemSet.prototype.add=function(b){for(var a=0;a<b.length;a++){this.l.add(this.l,b[a],3)}};WEHOUCORE.itemSet.prototype.push=function(b){for(var a=0;a<b.length;a++){this.pushlist.push(b[a])}};WEHOUCORE.itemSet.prototype.runGroup=function(){var b=this.l;for(var a=0;a<this.pushlist.length;a++){var c=this.pushlist[a][0];b.l[c].p.x=this.pushlist[a][1];b.l[c].p.y=this.pushlist[a][2];b.l[c].num=this.pushlist[a][3];b.l[c].ds=this.pushlist[a][4];b.l[c].bread()}for(var a=0;a<b.l.length;a++){b.l[a].going(WEHOUCORE.lmpos.y>this.autoy?1:0)}this.pushlist=[]};WEHOUCORE.storySet=function(a){this.name=a;this.l=new Array();this.s=new Array();this.t=0;this.at=0;this.p=0;this.self=new WEHOUCORE.selfSet();this.effect=new WEHOUCORE.effectSet();this.item=new WEHOUCORE.itemSet()};WEHOUCORE.storySet.prototype.setName=function(a){this.name=a};WEHOUCORE.storySet.prototype.add=function(g,f,e,d){var b=new WEHOUCORE.bberSet();for(var c=0;c<f.length;c++){b.add(b,f[c])}var a=new WEHOUCORE.lineSet(g,b);a.addline(e);a.addst(d);this.l.push(a);return this.l.length-1};WEHOUCORE.storySet.prototype.adds=function(a){this.s.push(a)};WEHOUCORE.storySet.prototype.actlist=new Array();WEHOUCORE.storySet.prototype.deal=function(){WEHOUCORE.zcounter(2);WEHOUCORE.nowstory=this;var c=this.s[this.p];var b=c.time;if(c.group){for(var a=0;a<c.group.length;a++){var d=this.l[c.group[a]];if(this.t==0){d.show();d.gogogo(a,true)}else{if(this.t==b-1){d.clean();WEHOUCORE.deal.partend();WEHOUGAME.slowtime=1;WEHOUCORE.bshit[a]=-2}else{if(this.t>=b-30){if(c.circleclear){d.clear(1-(b-this.t)/30);WEHOUGAME.slowtime=4;WEHOUGAME.mainstory.effect.push(1,WEHOUCORE.bspos[0])}else{d.clear(2)}d.gogogo(a,false);WEHOUCORE.bshit[a]=-1}else{d.gogogo(a,true);if((!c.bt)&&d.ms&&d.ms.hit_dis){WEHOUCORE.bshit[a]=d.ms.hit/d.hit;if(d.ms.hit<=0){d.ms.hit=d.hit;if(c.enditem){for(var e=0;e<c.enditem.length;e++){WEHOUCORE.nowitem.push([[c.enditem[e][0],d.ms.position.x,d.ms.position.y,c.enditem[e][1],c.enditem[e][2]]])}}this.storyCT("jumpnext");WEHOUCORE.bshit[a]=-3}}}}}}}this.self.runGroup();this.effect.runGroup();this.item.runGroup();if(c.act){for(var a=0;a<c.act.length;a+=2){if(c.act[a]==9999){WEHOUCORE.lmpos.x=9999;WEHOUCORE.gameover=1}else{this.actlist[c.act[a]](c.act[a+1],this.at,c.time-30)}}}if(c.listener){if(WEHOUCORE.musiclistener.enable){if(this.t<=b-30&&c.listener.music){if(c.listener.music[0]&&c.listener.music[0].currentTime>=c.listener.music[1]-0.5){WEHOUCORE.musiclistener.clock=1;this.storyCT("jumpnext")}}}else{if(WEHOUCORE.musiclistener.clock){WEHOUCORE.musiclistener.clock=0;this.storyCT("jumpnext")}}}if(this.at<c.time){this.at++}if(!c.statics){this.t++}else{this.t=1}if(this.t==b){this.p++;this.t=0;this.at=0}};WEHOUCORE.storySet.prototype.storyCT=function(a){if(a=="jumpnext"){this.at=this.t=this.s[this.p].time-30;this.s[this.p].statics=false}};WEHOUCORE.Ball=function(q,n,h,f,g,e,d,c,o,i){this.ms=q;this.ms.addMatrix=new THREE.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(this.ms.geometry&&this.ms.geometry.rep){this.ms.adsta=0}this.bp=new THREE.Vector2(this.ms.position.x,this.ms.position.y);this.t=new THREE.Vector2(n.x-this.bp.x,n.y-this.bp.y);var b=Math.sqrt((this.t.x)*(this.t.x)+(this.t.y)*(this.t.y));this.t.x=(this.t.x)*this.tdis/b+this.bp.x;this.t.y=(this.t.y)*this.tdis/b+this.bp.y;this.v=h;this.va=f;this.a=g;this.btime=0;this.bb=e||[];this.gz=0;this.alpha=d||1;this.valpha=c||0;this.vsize=i||new THREE.Vector2(0,0);if(o){this.ms.scale.x=o.x;this.ms.scale.y=o.y}};WEHOUCORE.Ball.prototype.tdis=3600;WEHOUCORE.Bb1=function(b,c){this.parent=b;this.type=c.type||"ball";this.motion=c.motion||"normal";if(this.type=="line"){this.lmat=c.linematerial||null;this.cut=c.materialcut||[0,1];this.llong=c.linelong||50;this.ms=null;this.aptime=c.appeartime||0}else{if(this.type=="laser"){this.ms=c.mesh||null;this.msm=c.meshget||"random";var a=this.ms.geometry?this.ms.geometry:this.ms[0].geometry;this.longl=Math.abs(a.vertices[2].y);this.shortl=Math.abs(a.vertices[0].x)*2;this.att=(c.appearline==undefined)?30:c.appearline;if(this.att<=10){this.att=0}this.rnum=c.numberrandom||0;this.rat=1}else{this.ms=c.mesh||null;this.msm=c.meshget||"random";this.rnum=c.numberrandom||0;this.rat=(c.rotating==undefined)?1:c.rotating;this.outer=c.outfield||false;this.aptime=c.appeartime||0;if(this.type=="self"){this.dmg=c.damage;this.islaser=c.likelaser||0;if(this.islaser){var a=this.ms.geometry?this.ms.geometry:this.ms[0].geometry;this.longl=Math.abs(a.vertices[2].y);this.shortl=Math.abs(a.vertices[0].x)*2}}else{if(this.type=="enemy"){this.hit=c.hitblood||40;this.hit_dis=c.hitdistance||20;this.item=c.item||[]}}}}if(this.motion!="mesh"){this.gp=c.position||new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.rp=c.positionrandom||new THREE.Vector2(0,0);this.p_fun=c.positionfunction||0;this.pl=(c.positionlock===undefined)?true:c.positionlock;this.v=c.speed||[3];this.ve=c.speedchange||[0,0];this.rv=c.speedrandom||0;this.t=c.target||WEHOUCORE.lmpos;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}this.rt=c.targetrandom||0;if(this.motion=="normal"){this.m_v_f=c.mspeedfunction||0;this.va=c.palstance||[0];this.m_va_f=c.mpalstancefunction||0;this.a=c.acceleration||[0];this.m_a_f=c.maccelerationfunction||0;this.rva=c.palstancerandom||0;this.rvauto=c.autopalstance||false;this.fout=c.faceout||false}else{if(this.motion=="gravity"){this.g=c.gravity||new THREE.Vector2(0,-0.03);this.f=c.decay||new THREE.Vector2(0.7,0.8)}}this.num=c.number||1;this.ne=c.numberchange||[0,0];this.angle=c.angle||[-360];this.angle_fun=c.anglefunction||0;this.aoff=c.angleoffset||0;this.ae=c.anglechange||[0,0];this.ae2=c.anglesizechange||[0,0];this.rangle=c.anglerandom||0;this.tangle=c.anglefactor||[];this.aall=[0,0,0,0,0];this.ds=c.distance||0}else{this.gp=new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.pl=true;this.vert=c.vert||[];this.num=this.vert.length;for(k=0;k<this.num;k++){this.vert[k]=new THREE.Vector4(this.vert[k].x,this.vert[k].y,this.vert[k].z,1)}this.bk=c.goback||0;this.fout=c.faceout||false;if(c.setmove){this.setmove=c.setmove}if(c.setrotate){this.setrotate=c.setrotate}if(c.setsize){this.setsize=c.setsize}if(c.setmoverandom){this.rsetmove=c.setmoverandom}if(c.setrotaterandom){this.rsetrotate=c.setrotaterandom}if(c.setsizerandom){this.rsetsize=c.setsizerandom}this.meshv=c.meshmove||new THREE.Vector3(0,0,0);this.meshr=c.meshrotate||new THREE.Vector3(0,0,0);this.meshs=c.meshsize||new THREE.Vector3(1,1,1);this.tmat4=new THREE.Matrix4();this.tmat4.setPosition(this.meshv);this.tmat4.setRotationFromEuler(this.meshr,THREE.Object3D.defaultEulerOrder);this.tmat4.scale(this.meshs)}this.m_fun=c.ballfunction||new THREE.Vector2(0,0);this.lock=c.locked||false;if(this.lock){this.changep=new THREE.Vector2(0,0)}this.bt=c.lifetime||300;this.time=c.period||30;this.dwf=c.diewithfather||false;this.protect=c.protect||false;this.cstable=c.cloudprotect==undefined?true:c.cloudprotect;this.ot=0;this.toff=c.timeoffset||0;this.ballbox=new Array();this.event=c.bulletevents||[];this.myeve=c.myevents||[];this.deve=c.dieevents||[];this.se=c.birthse||0;this.secount=0;this.sep=c.seperiod||1;this.bplay=c.bossplay||["",0]};WEHOUCORE.Bb1.prototype.bread=function(x){var y;if((this.ot-this.toff>=0)&&(this.ot-this.toff)%this.time==0){if(this.se&&WEHOUCORE.nowstory.seplay&&this.secount%this.sep==0){WEHOUCORE.nowstory.seplay(this.se-1)}this.secount++;this.bplay[0]&&WEHOUGAME.playBoss(this.bplay[1]?this.bplay[1]:0,this.bplay[0]);if(this.motion!="mesh"){var e=new THREE.Vector2();e.x=this.t.x;e.y=this.t.y;if(e.x==30000){e.x=this.parentball.t.x}if(e.y==30000){e.y=this.parentball.t.y}e.sub(e,this.p);if(Math.abs(e.x)<2&&Math.abs(e.y)<2){e.y=-100}var u=this.num+(this.rnum?-Math.floor(WEHOUCORE.random()*this.rnum):0)+Math.floor(this.aall[2]);var t=(this.rp.x>0),n;if(!t&&this.rp.x){n=-WEHOUCORE.random()*this.rp.x+this.rp.x/2}var r=(this.rp.x>0),h;if(!r&&this.rp.y){h=-WEHOUCORE.random()*this.rp.y+this.rp.y/2}}else{u=this.num}for(var y=0;y<u;y++){if(this.ms){if(!this.ms.position){if(this.msm=="linear"){var c=this.ms[y%this.ms.length].clone()}else{var D=Math.floor(WEHOUCORE.random()*this.ms.length);var c=this.ms[D].clone()}}else{var c=this.ms.clone()}}else{var c=new Object();c.position=new Object()}if(this.type=="enemy"){c.hit=this.hit;c.hit_dis=this.hit_dis;WEHOUCORE.nowself.addHiter(c)}if(this.motion!="mesh"){c.position.x=this.p.x+(this.rp.x?(t?(WEHOUCORE.random()*this.rp.x-this.rp.x/2):n):0);c.position.y=this.p.y+(this.rp.y?(r?(WEHOUCORE.random()*this.rp.y-this.rp.y/2):h):0);if(this.p_fun){this.p_fun(this,y,c.position)}c.position.z=2;if(e.x>=10000){e.x=c.position.x+e.x-20000}if(e.y>=10000){e.y=c.position.y+e.y-20000}var a=0,C;if(this.angle.length==1&&this.angle[0]<0){C=[(-this.angle[0])/u]}else{C=this.angle}if(u%2==1){if(y==(u-1)/2){a=0}else{if(y<(u-1)/2){for(j=y;j<(u-1)/2;j++){a+=(C[j]===undefined?C[0]:C[j])+this.aall[3]}}else{if(y>(u-1)/2){for(j=y-1;j>(u-1)/2-1;j--){a-=(C[j]===undefined?C[0]:C[j])+this.aall[3]}}}}}else{if(y<u/2){for(j=y;j<=u/2-1;j++){a+=(C[j]===undefined?C[0]:C[j])+this.aall[3];if(j==u/2-1){a-=((C[j]===undefined?C[0]:C[j])+this.aall[3])/2}}}else{if(y>=u/2){for(j=y-1;j>=u/2-1;j--){a-=(C[j]===undefined?C[0]:C[j])+this.aall[3];if(j==u/2-1){a+=((C[j]===undefined?C[0]:C[j])+this.aall[3])/2}}}}}a+=this.rangle?Math.floor(WEHOUCORE.random()*this.rangle-this.rangle/2):0;a+=this.aall[0];a+=this.aoff;if(this.tangle.length){a+=Math.sin(WEHOUCORE.time/this.tangle[0])*this.tangle[1]}if(this.angle_fun){a=this.angle_fun(this,y,a)}var B=WEHOUCORE.a2a(e,a/180*Math.PI);this.rt?B.add(B,new THREE.Vector2(WEHOUCORE.random()*this.rt-this.rt/2,WEHOUCORE.random()*this.rt-this.rt/2)):0}else{c.position.x=this.vert[y].x;c.position.y=this.vert[y].y;c.position.z=2}if(this.rat==3&&this.ms){c.rotation.z=WEHOUCORE.random()*Math.PI*2}if(this.motion=="normal"){B.add(B,this.p);var f=new WEHOUCORE.Ball(c,B,this.v[0]==30000?(this.parentball.v):(this.v[y]||this.v[0])+this.aall[1]+(this.rv?(WEHOUCORE.random()*this.rv-this.rv/2):0),(this.va[y]||this.va[0])+(this.rva?(WEHOUCORE.random()*this.rva-this.rva/2):0),this.a[y]||this.a[0])}else{if(this.motion=="gravity"){var g=this.v[0]==30000?(this.parentball.v):(this.v[y]||this.v[0])+this.aall[1]+(this.rv?(WEHOUCORE.random()*this.rv-this.rv/2):0);var s=Math.sqrt(B.x*B.x+B.y*B.y);var f=new WEHOUCORE.Ball(c,B,new THREE.Vector2(B.x*g/s,B.y*g/s),0,new THREE.Vector2(this.g.x,this.g.y))}else{if(this.motion=="mesh"){var A=new THREE.Matrix4(),d=false;if(this.rsetmove||this.setmove){var z=new THREE.Vector3(0,0,0);if(this.rsetmove){z.x+=WEHOUCORE.random()*this.rsetmove.x;z.y+=WEHOUCORE.random()*this.rsetmove.y;z.z+=WEHOUCORE.random()*this.rsetmove.z}if(this.setmove){z.x+=this.setmove.x;z.y+=this.setmove.y;z.z+=this.setmove.z}A.setPosition(z);d=true}if(this.rsetrotate||this.setrotate){var z=new THREE.Vector3(0,0,0);if(this.rsetrotate){z.x+=WEHOUCORE.random()*this.rsetrotate.x;z.y+=WEHOUCORE.random()*this.rsetrotate.y;z.z+=WEHOUCORE.random()*this.rsetrotate.z}if(this.setrotate){z.x+=this.setrotate.x;z.y+=this.setrotate.y;z.z+=this.setrotate.z}A.setRotationFromEuler(z,THREE.Object3D.defaultEulerOrder);d=true}if(this.rsetsize||this.setsize){var z=new THREE.Vector3(0,0,0);if(this.rsetsize){z.x+=WEHOUCORE.random()*this.rsetsize.x;z.y+=WEHOUCORE.random()*this.rsetsize.y;z.z+=WEHOUCORE.random()*this.rsetsize.z}if(this.setsize){z.x+=this.setsize.x;z.y+=this.setsize.y;z.z+=this.setsize.z}A.scale(z);d=true}var q=this.vert[y].clone();if(d){q=A.multiplyVector4(q)}var f=new WEHOUCORE.Ball(c,new THREE.Vector2(0,0),this.tmat4,0,q)}}}if(this.motion=="function"){var f=new WEHOUCORE.Ball(c,B,0,0,0)}if(this.type=="line"){var b=new THREE.PlaneGeometry(1,1,0,this.llong-1);for(m=0;m<this.llong*2;m++){b.vertices[m].x=f.bp.x;b.vertices[m].y=f.bp.y}for(m=0;m<this.llong-1;m++){var o=b.faceVertexUvs[0][m];for(p=0;p<2;p++){o[p].u=o[p].v;o[p].v=this.cut[0]}for(p=2;p<4;p++){o[p].u=o[p].v;o[p].v=this.cut[1]}}f.lms=new THREE.Mesh(b,this.lmat);f.lms.position.z=20;f.lms.geometry.uvsNeedUpdate=true;f.lms.geometry.verticesNeedUpdate=true;f.lms.geometry.dynamic=true;WEHOUCORE.webgl.scene.add(f.lms)}if(this.lock){f.lockp=new THREE.Vector2(this.p.x,this.p.y);f.changp=new THREE.Vector2(0,0)}if(this.parentball){f.parentball=this.parentball}this.ballbox.push(f);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}if(this.motion!="mesh"){this.aall[0]+=this.ae[0];if((this.ae[0]>0&&this.aall[0]>this.ae[1])||(this.ae[0]<0&&this.aall[0]<this.ae[1])){this.aall[0]=0}this.aall[1]+=this.ve[0];if((this.ve[0]>0&&this.aall[1]>this.ve[1])||(this.ve[0]<0&&this.aall[1]<this.ve[1])){this.aall[1]=0}this.aall[2]+=this.ne[0];if((this.ne[0]>0&&this.aall[2]>this.ne[1])||(this.ne[0]<0&&this.aall[2]<this.ne[1])){this.aall[2]=0}this.aall[3]+=this.ae2[0];if((this.ae2[0]>0&&this.aall[3]>this.ae2[1])||(this.ae2[0]<0&&this.aall[3]<this.ae2[1])){this.aall[3]=0}}}for(l=0;l<this.myeve.length;l++){if(this.ot==this.myeve[l][0]){if(this.myeve[l][1]=="t"){this.t.x=this.myeve[l][2].x;this.t.y=this.myeve[l][2].y;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}}else{this[this.myeve[l][1]]=this.myeve[l][2]}}}this.ot++;return 11};WEHOUCORE.Bb1.prototype.going=function(d){for(var E=0;E<this.ballbox.length;E++){var M=this.ballbox[E];if(M.btime<this.bt){if(this.outer&&(M.ms.position.x>(WEHOUCORE.w/2+30)||M.ms.position.x<-(WEHOUCORE.w/2+30)||M.ms.position.y>(WEHOUCORE.h/2+30)||M.ms.position.y<-(WEHOUCORE.h/2+30))){M.btime=this.bt+11;if(this.ms){M.ms.scale.x=0;M.ms.scale.y=0}continue}if(this.dwf&&M.parentball&&M.parentball.dieflag){M.btime=this.bt}for(l=0;l<this.event.length;l++){if(this.event[l][0]=="t"?M.btime==this.event[l][1]:this.event[l][0]=="-x"?M.ms.position.x<=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.x+(this.event[l][1]-20000):this.event[l][1])&&(!M.gx)&&(M.gx=1):this.event[l][0]=="+x"?M.ms.position.x>=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.x+(this.event[l][1]-20000):this.event[l][1])&&(!M.gx)&&(M.gx=1):this.event[l][0]=="+y"?M.ms.position.y>=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.y+(this.event[l][1]-20000):this.event[l][1])&&(!M.gy)&&(M.gy=1):this.event[l][0]=="-y"?M.ms.position.y<=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.y+(this.event[l][1]-20000):this.event[l][1])&&(!M.gy)&&(M.gy=1):this.event[l][0]=="nt"?M.btime&&((M.btime-this.event[l][1][1])%this.event[l][1][0])==0:this.event[l][0]=="ds"&&(!M.gds)?WEHOUCORE.p2p(M.ms.position,this.event[l][1][0],this.event[l][1][1],1)==1&&(M.gds=1):this.event[l][0]=="-ds"&&(!M.gds)?!(WEHOUCORE.p2p(M.ms.position,this.event[l][1][0],this.event[l][1][1],1)==1)&&(M.gds=1):this.event[l][0]=="ft"?M.parentball.btime==this.event[l][1]:0){var N=this.event[l][2];for(C=0;C<N.length;C+=3){if(N[C]=="a"){if(this.motion=="normal"){M.a=N[C+1]+WEHOUCORE.random()*N[C+2]-N[C+2]/2}else{if(this.motion=="gravity"){M.a.x=N[C+1].x;M.a.y=N[C+1].y}else{M.a=N[C+1]}}}else{if(N[C]=="v"){if(this.motion=="normal"){M.v=N[C+1]+WEHOUCORE.random()*N[C+2]-N[C+2]/2}else{if(this.motion=="gravity"){if(N[C+1].x){M.v.x=N[C+1].x;M.v.y=N[C+1].y}else{var O=M.t;var A=Math.sqrt(O.x*O.x+O.y*O.y);M.v.x=O.x*N[C+1]/A;M.v.y=O.y*N[C+1]/A}}else{M.v=N[C+1]}}}else{if(N[C]=="va"){M.va=N[C+1]+WEHOUCORE.random()*N[C+2]-N[C+2]/2}else{if(N[C]=="t"){M.t=N[C+1].clone();if(M.t.x>=10000){if(M.t.x==29999){M.t.x=M.ms.position.x+WEHOUCORE.lmpos.x-M.bp.x}else{M.t.x=M.ms.position.x+M.t.x-20000}}if(M.t.y>=10000){if(M.t.y==29999){M.t.y=M.ms.position.y+WEHOUCORE.lmpos.y-M.bp.y}else{M.t.y=M.ms.position.y+M.t.y-20000}}M.bp.x=M.ms.position.x;M.bp.y=M.ms.position.y;N[C+2].x?(M.t.x+=+WEHOUCORE.random()*N[C+2].x-N[C+2].x/2):0;N[C+2].y?(M.t.y+=+WEHOUCORE.random()*N[C+2].y-N[C+2].y/2):0;M.t.sub(M.t,M.ms.position);var A=Math.sqrt((M.t.x)*(M.t.x)+(M.t.y)*(M.t.y));M.t.x=(M.t.x)*M.tdis/A+M.ms.position.x;M.t.y=(M.t.y)*M.tdis/A+M.ms.position.y}else{if(N[C]=="ms"){var B=M.ms.position.clone();WEHOUCORE.webgl.scene.remove(M.ms);M.ms.deallocate();M.ms=N[C+1].clone();M.ms.position=B;WEHOUCORE.webgl.scene.add(M.ms)}else{if(N[C]=="bb"){if(N[C+1]){M.bb=[N[C+1][0],N[C+1][1]];this.parent.l[M.bb[0]].p.x=M.ms.position.x;this.parent.l[M.bb[0]].p.y=M.ms.position.y;if(N[C+2]){M.bb[2]=N[C+2]}}else{M.bb=0}}else{if(N[C]=="cp"){if(M.parentball){M[N[C+1]]=M.parentball[N[C+1]]}}else{if(N[C]=="p"){if(N[C+1].x!=29999){M.ms.position.x=N[C+1].x}if(N[C+1].y!=29999){M.ms.position.y=N[C+1].y}}else{if(N[C]=="-x"){if(!M.gx){if(this.event[l][0]=="+x"||this.event[l][0]=="-x"){M.ms.position.x=this.event[l][1]*2-M.ms.position.x;M.t.x=2*this.event[l][1]-M.t.x;M.bp.x=2*this.event[l][1]-M.bp.x}else{M.t.x=2*M.ms.position.x-M.t.x;M.bp.x=2*M.ms.position.x-M.bp.x}M.gx=1}}else{if(N[C]=="-y"){if(!M.gy){if(this.event[l][0]=="+y"||this.event[l][0]=="-y"){M.ms.position.y=this.event[l][1]*2-M.ms.position.y;M.t.y=2*this.event[l][1]-M.t.y;M.bp.y=2*this.event[l][1]-M.bp.y}else{M.t.y=2*M.ms.position.y-M.t.y;M.bp.y=2*M.ms.position.y-M.bp.y}M.gy=1}}else{if(N[C]=="jumpnext"){WEHOUCORE.nowstory.storyCT("jumpnext")}else{if(N[C]=="se"){WEHOUCORE.nowstory.seplay(N[C+1]-1)}else{if(N[C]=="die"){M.btime=this.bt-1}else{M[N[C]]=N[C+1]}}}}}}}}}}}}}}}}var v=0;if(M.btime==0){v=this.ds}if(this.type!="laser"&&this.type!="self"&&M.btime<10+this.aptime&&this.ms){var z=this.aptime?(M.btime<5?M.btime:(M.btime>=5+this.aptime?M.btime-this.aptime:4)):M.btime;var K=3-(M.btime+1)*0.2;K=K<1?1:K;M.alpha=z/9;M.ms.scale.x=K;M.ms.scale.y=K}if(this.type=="laser"){if((this.att==0)&&M.btime*this.v[0]<=this.longl){M.ms.scale.y=M.btime*M.v/this.longl}else{if((this.att>0)&&M.btime==0){M.ms.scale.x=0}else{if((this.att>0)&&M.btime==1){M.ms.scale.x=4/this.shortl}else{if((this.att>0)&&M.btime>this.att-10&&M.btime<this.att){M.ms.scale.x=(10-this.att+M.btime)/10}else{if((this.att>0)&&M.btime==this.att){M.ms.scale.x=1}}}}}}if(this.motion=="normal"){if(this.m_a_f){M.a=this.m_a_f(M,E,M.a,this)}M.v+=M.a;if(this.m_v_f){M.v=this.m_v_f(M,E,M.v,this)}if(this.m_va_f){M.va=this.m_va_f(M,E,M.va,this)}if(this.lock){M.ms.position.x-=M.changp.x;M.ms.position.y-=M.changp.y}M.t.sub(M.t,M.bp);var s=(M.t.x)*(M.v+v)/M.tdis,r=(M.t.y)*(M.v+v)/M.tdis;M.ms.position.x+=s?s:0;M.ms.position.y+=r?r:0;M.ms.position.z=WEHOUCORE.zcounter();if(M.va){if(M.va>1000){var J=M.va-2000;var a=new THREE.Vector2(M.t.x,M.t.y);M.t=WEHOUCORE.a2a(M.t,J/180*Math.PI);a.sub(M.t,a);a.multiplyScalar(Math.sqrt((M.ms.position.x-M.bp.x)*(M.ms.position.x-M.bp.x)+(M.ms.position.y-M.bp.y)*(M.ms.position.y-M.bp.y))/M.tdis);M.ms.position.x+=a.x;M.ms.position.y+=a.y;s+=a.x;r+=a.y}else{var I=0;if(this.rvauto){var e=(M.t.x-WEHOUCORE.lmpos.x)*(M.ms.position.y-WEHOUCORE.lmpos.y)-(M.t.y-WEHOUCORE.lmpos.y)*(M.ms.position.x-WEHOUCORE.lmpos.x);if(e>0){I=-M.va}else{if(e<0){I=M.va}}}else{I=M.va}M.t=WEHOUCORE.a2a(M.t,I/180*Math.PI)}}M.t.add(M.t,M.bp);if(this.lock){var D;if(!M.parentball){D={x:this.parent.parent.ms.position.x,y:this.parent.parent.ms.position.y}}else{D={x:M.parentball.ms.position.x,y:M.parentball.ms.position.y}}M.changp.x=D.x-M.lockp.x;M.changp.y=D.y-M.lockp.y;M.ms.position.x+=M.changp.x;M.ms.position.y+=M.changp.y;if(this.fout){s=M.ms.position.x-D.x;r=M.ms.position.y-D.y}}else{if(this.fout){s=M.ms.position.x-M.bp.x;r=M.ms.position.y-M.bp.y}}}else{if(this.motion=="gravity"){M.v.x+=M.a.x;M.v.y+=M.a.y;var s=M.v.x*this.f.x,r=M.v.y*this.f.y;M.ms.position.x+=s;M.ms.position.y+=r;M.ms.position.z=WEHOUCORE.zcounter()}else{if(this.motion=="mesh"){M.a=M.v.multiplyVector4(M.a);s=M.ms.position.x;r=M.ms.position.y;M.ms.position.x=M.a.x;M.ms.position.y=M.a.y;if(this.lock){var g=new THREE.Vector2();if(!M.parentball){g.x=this.parent.parent.ms.position.x;g.y=this.parent.parent.ms.position.y}else{g.x=M.parentball.ms.position.x;g.y=M.parentball.ms.position.y}M.ms.position.x+=g.x;M.ms.position.y+=g.y}if(this.bk){var G=M.a.z>=this.bk[0]?1:(M.a.z<=this.bk[1]?0:(M.a.z-this.bk[1])/(this.bk[0]-this.bk[1]));M.alpha=(M.btime<10)?(G>M.alpha?M.alpha:G):G}if(this.fout){s=M.a.x;r=M.a.y}else{s=M.ms.position.x-s;r=M.ms.position.y-r}M.ms.position.z=WEHOUCORE.zcounter()}else{if(this.motion=="function"){var L={x:M.ms.position.x,y:M.ms.position.y};this.m_fun(M,E,M.ms.position,this);M.ms.position.z=WEHOUCORE.zcounter();s=M.ms.position.x-L.x;r=M.ms.position.y-L.y}}}}if((!(this.type=="line"))&&this.ms){M.ms.scale.z=M.alpha;if(M.ms.geometry.rep){M.ms.addMatrix.elements[2]=M.ms.geometry.rep[1];M.ms.addMatrix.elements[8]=Math.floor(M.btime/10)%M.ms.geometry.rep[0];if(M.ms.geometry.rep[2]){if(Math.abs(s)>0.3){if(M.ms.adsta<15){M.ms.addMatrix.elements[9]=1;M.ms.addMatrix.elements[8]=Math.floor(M.ms.adsta/5);M.ms.adsta++}else{M.ms.addMatrix.elements[9]=2}}else{if(M.ms.adsta>0){M.ms.addMatrix.elements[9]=1;M.ms.addMatrix.elements[8]=Math.floor(M.ms.adsta/5);M.ms.adsta--}else{M.ms.addMatrix.elements[9]=0}}if(s<0){M.ms.addMatrix.elements[8]+=M.ms.geometry.rep[3];M.ms.addMatrix.elements[9]+=M.ms.geometry.rep[4];M.ms.addMatrix.elements[2]=-M.ms.addMatrix.elements[2]}}}}if(this.rat==1&&this.ms){M.ms.rotation.z=(s!=0?Math.PI/2+Math.atan(r/s):Math.PI);if(this.type=="ball"){M.ms.rotation.z+=Math.PI}if((s>0&&r<0)||(s>=0&&r>=0)){M.ms.rotation.z+=Math.PI}}else{if(this.rat==2&&this.ms){M.ms.rotation.z+=0.1}}var q=0;if(this.type=="line"){M.lms.scale.z=M.alpha;var o=Math.sqrt(s*s+r*r),C=0;var b=new THREE.Vector2(5*r/o,-5*s/o);var F=new THREE.Vector2((M.lms.geometry.vertices[C].x+M.lms.geometry.vertices[C+1].x)/2,(M.lms.geometry.vertices[C].y+M.lms.geometry.vertices[C+1].y)/2);for(C=0;C<this.llong*2-2;C+=2){M.lms.geometry.vertices[C].x=M.lms.geometry.vertices[C+2].x;M.lms.geometry.vertices[C].y=M.lms.geometry.vertices[C+2].y;M.lms.geometry.vertices[C+1].x=M.lms.geometry.vertices[C+3].x;M.lms.geometry.vertices[C+1].y=M.lms.geometry.vertices[C+3].y;var y=new THREE.Vector2((M.lms.geometry.vertices[C+2].x+M.lms.geometry.vertices[C+3].x)/2,(M.lms.geometry.vertices[C+2].y+M.lms.geometry.vertices[C+3].y)/2);if(WEHOUCORE.p2l(WEHOUCORE.lmpos,F,y,5)==1){q=1}F=y}if(M.btime<this.aptime){q=0;M.lms.scale.z=M.alpha<0.5?M.alpha:0.5}M.lms.geometry.vertices[C].x=M.ms.position.x+b.x;M.lms.geometry.vertices[C].y=M.ms.position.y+b.y;M.lms.geometry.vertices[C].z=0;M.lms.geometry.vertices[C+1].x=M.ms.position.x-b.x;M.lms.geometry.vertices[C+1].y=M.ms.position.y-b.y;M.lms.geometry.vertices[C+1].z=0;M.lms.position.z=WEHOUCORE.zcounter();M.lms.geometry.verticesNeedUpdate=true}if(this.type=="laser"&&M.btime>=this.att&&M.ms.geometry.d){var n=WEHOUCORE.a2a(new THREE.Vector2(0,-this.longl*M.ms.scale.y+M.ms.geometry.d+20),M.ms.rotation.z);var h=WEHOUCORE.a2a(new THREE.Vector2(0,-M.ms.geometry.d-20),M.ms.rotation.z);if(WEHOUCORE.p2l(WEHOUCORE.lmpos,new THREE.Vector2(M.ms.position.x+n.x,M.ms.position.y+n.y),new THREE.Vector2(M.ms.position.x+h.x,M.ms.position.y+h.y),M.ms.geometry.d)){q=1}}if(this.type=="self"){var x=WEHOUCORE.nowself.hitlist;for(w=0;w<x.length;w++){var H=false;if(this.islaser){var n=WEHOUCORE.a2a(new THREE.Vector2(0,-this.longl*M.ms.scale.y+M.ms.geometry.d+20),M.ms.rotation.z);var h=WEHOUCORE.a2a(new THREE.Vector2(0,-M.ms.geometry.d-20),M.ms.rotation.z);if(WEHOUCORE.p2l(x[w].position,new THREE.Vector2(M.ms.position.x+n.x,M.ms.position.y+n.y),new THREE.Vector2(M.ms.position.x+h.x,M.ms.position.y+h.y),x[w].hit_dis)){H=true}}else{if(WEHOUCORE.p2p(M.ms.position,x[w].position,x[w].hit_dis,1)){H=true}}if(H){M.btime=this.bt-1;x[w].hit-=this.dmg;WEHOUCORE.deal.hitting();break}}}if(this.type=="enemy"){if(M.ms.hit<0){M.btime=this.bt-1;WEHOUCORE.nowself.delHiter(M.ms);var f=0;if(f=this.item.length){for(var L=0;L<f;L++){WEHOUCORE.nowitem.push([[this.item[L][0],M.ms.position.x,M.ms.position.y,this.item[L][1],this.item[L][2]]])}}}}if(M.bb&&M.bb.length){if(M.bb[2]==5||M.bb[2]==9){this.parent.l[M.bb[0]].p.x=this.parent.l[M.bb[0]].gp.x;this.parent.l[M.bb[0]].p.y=this.parent.l[M.bb[0]].gp.y}else{this.parent.l[M.bb[0]].p.x=M.ms.position.x;this.parent.l[M.bb[0]].p.y=M.ms.position.y}this.parent.l[M.bb[0]].ot=M.bb[1];this.parent.l[M.bb[0]].parentball=M;this.parent.l[M.bb[0]].bread();M.bb[1]++;if(M.bb[2]==1||M.bb[2]==5){M.bb=0}}if((this.cstable?(M.btime>10+this.aptime&&M.alpha>0.95):1)&&(((this.type=="ball"||this.type=="enemy")&&this.ms&&M.ms.geometry.d&&((M.gz=WEHOUCORE.p2p(M.ms.position,WEHOUCORE.lmpos,M.ms.geometry.d,M.gz))==1)))||q==1){if(WEHOUCORE.cheat==0){WEHOUCORE.deal.hit();if((!this.protect)&&(this.type=="ball"||this.type=="enemy")){M.btime=this.bt-1}}else{WEHOUCORE.deal.cheathit();if((!this.protect)&&(this.type=="ball"||this.type=="enemy")){M.btime=this.bt-1}}}M.btime++}else{if(M.btime-this.bt<=10){if(M.btime==this.bt){M.dieflag=true;for(l=0;l<this.deve.length;l++){if(this.deve[l][0]=="bb"){M.bb=[this.deve[l][1][0],this.deve[l][1][1]]}else{if(this.deve[l][0]=="eff"){WEHOUCORE.noweffect.push(this.deve[l][1],M.ms.position.x,M.ms.position.y)}else{this[this.deve[l][0]]=this.deve[l][1]}}}}if(M.bb&&M.bb.length){this.parent.l[M.bb[0]].p.x=M.ms.position.x;this.parent.l[M.bb[0]].p.y=M.ms.position.y;this.parent.l[M.bb[0]].ot=M.bb[1];this.parent.l[M.bb[0]].parentball=M;this.parent.l[M.bb[0]].bread();M.bb[1]++}if((this.type=="ball"||this.type=="enemy")&&this.ms){var K=(10-M.btime+this.bt)*0.1;M.ms.scale.x=K;M.ms.scale.y=K}else{if(this.type=="laser"){M.ms.scale.x=(10-M.btime+this.bt)/10}else{if(this.type=="line"){M.lms.scale.z-=0.1}else{if(this.type=="self"){M.ms.position.y+=(10-M.btime+this.bt)*1;if(M.btime-this.bt==10){M.ms.scale.x=0}}}}}M.btime++}}}for(var E=0;E<this.ballbox.length;){if(this.ballbox[E].btime>this.bt+10){if(this.type=="ball"||this.type=="laser"||this.type=="self"||this.type=="enemy"){var u=this.ballbox.shift().ms;if(this.type=="enemy"){WEHOUCORE.nowself.delHiter(u)}if(this.ms){WEHOUCORE.webgl.scene.remove(u);u.deallocate()}}else{if(this.type=="line"){var u=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(u);u.deallocate()}}}else{break}}return 22};WEHOUCORE.Bb1.prototype.clear=function(g,e,d){var c=this.ballbox.length;for(var f=0;f<c;f++){var b=this.ballbox[f];if(((b.ms.position.x-g.x)*(b.ms.position.x-g.x)+(b.ms.position.y-g.y)*(b.ms.position.y-g.y)<=e*e*d*d)&&this.ballbox[f].btime<=this.bt){this.ballbox[f].btime=this.bt+1}}};WEHOUCORE.Bb1.prototype.clean=function(){var b=this.ballbox.length;for(var d=0;d<b;d++){if(this.type=="ball"||this.type=="laser"||this.type=="enemy"||this.type=="self"){var c=this.ballbox.shift().ms;WEHOUCORE.nowself.delHiter(c);if(this.ms){WEHOUCORE.webgl.scene.remove(c);c.deallocate()}}else{if(this.type=="line"){var c=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(c);c.deallocate()}}}};WEHOUCORE.Bb1.prototype.renew=function(){this.ot=0;this.aall&&(this.aall=[0,0,0,0,0])};WEHOUCORE.Bb2=function(a,b){this.parent=a;this.ms=b.mesh||null;this.rnum=b.numberrandom||0;this.lock=b.locked||false;this.gp=b.position||new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.rp=b.positionrandom||new THREE.Vector2(0,0);this.pl=(b.positionlock===undefined)?true:b.positionlock;this.num=b.number||1;this.ds=b.distance||0;this.bt=b.lifetime||300;this.time=b.period||30;this.ot=0;this.ballbox=new Array();this.alpha=b.alpha||9;this.valpha=b.valpha||0;this.size=b.vsize||new THREE.Vector2(1,1);this.vsize=b.vsize||new THREE.Vector2(0,0);this.asize=b.asize||0;this.angle=b.angle||0;this.rangle=b.anglerandom||0};WEHOUCORE.Bb2.prototype.bread=function(g){var d;if(this.ot%this.time==0){var a=this.num+(this.rnum?-Math.floor(WEHOUCORE.random()*this.rnum):0);var n=(this.rp.x>0),f;if(!n&&this.rp.x){f=-WEHOUCORE.random()*this.rp.x+this.rp.x/2}var h=(this.rp.x>0),e;if(!h&&this.rp.y){e=-WEHOUCORE.random()*this.rp.y+this.rp.y/2}for(var d=0;d<a;d++){var o;if(this.ms){if(!this.ms.position){var b=Math.floor(WEHOUCORE.random()*this.ms.length);o=this.ms[b].clone();o.ms=this.ms[b].ms}else{o=this.ms.clone();if(this.ms.ms){o.ms=this.ms.ms}}}else{o=new Object();o.position=new Object()}o.position.x=this.p.x+(this.rp.x?(n?(WEHOUCORE.random()*this.rp.x-this.rp.x/2):f):0);o.position.y=this.p.y+(this.rp.y?(h?(WEHOUCORE.random()*this.rp.y-this.rp.y/2):e):0);o.position.z=2;o.rotation.z=(this.angle+WEHOUCORE.random()*this.rangle)*Math.PI/180;var c=new WEHOUCORE.Ball(o,new THREE.Vector2(1000,1000),0,0,0,[],this.alpha,this.valpha,this.size,this.vsize.clone());if(this.parentball){c.parentball=this.parentball}this.ballbox.push(c);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}}this.ot++;return 11};WEHOUCORE.Bb2.prototype.going=function(d){for(var b=0;b<this.ballbox.length;b++){var c=this.ballbox[b];c.vsize.x+=this.asize;c.vsize.y+=this.asize;if(c.vsize.x){c.ms.scale.x+=c.vsize.x}if(c.vsize.y){c.ms.scale.y+=c.vsize.y}if(c.valpha){c.alpha+=c.valpha}if(c.alpha>1){c.alpha=1}if(c.alpha<0){c.alpha=0}c.ms.scale.z=c.alpha;c.ms.position.z=WEHOUCORE.zcounter();c.btime++}for(var b=0;b<this.ballbox.length;){if(this.ballbox[b].btime>this.bt){var a=this.ballbox.shift().ms;if(this.ms){WEHOUCORE.webgl.scene.remove(a);a.deallocate()}}else{break}}return 22};WEHOUCORE.Bb2.prototype.clear=function(){var b=this.ballbox.length;for(var c=0;c<b;c++){if(this.ballbox[c].btime<this.bt){this.ballbox[c].btime=this.bt}}};WEHOUCORE.Bb3=function(a,b){this.parent=a;this.ms=b.mesh||null;this.p=b.position||new THREE.Vector2(0,0);this.num=b.number||1;this.getds=b.getdistance||80;this.getv=b.getspeed||8;this.getf=b.getfunction||0;this.ds=b.distance||0;this.ballbox=new Array()};WEHOUCORE.Bb3.prototype.bread=function(d){for(var c=0;c<this.num;c++){var b;if(this.ms){b=this.ms.clone();if(this.ms.ms){b.ms=this.ms.ms}}else{b=new Object();b.position=new Object()}b.position.x=this.p.x-WEHOUCORE.random()*this.ds+this.ds/2;b.position.y=this.p.y-WEHOUCORE.random()*this.ds+this.ds/2;b.position.z=2;var a=new WEHOUCORE.Ball(b,new THREE.Vector2(1000,1000),2,0,0);if(this.parentball){a.parentball=this.parentball}this.ballbox.push(a);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}return 11};WEHOUCORE.Bb3.prototype.going=function(f){for(var c=0;c<this.ballbox.length;c++){var e=this.ballbox[c];if(!e.va){var a=Math.sqrt((e.ms.position.x-WEHOUCORE.lmpos.x)*(e.ms.position.x-WEHOUCORE.lmpos.x)+(e.ms.position.y-WEHOUCORE.lmpos.y)*(e.ms.position.y-WEHOUCORE.lmpos.y));if(f||a<this.getds){e.a=1}if(e.a){e.ms.rotation.z=0;var d=this.getv/a;e.ms.position.x+=(WEHOUCORE.lmpos.x-e.ms.position.x)*d;e.ms.position.y+=(WEHOUCORE.lmpos.y-e.ms.position.y)*d;if(a<20){e.va=1;e.ms.position.x=-2000;this.getf&&this.getf()}}else{if(e.btime<=16){e.ms.rotation.z=(16-e.btime)*0.3}else{if(e.btime<=56){e.v-=0.1}}e.ms.position.y+=e.v;if(e.ms.position.y<-WEHOUCORE.w/2-40){e.va=1;e.ms.position.x=-2000}}}e.ms.position.z=WEHOUCORE.zcounter();e.btime++}for(var c=0;c<this.ballbox.length;){if(this.ballbox[c].va){var b=this.ballbox.shift().ms;if(this.ms){WEHOUCORE.webgl.scene.remove(b);b.deallocate()}}else{break}}return 22};WEHOUCORE.Bb3.prototype.clear=function(){var b=this.ballbox.length;for(var c=0;c<b;c++){this.ballbox[c].va=1}};