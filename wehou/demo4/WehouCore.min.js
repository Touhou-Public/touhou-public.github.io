var WEHOUCORE={};WEHOUCORE.w=500;WEHOUCORE.h=550;WEHOUCORE.time=0;WEHOUCORE.cheat=0;WEHOUCORE.lmpos=new THREE.Vector2(0,-270);WEHOUCORE.bspos=[new THREE.Vector2(0,-350),new THREE.Vector2(0,-350),new THREE.Vector2(0,-350)];WEHOUCORE.webgl={};WEHOUCORE.gameover=0;WEHOUCORE.deal={};WEHOUCORE.deal.graze=function(){};WEHOUCORE.deal.hit=function(){WEHOUCORE.gameover=1};WEHOUCORE.deal.cheathit=function(){};WEHOUCORE.nowstory={};WEHOUCORE.randomseed=new Date().getTime()%1000000;WEHOUCORE.randomuse=0;WEHOUCORE.imglist=[];WEHOUCORE.regimg=function(a){WEHOUCORE.imglist.push(a);return a};WEHOUCORE.random=function(){var a=WEHOUCORE.randomseed+WEHOUCORE.randomuse*178279;a=(a/1000)*(a%1000);var a=a%1000/1000;WEHOUCORE.randomuse++;if(WEHOUCORE.randomuse>100){WEHOUCORE.randomuse=0}return a};WEHOUCORE.initcoreenv=function(c){var b=c.clientWidth;var a=c.clientHeight;WEHOUCORE.webgl.renderer=new THREE.WebGLRenderer({antialias:true});WEHOUCORE.webgl.renderer.setSize(b,a);c.appendChild(WEHOUCORE.webgl.renderer.domElement);WEHOUCORE.webgl.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-30000,30000);WEHOUCORE.webgl.scene=new THREE.Scene()};WEHOUCORE.a2a=function(d,b){var c=new THREE.Vector2();c.x=d.x*Math.cos(b)-d.y*Math.sin(b);c.y=d.x*Math.sin(b)+d.y*Math.cos(b);return c};WEHOUCORE.p2p=function(f,c,b,e){if(b<=0){return 0}var a=(f.x-c.x)*(f.x-c.x)+(f.y-c.y)*(f.y-c.y);if(b==9999){return Math.sqrt(a)}else{if(!e&&(a<b*b+200)){WEHOUCORE.deal.graze();if(a>b*b){return 2}else{return 1}}if(a>b*b){return 0}else{return 1}}};WEHOUCORE.p2l=function(e,h,g,i){var o=WEHOUCORE.p2p(e,h,9999,1),n=WEHOUCORE.p2p(e,g,9999,1),k=WEHOUCORE.p2p(g,h,9999,1),f=0;if(o*o>=n*n+k*k){f=n}else{if(n*n>=o*o+k*k){f=o}else{var q=(o+n+k)/2;q=Math.sqrt(q*(q-o)*(q-n)*(q-k));f=2*q/k}}if(i){if(f>i){return 0}else{return 1}}else{return f}};WEHOUCORE.slowmove=[];WEHOUCORE.slowmove[0]=function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e*e+a}return g/2*((e-=2)*e*e+2)+a};WEHOUCORE.slowmove[1]=function(e,a,g,f){return g*e/f+a};WEHOUCORE.slowmove[2]=function(e,a,g,f){return g*((e=e/f-1)*e*e+1)+a};WEHOUCORE.slowmove[3]=function(e,a,h,g,f){if(f==undefined){f=1.70158}return h*((e=e/g-1)*e*((f+1)*e+f)+1)+a};WEHOUCORE.canvas2mesh=function(c,a,e,d){var b=new THREE.Mesh(new THREE.PlaneGeometry(a||c.width,e||c.height,0,0),new THREE.MeshBasicMaterial({map:new THREE.Texture(c),transparent:true,depthWrite:false,depthTest:false}));b.material.map.needsUpdate=true;return b};WEHOUCORE.imgSet=function(a,c,b){this.l=new Array()};WEHOUCORE.imgSet.prototype.add=function(o,b,g,a){for(var e=0;e<o.length;e++){WEHOUCORE.imglist.push(o[e]);var f=THREE.ImageUtils.loadTexture(o[e]);if(a){f.minFilter=THREE.NearestFilter}var k=new THREE.MeshBasicMaterial({map:f});k.transparent=true;if(b==1){k.blending=THREE.AdditiveBlending}var n=new Array();if(g){for(j=1;j<10;j++){var h=k.clone();h.opacity=0.01*j*j;n.push(h)}}n.push(k);this.l.push(n)}};WEHOUCORE.planeSet=function(){this.l=new Array()};WEHOUCORE.planeSet.prototype.add=function(a,d,b,f){var g=new THREE.PlaneGeometry(a,d,0,0);if(f){if(f.d){g.d=f.d}if(f.rep&&Math.abs(f.rep)>1){g.rep=f.rep;var e=g.vertices[0];g.vertices[0]=g.vertices[1];g.vertices[1]=g.vertices[3];g.vertices[3]=g.vertices[2];g.vertices[2]=e}g.cut=[0,1];if(f.cut&&f.cut.length==4){g.cut=[f.cut[1],f.cut[0]-f.cut[1]];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][1].u=f.cut[0];g.faceVertexUvs[0][0][2].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][3].v=f.cut[2];g.faceVertexUvs[0][0][1].v=g.faceVertexUvs[0][0][2].v=f.cut[3];if(f.rt){g.faceVertexUvs[0][0][1].u=g.faceVertexUvs[0][0][2].u=f.cut[0];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][1].v=f.cut[2];g.faceVertexUvs[0][0][2].v=g.faceVertexUvs[0][0][3].v=f.cut[3]}}if(f.end&&f.end!=0){g.vertices[2].y-=g.vertices[0].y;g.vertices[0].y=0;g.vertices[3].y-=g.vertices[1].y;g.vertices[1].y=0}}var c=new THREE.Mesh(g,b[9]?b[9]:b[0]);c.ms=b;this.l.push(c);return this.l.length-1};WEHOUCORE.bberSet=function(){this.l=new Array()};WEHOUCORE.bberSet.prototype.add=function(b,a){this.l.push(new WEHOUCORE.Bb1(b,a))};WEHOUCORE.lineSet=function(a,b){this.l=new Array();this.bl=b;this.bl.parent=this;this.st=new Array();this.ms=a.mesh||null;this.delms=a.delmesh||true;if(this.ms==null){this.delms=false}this.slx=a.slowx||0;this.sly=a.slowy||0;if(!this.ms){this.ms={};this.ms.position=new THREE.Vector2()}this.times=0;this.alltimes=0;this.player=a.player||"act";this.lt=new THREE.Vector2()};WEHOUCORE.lineSet.prototype.addline=function(a){this.l=this.l.concat(a)};WEHOUCORE.lineSet.prototype.addst=function(a){this.st=this.st.concat(a)};WEHOUCORE.lineSet.prototype.gogogo=function(f){if(this.alltimes&&(this.alltimes==this.l[this.l.length-1])){this.st=[[]];this.l=[0,new THREE.Vector2(-9998,-9998),new THREE.Vector2(0,0),50,new THREE.Vector2(-500,400),new THREE.Vector2(0,0),0];this.t=null;this.times=0}for(var e=3;e<this.l.length-2;e+=3){if(this.times>=this.l[e-3]&&this.times<this.l[e]){if(this.times==this.l[e-3]){this.t=this.t||new THREE.Vector2(this.l[1].x==-9998?this.ms.position.x:this.l[1].x,this.l[1].y==-9998?this.ms.position.y:this.l[1].y);this.lt.x=this.t.x;this.lt.y=this.t.y;this.t.x=(this.l[e+1].x==-9999)?((Math.abs(WEHOUCORE.lmpos.x)<=(WEHOUCORE.w/2-80))?WEHOUCORE.lmpos.x:Math.abs(WEHOUCORE.lmpos.x)/WEHOUCORE.lmpos.x*(WEHOUCORE.w/2-80)):(this.l[e+1].x==-9998)?this.lt.x:this.l[e+1].x;this.t.y=(this.l[e+1].y==-9999)?((Math.abs(WEHOUCORE.lmpos.y)<=(WEHOUCORE.h/2-80))?WEHOUCORE.lmpos.y:Math.abs(WEHOUCORE.lmpos.y)/WEHOUCORE.lmpos.y*(WEHOUCORE.h/2-80)):(this.l[e+1].y==-9998)?this.lt.y:this.l[e+1].y;if(this.l[e+2]){this.t.x+=-WEHOUCORE.random()*(this.l[e+2].x+5)+this.l[e+2].x/2;this.t.y+=-WEHOUCORE.random()*(this.l[e+2].y+5)+this.l[e+2].y/2}}var d=this.st[(e-3)/3];var c=WEHOUCORE.slowmove[this.slx](this.times-this.l[e-3],this.lt.x,this.t.x-this.lt.x,this.l[e]-this.l[e-3]);var a=WEHOUCORE.slowmove[this.sly](this.times-this.l[e-3],this.lt.y,this.t.y-this.lt.y,this.l[e]-this.l[e-3]);this.ms.position.set(c,a,0.75);WEHOUCORE.bspos[f].x=c;WEHOUCORE.bspos[f].y=a;for(var b=0;b<d.length;b++){this.bl.l[d[b]].p.x=this.bl.l[d[b]].pl?this.bl.l[d[b]].gp.x+c:(this.bl.l[d[b]].gp.x>10000?this.bl.l[d[b]].gp.x-20000+WEHOUCORE.lmpos.x:this.bl.l[d[b]].gp.x);this.bl.l[d[b]].p.y=this.bl.l[d[b]].pl?this.bl.l[d[b]].gp.y+a:(this.bl.l[d[b]].gp.y>10000?this.bl.l[d[b]].gp.y-20000+WEHOUCORE.lmpos.y:this.bl.l[d[b]].gp.y);this.bl.l[d[b]].bread()}break}}for(var e=0;e<this.bl.l.length;e++){this.bl.l[e].going(f*20+e)}if(this.ms[this.player]){this.ms[this.player]()}this.times++;this.alltimes++;if(this.times>this.l[this.l.length-4]){this.times=0}};WEHOUCORE.lineSet.prototype.show=function(){if(this.ms){WEHOUCORE.webgl.scene.add(this.ms)}};WEHOUCORE.lineSet.prototype.clear=function(){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clear()}};WEHOUCORE.lineSet.prototype.clean=function(){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clean()}if(this.delms){WEHOUCORE.webgl.scene.remove(this.ms);this.ms.deallocate()}};WEHOUCORE.selfSet=function(){this.l=new Array();this.useGroup=0};WEHOUCORE.selfSet.prototype.add=function(c){var a=new WEHOUCORE.bberSet();for(var b=0;b<c.length;b++){a.add(a,c[b])}this.l.push(a)};WEHOUCORE.selfSet.prototype.runGroup=function(a){var d=this.l[this.useGroup];for(var c=0;c<d.l.length;c++){if(a){d.l[c].p.x=d.l[c].gp.x+WEHOUCORE.lmpos.x;d.l[c].p.y=d.l[c].gp.y+WEHOUCORE.lmpos.y;d.l[c].bread()}d.l[c].going(1000)}};WEHOUCORE.storySet=function(a){this.name=a;this.l=new Array();this.s=new Array();this.t=0};WEHOUCORE.storySet.prototype.setName=function(a){this.name=a};WEHOUCORE.storySet.prototype.add=function(g,f,e,d){var b=new WEHOUCORE.bberSet();for(var c=0;c<f.length;c++){b.add(b,f[c])}var a=new WEHOUCORE.lineSet(g,b);a.addline(e);a.addst(d);this.l.push(a)};WEHOUCORE.storySet.prototype.adds=function(a){this.s=this.s.concat(a)};WEHOUCORE.storySet.prototype.actlist=new Array();WEHOUCORE.storySet.prototype.deal=function(c){WEHOUCORE.nowstory=this;this.t=c;for(var b=0;b<this.s.length-3;b+=3){if(c>=this.s[b]&&c<this.s[b+3]){break}}for(var a=0;a<this.s[b+1].length;a++){if(c==this.s[b]){this.l[this.s[b+1][a]].show();this.l[this.s[b+1][a]].gogogo(a)}else{if(c==this.s[b+3]-14){this.l[this.s[b+1][a]].clear()}else{if(c==this.s[b+3]-1){this.l[this.s[b+1][a]].clean()}else{this.l[this.s[b+1][a]].gogogo(a)}}}}for(var a=0;a<this.s[b+2].length;a+=2){if(this.s[b+2][a]==9999){WEHOUCORE.lmpos.x=9999;WEHOUCORE.gameover=1}else{this.actlist[this.s[b+2][a]](this.s[b+2][a+1],c,this.s[b])}}};WEHOUCORE.storySet.prototype.storyCT=function(a){if(a=="jumpnext"){for(var b=0;b<this.s.length-3;b+=3){if(WEHOUCORE.time>=this.s[b]&&WEHOUCORE.time<this.s[b+3]){break}}WEHOUCORE.time=this.s[b+3]-15}};WEHOUCORE.Ball=function(e,d,c,f,b,h){this.ms=e;this.bp=new THREE.Vector2(this.ms.position.x,this.ms.position.y);this.t=new THREE.Vector2(d.x-this.bp.x,d.y-this.bp.y);var g=Math.sqrt((this.t.x)*(this.t.x)+(this.t.y)*(this.t.y));this.t.x=(this.t.x)*this.tdis/g+this.bp.x;this.t.y=(this.t.y)*this.tdis/g+this.bp.y;this.v=c;this.va=f;this.a=b;this.btime=0;this.bb=h||[];this.gz=0};WEHOUCORE.Ball.prototype.tdis=3600;WEHOUCORE.Bb1=function(a,b){this.parent=a;this.type=b.type||"ball";if(this.type=="line"){this.lmat=b.linematerial||null;this.cut=b.materialcut||[0,1];this.llong=b.linelong||50;this.ms=null}else{if(this.type=="laser"){this.ms=b.mesh||null;this.longl=Math.abs(this.ms.geometry.vertices[2].y);this.shortl=Math.abs(this.ms.geometry.vertices[0].x)*2;this.att=(b.appearline==undefined)?30:b.appearline;if(this.att<=10){this.att=0}this.rnum=b.numberrandom||0;this.lock=b.locked||false;this.rat=1}else{this.ms=b.mesh||null;this.rnum=b.numberrandom||0;this.lock=b.locked||false;this.rat=b.rotating||1;this.outer=b.outfield||false}}this.gp=b.position||new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.rp=b.positionrandom||new THREE.Vector2(0,0);this.pl=(b.positionlock===undefined)?true:b.positionlock;this.t=b.target||WEHOUCORE.lmpos;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}this.rt=b.targetrandom||0;this.num=b.number||1;this.ne=b.numberchange||[0,0];if(this.lock){this.changep=new THREE.Vector2(0,0)}this.angle=b.angle||[-360];this.aoff=b.angleoffset||0;this.aall=[0,0,0,0,0];this.v=b.speed||[3];this.ve=b.speedchange||[0,0];this.va=b.palstance||[0];this.a=b.acceleration||[0];this.rangle=b.anglerandom||0;this.tangle=b.anglefactor||[];this.ae=b.anglechange||[0,0];this.rv=b.speedrandom||0;this.rva=b.palstancerandom||0;this.rvauto=b.autopalstance||false;this.ds=b.distance||0;this.bt=b.lifetime||300;this.time=b.period||30;this.ot=0;this.toff=b.timeoffset||0;this.ballbox=new Array();this.event=b.bulletevents||[];this.myeve=b.myevents||[];WEHOUCORE.Bb1.prototype.bread=function(r){var k;if((this.ot-this.toff>=0)&&(this.ot-this.toff)%this.time==0){var g=new THREE.Vector2();g.x=this.t.x;g.y=this.t.y;if(g.x==30000){g.x=this.parentball.t.x}if(g.y==30000){g.y=this.parentball.t.y}g.sub(g,this.p);if(Math.abs(g.x)<2&&Math.abs(g.y)<2){g.y=-100}var c=this.num+(this.rnum?-Math.floor(WEHOUCORE.random()*this.rnum):0)+Math.floor(this.aall[2]);var v=(this.rp.x>0),q;if(!v&&this.rp.x){q=-WEHOUCORE.random()*this.rp.x+this.rp.x/2}var t=(this.rp.x>0),o;if(!t&&this.rp.y){o=-WEHOUCORE.random()*this.rp.y+this.rp.y/2}for(var k=0;k<c;k++){if(this.ms){if(!this.ms.position){var d=Math.floor(WEHOUCORE.random()*this.ms.length);var u=this.ms[d].clone();u.ms=this.ms[d].ms}else{var u=this.ms.clone();u.ms=this.ms.ms}}else{var u=new Object();u.position=new Object()}u.position.x=this.p.x+(this.rp.x?(v?(WEHOUCORE.random()*this.rp.x-this.rp.x/2):q):0);u.position.y=this.p.y+(this.rp.y?(t?(WEHOUCORE.random()*this.rp.y-this.rp.y/2):o):0);u.position.z=2;if(g.x>=10000){g.x=u.position.x+g.x-20000}if(g.y>=10000){g.y=u.position.y+g.y-20000}var s=0,w;if(this.angle.length==1&&this.angle[0]<0){w=[(-this.angle[0])/c]}else{w=this.angle}if(c%2==1){if(k==(c-1)/2){s=0}else{if(k<(c-1)/2){for(j=k;j<(c-1)/2;j++){s+=(w[j]===undefined?w[0]:w[j])}}else{if(k>(c-1)/2){for(j=k-1;j>(c-1)/2-1;j--){s-=(w[j]===undefined?w[0]:w[j])}}}}}else{if(k<c/2){for(j=k;j<=c/2-1;j++){s+=(w[j]===undefined?w[0]:w[j]);if(j==c/2-1){s-=(w[j]===undefined?w[0]:w[j])/2}}}else{if(k>=c/2){for(j=k-1;j>=c/2-1;j--){s-=(w[j]===undefined?w[0]:w[j]);if(j==c/2-1){s+=(w[j]===undefined?w[0]:w[j])/2}}}}}s+=this.rangle?Math.floor(WEHOUCORE.random()*this.rangle-this.rangle/2):0;s+=this.aall[0];s+=this.aoff;if(this.tangle.length){s+=Math.sin(WEHOUCORE.time/this.tangle[0])*this.tangle[1]}var h=WEHOUCORE.a2a(g,s/180*Math.PI);h.add(h,this.p);this.rt?h.add(h,new THREE.Vector2(WEHOUCORE.random()*this.rt-this.rt/2,WEHOUCORE.random()*this.rt-this.rt/2)):0;var f=new WEHOUCORE.Ball(u,h,(this.v[k]||this.v[0])+this.aall[1]+(this.rv?(WEHOUCORE.random()*this.rv-this.rv/2):0),(this.va[k]||this.va[0])+(this.rva?(WEHOUCORE.random()*this.rva-this.rva/2):0),this.a[k]||this.a[0]);if(this.type=="line"){var n=new THREE.PlaneGeometry(1,1,0,this.llong-1);for(m=0;m<this.llong*2;m++){n.vertices[m].x=f.bp.x;n.vertices[m].y=f.bp.y}for(m=0;m<this.llong-1;m++){var e=n.faceVertexUvs[0][m];for(p=0;p<2;p++){e[p].u=e[p].v;e[p].v=this.cut[0]}for(p=2;p<4;p++){e[p].u=e[p].v;e[p].v=this.cut[1]}}f.lms=new THREE.Mesh(n,this.lmat[9]);f.lms.ms=this.lmat;f.lms.position.z=20;f.lms.geometry.uvsNeedUpdate=true;f.lms.geometry.verticesNeedUpdate=true;f.lms.geometry.dynamic=true;WEHOUCORE.webgl.scene.add(f.lms)}if(this.lock){f.lockp=new THREE.Vector2(f.ms.position.x,f.ms.position.y);f.changp=new THREE.Vector2(0,0)}if(this.parentball){f.parentball=this.parentball}this.ballbox.push(f);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}this.aall[0]+=this.ae[0];if((this.ae[0]>0&&this.aall[0]>this.ae[1])||(this.ae[0]<0&&this.aall[0]<this.ae[1])){this.aall[0]=0}this.aall[1]+=this.ve[0];if((this.ve[0]>0&&this.aall[1]>this.ve[1])||(this.ve[0]<0&&this.aall[1]<this.ve[1])){this.aall[1]=0}this.aall[2]+=this.ne[0];if((this.ne[0]>0&&this.aall[2]>this.ne[1])||(this.ne[0]<0&&this.aall[2]<this.ne[1])){this.aall[2]=0}}for(l=0;l<this.myeve.length;l++){if(this.ot==this.myeve[l][0]){if(this.myeve[l][1]=="t"){this.t.x=this.myeve[l][2].x;this.t.y=this.myeve[l][2].y;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}}else{this[this.myeve[l][1]]=this.myeve[l][2]}}}this.ot++;return 11};WEHOUCORE.Bb1.prototype.going=function(e){if(this.ms&&this.ms.geometry&&this.ms.geometry.rep&&WEHOUCORE.time%10==0){var x=Math.abs(this.ms.geometry.rep),g=this.ms.geometry.cut;this.ms.geometry.faceVertexUvs[0][0][0].u=this.ms.geometry.faceVertexUvs[0][0][1].u=((WEHOUCORE.time/10)%x+1)/x*g[1]+g[0];this.ms.geometry.faceVertexUvs[0][0][3].u=this.ms.geometry.faceVertexUvs[0][0][2].u=((WEHOUCORE.time/10)%x)/x*g[1]+g[0];this.ms.geometry.uvsNeedUpdate=true}for(var B=0;B<this.ballbox.length;B++){var G=this.ballbox[B];if(G.btime<this.bt){if(this.outer&&(G.ms.position.x>(WEHOUCORE.w/2+30)||G.ms.position.x<-(WEHOUCORE.w/2+30)||G.ms.position.y>(WEHOUCORE.h/2+30)||G.ms.position.y<-(WEHOUCORE.h/2+30))){G.btime=this.bt+11;if(this.ms){G.ms.scale.x=0;G.ms.scale.y=0}continue}for(l=0;l<this.event.length;l++){if(this.event[l][0]=="t"?G.btime==this.event[l][1]:this.event[l][0]=="-x"?G.ms.position.x<=(this.event[l][1]==29999?WEHOUCORE.lmpos.x:this.event[l][1]):this.event[l][0]=="+x"?G.ms.position.x>=(this.event[l][1]==29999?WEHOUCORE.lmpos.x:this.event[l][1]):this.event[l][0]=="+y"?G.ms.position.y>=(this.event[l][1]==29999?WEHOUCORE.lmpos.y:this.event[l][1]):this.event[l][0]=="-y"?G.ms.position.y<=(this.event[l][1]==29999?WEHOUCORE.lmpos.y:this.event[l][1]):this.event[l][0]=="nt"?G.btime&&((G.btime-this.event[l][1][1])%this.event[l][1][0])==0:this.event[l][0]=="ds"&&(!G.gds)?WEHOUCORE.p2p(G.ms.position,this.event[l][1][0],this.event[l][1][1],1)==1&&(G.gds=1):this.event[l][0]=="-ds"&&(!G.gds)?!(WEHOUCORE.p2p(G.ms.position,this.event[l][1][0],this.event[l][1][1],1)==1)&&(G.gds=1):this.event[l][0]=="ft"?G.parentball.btime==this.event[l][1]:0){var H=this.event[l][2];for(A=0;A<H.length;A+=3){if(H[A]=="a"){G.a=H[A+1]+WEHOUCORE.random()*H[A+2]-H[A+2]/2}else{if(H[A]=="v"){G.v=H[A+1]+WEHOUCORE.random()*H[A+2]-H[A+2]/2}else{if(H[A]=="va"){G.va=H[A+1]+WEHOUCORE.random()*H[A+2]-H[A+2]/2}else{if(H[A]=="t"){G.t=H[A+1].clone();if(G.t.x>=10000){if(G.t.x==29999){G.t.x=G.ms.position.x+WEHOUCORE.lmpos.x-G.bp.x}else{G.t.x=G.ms.position.x+G.t.x-20000}}if(G.t.y>=10000){if(G.t.y==29999){G.t.y=G.ms.position.y+WEHOUCORE.lmpos.y-G.bp.y}else{G.t.y=G.ms.position.y+G.t.y-20000}}G.bp.x=G.ms.position.x;G.bp.y=G.ms.position.y;H[A+2].x?(G.t.x+=+WEHOUCORE.random()*H[A+2].x-H[A+2].x/2):0;H[A+2].y?(G.t.y+=+WEHOUCORE.random()*H[A+2].y-H[A+2].y/2):0;G.t.sub(G.t,G.ms.position);var y=Math.sqrt((G.t.x)*(G.t.x)+(G.t.y)*(G.t.y));G.t.x=(G.t.x)*G.tdis/y+G.ms.position.x;G.t.y=(G.t.y)*G.tdis/y+G.ms.position.y}else{if(H[A]=="ms"){var z=G.ms.position.clone();WEHOUCORE.webgl.scene.remove(G.ms);G.ms.deallocate();G.ms=H[A+1].clone();G.ms.ms=H[A+1].ms;G.ms.position=z;WEHOUCORE.webgl.scene.add(G.ms)}else{if(H[A]=="bb"){if(H[A+1]){G.bb=[H[A+1][0],H[A+1][1]];this.parent.l[G.bb[0]].p.x=G.ms.position.x;this.parent.l[G.bb[0]].p.y=G.ms.position.y;if(H[A+2]){G.bb[2]=H[A+2]}}else{G.bb=0}}else{if(H[A]=="-x"){if(!G.gx){if(this.event[l][0]=="+x"||this.event[l][0]=="-x"){G.ms.position.x=this.event[l][1]*2-G.ms.position.x;G.t.x=2*this.event[l][1]-G.t.x;G.bp.x=2*this.event[l][1]-G.bp.x}else{G.t.x=2*G.ms.position.x-G.t.x;G.bp.x=2*G.ms.position.x-G.bp.x}G.gx=1}}else{if(H[A]=="-y"){if(!G.gy){if(this.event[l][0]=="+y"||this.event[l][0]=="-y"){G.ms.position.y=this.event[l][1]*2-G.ms.position.y;G.t.y=2*this.event[l][1]-G.t.y;G.bp.y=2*this.event[l][1]-G.bp.y}else{G.t.y=2*G.ms.position.y-G.t.y;G.bp.y=2*G.ms.position.y-G.bp.y}G.gy=1}}else{if(H[A]=="jumpnext"){WEHOUCORE.nowstory.storyCT("jumpnext")}else{G[H[A]]=H[A+1]}}}}}}}}}}}}G.v+=G.a;var v=0;if(G.btime==0){v=this.ds}if(G.btime<10&&this.ms&&this.type!="laser"){var F=3-(G.btime+1)*0.2;G.ms.material=G.ms.ms[G.btime];G.ms.scale.x=F;G.ms.scale.y=F}if(this.type=="laser"&&(this.att==0)&&G.btime*this.v[0]<=this.longl){G.ms.scale.y=G.btime*G.v/this.longl}else{if(this.type=="laser"&&(this.att>0)&&G.btime==0){G.ms.scale.x=0}else{if(this.type=="laser"&&(this.att>0)&&G.btime==1){G.ms.scale.x=4/this.shortl}else{if(this.type=="laser"&&(this.att>0)&&G.btime>this.att-10&&G.btime<this.att){G.ms.scale.x=(10-this.att+G.btime)/10}else{if(this.type=="laser"&&(this.att>0)&&G.btime==this.att){G.ms.scale.x=1}}}}}if(this.lock){G.ms.position.x-=G.changp.x;G.ms.position.y-=G.changp.y}G.t.sub(G.t,G.bp);var s=(G.t.x)*(G.v+v)/G.tdis,q=(G.t.y)*(G.v+v)/G.tdis;G.ms.position.x+=s?s:0;G.ms.position.y+=q?q:0;G.ms.position.z=2+e*100+B*0.1;if(G.va){if(G.va>1000){var E=G.va-2000;var c=new THREE.Vector2(G.t.x,G.t.y);G.t=WEHOUCORE.a2a(G.t,E/180*Math.PI);c.sub(G.t,c);c.multiplyScalar(Math.sqrt((G.ms.position.x-G.bp.x)*(G.ms.position.x-G.bp.x)+(G.ms.position.y-G.bp.y)*(G.ms.position.y-G.bp.y))/G.tdis);G.ms.position.x+=c.x;G.ms.position.y+=c.y;s+=c.x;q+=c.y}else{var D=0;if(this.rvauto){var f=(G.t.x-WEHOUCORE.lmpos.x)*(G.ms.position.y-WEHOUCORE.lmpos.y)-(G.t.y-WEHOUCORE.lmpos.y)*(G.ms.position.x-WEHOUCORE.lmpos.x);if(f>0){D=-G.va}else{if(f<0){D=G.va}}}else{D=G.va}G.t=WEHOUCORE.a2a(G.t,D/180*Math.PI)}}if(this.lock){G.t.add(G.t,G.bp)}else{G.t.add(G.t,G.bp)}if(this.rat&&this.ms){G.ms.rotation.z=(s!=0?Math.PI/2+Math.atan(q/s):Math.PI);if(this.type=="ball"){G.ms.rotation.z+=Math.PI}if((s>0&&q<0)||(s>=0&&q>=0)){G.ms.rotation.z+=Math.PI}}if(this.rat==2&&this.ms){G.ms.rotation.z+=G.btime/Math.PI/10}if(this.lock){if(!G.parentball){G.changp.x=this.parent.parent.ms.position.x-G.lockp.x;G.changp.y=this.parent.parent.ms.position.y-G.lockp.y}else{G.changp.x=G.parentball.ms.position.x-G.lockp.x;G.changp.y=G.parentball.ms.position.y-G.lockp.y}G.ms.position.x+=G.changp.x;G.ms.position.y+=G.changp.y}var o=0;if(this.type=="line"){var n=Math.sqrt(s*s+q*q),A=0;var d=new THREE.Vector2(5*q/n,-5*s/n);var C=new THREE.Vector2((G.lms.geometry.vertices[A].x+G.lms.geometry.vertices[A+1].x)/2,(G.lms.geometry.vertices[A].y+G.lms.geometry.vertices[A+1].y)/2);for(A=0;A<this.llong*2-2;A+=2){G.lms.geometry.vertices[A].x=G.lms.geometry.vertices[A+2].x;G.lms.geometry.vertices[A].y=G.lms.geometry.vertices[A+2].y;G.lms.geometry.vertices[A].z=G.lms.geometry.vertices[A+2].z;G.lms.geometry.vertices[A+1].x=G.lms.geometry.vertices[A+3].x;G.lms.geometry.vertices[A+1].y=G.lms.geometry.vertices[A+3].y;G.lms.geometry.vertices[A+1].z=G.lms.geometry.vertices[A+3].z;var w=new THREE.Vector2((G.lms.geometry.vertices[A+2].x+G.lms.geometry.vertices[A+3].x)/2,(G.lms.geometry.vertices[A+2].y+G.lms.geometry.vertices[A+3].y)/2);if(WEHOUCORE.p2l(WEHOUCORE.lmpos,C,w,5)==1){o=1}C=w}G.lms.geometry.vertices[A].x=G.ms.position.x+d.x;G.lms.geometry.vertices[A].y=G.ms.position.y+d.y;G.lms.geometry.vertices[A].z=0;G.lms.geometry.vertices[A+1].x=G.ms.position.x-d.x;G.lms.geometry.vertices[A+1].y=G.ms.position.y-d.y;G.lms.geometry.vertices[A+1].z=0;G.lms.position.z=2+e*100+B*0.1;G.lms.geometry.verticesNeedUpdate=true}if(this.type=="laser"&&G.btime>=this.att){var k=WEHOUCORE.a2a(new THREE.Vector2(0,-this.longl*G.ms.scale.y+G.ms.geometry.d+20),G.ms.rotation.z);var h=WEHOUCORE.a2a(new THREE.Vector2(0,-G.ms.geometry.d-20),G.ms.rotation.z);if(WEHOUCORE.p2l(WEHOUCORE.lmpos,new THREE.Vector2(G.ms.position.x+k.x,G.ms.position.y+k.y),new THREE.Vector2(G.ms.position.x+h.x,G.ms.position.y+h.y),G.ms.geometry.d)){o=1}}if(G.bb&&G.bb.length){if(G.bb[2]==5||G.bb[2]==9){this.parent.l[G.bb[0]].p.x=this.parent.l[G.bb[0]].gp.x;this.parent.l[G.bb[0]].p.y=this.parent.l[G.bb[0]].gp.y}else{this.parent.l[G.bb[0]].p.x=G.ms.position.x;this.parent.l[G.bb[0]].p.y=G.ms.position.y}this.parent.l[G.bb[0]].ot=G.bb[1];this.parent.l[G.bb[0]].parentball=G;this.parent.l[G.bb[0]].bread();G.bb[1]++;if(G.bb[2]==1||G.bb[2]==5){G.bb=0}}if(G.btime>10&&((this.type=="ball"&&this.ms&&G.ms.geometry.d&&((G.gz=WEHOUCORE.p2p(G.ms.position,WEHOUCORE.lmpos,G.ms.geometry.d,G.gz))==1)))||o==1){if(WEHOUCORE.cheat==0){WEHOUCORE.deal.hit();if(this.type=="ball"){G.btime=this.bt-1}}else{WEHOUCORE.deal.cheathit();if(this.type=="ball"){G.btime=this.bt-1}}}G.btime++}else{if(G.btime-this.bt<=10){if(this.type=="ball"&&this.ms){var F=(10-G.btime+this.bt)*0.1;G.ms.scale.x=F;G.ms.scale.y=F}else{if(this.type=="laser"){G.ms.scale.x=(10-G.btime+this.bt)/10}else{if(this.type=="line"){G.lms.material=G.lms.ms[9-((G.btime-this.bt)<10?(G.btime-this.bt):9)]}}}G.btime++}}}for(var B=0;B<this.ballbox.length;){if(this.ballbox[B].btime>this.bt+10){if(this.type=="ball"||this.type=="laser"){var u=this.ballbox.shift().ms;if(this.ms){WEHOUCORE.webgl.scene.remove(u);u.deallocate()}}else{if(this.type=="line"){var u=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(u);u.deallocate()}}}else{break}}return 22};WEHOUCORE.Bb1.prototype.clear=function(){var c=this.ballbox.length;for(var d=0;d<c;d++){if(this.ballbox[d].btime<this.bt){this.ballbox[d].btime=this.bt}}};WEHOUCORE.Bb1.prototype.clean=function(){var c=this.ballbox.length;for(var e=0;e<c;e++){if(this.type=="ball"||this.type=="laser"){var d=this.ballbox.shift().ms;if(this.ms){WEHOUCORE.webgl.scene.remove(d);d.deallocate()}}else{if(this.type=="line"){var d=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(d);d.deallocate()}}}}};