var WEHOUGAME={};WEHOUGAME.renderintime=2;WEHOUGAME.gotime=0;WEHOUGAME.power=0;WEHOUGAME.graze=0;WEHOUGAME.miss=0;WEHOUGAME.misscd=0;WEHOUGAME.misscut=0;WEHOUGAME.timecut=0;WEHOUGAME.score=0;WEHOUGAME.topscore=0;WEHOUGAME.hiscore=0;WEHOUGAME.kd=[];WEHOUGAME.inrep=false;WEHOUGAME.repdata;WEHOUGAME.tempcanvas=new Array();WEHOUGAME.tempmesh=new Array();WEHOUGAME.myplalist=new WEHOUCORE.planeSet();WEHOUGAME.myimglist=new WEHOUCORE.imgSet();WEHOUGAME.myplalistbre=new WEHOUCORE.planeSet();WEHOUGAME.myimglistbre=new WEHOUCORE.imgSet();WEHOUGAME.myplalistbos=new WEHOUCORE.planeSet();WEHOUGAME.myimglistbos=new WEHOUCORE.imgSet();WEHOUGAME.mymusiclist=new Array();WEHOUGAME.myselist=new Array();WEHOUGAME.mainstory=new WEHOUCORE.storySet("unknown");WEHOUGAME.selfcont=new WEHOUCORE.selfSet();WEHOUGAME.addBulletImg=function(b,a){WEHOUGAME.myimglistbre.add(b,a===undefined?1:a,1,1)};WEHOUGAME.getBulletImg=function(a){return WEHOUGAME.myimglistbre.l[a]};WEHOUGAME.addBullet=function(c,b,f,j,e,i,g,a){WEHOUGAME.myplalistbre.add(b,f,c,{d:j,end:(e=="laser"?1:0),rep:i||1,cut:(g?g:null),rt:(a?1:0)})};WEHOUGAME.getBullet=function(a){return WEHOUGAME.myplalistbre.l[a]};WEHOUGAME.addBossImg=function(a){WEHOUGAME.myimglistbos.add(a,0,0)};WEHOUGAME.getBossImg=function(a){return WEHOUGAME.myimglistbos.l[a]};WEHOUGAME.addBoss=function(b,a,c,d){var e=WEHOUGAME.myplalistbos.add(a,c,b,{cut:d});WEHOUGAME.myplalistbos.l[e].add(WEHOUGAME.myplalist.l[0].clone());WEHOUGAME.myplalistbos.l[e].act=function(){var f=Math.sin(WEHOUCORE.time/50)*0.4;var g=this.children[0];g.rotation.z+=0.1;g.scale.x=2.2+f;g.scale.y=2.2+f};WEHOUGAME.myplalistbos.l[e].end=function(){var f=this.children[0];f.rotation.z+=0.1;f.scale.x+=0.05;f.scale.y+=0.05;if(f.material.opacity>0){f.material.opacity-=0.005}}};WEHOUGAME.getBoss=function(a){return WEHOUGAME.myplalistbos.l[a]};WEHOUGAME.addMusic=function(b,a){var c=new Audio(b);if(a){c.loop=1}WEHOUGAME.mymusiclist.push(c)};WEHOUGAME.getMusic=function(a){return WEHOUGAME.mymusiclist[a]};WEHOUGAME.addSe=function(b,a){var c=new Audio(b);c.volume=0.5;if(a){c.loop=1}WEHOUGAME.myselist.push(c)};WEHOUGAME.getSe=function(a){return WEHOUGAME.myselist[a]};WEHOUGAME.userInt=function(){};WEHOUGAME.intGame=function(e){e.innerHTML+="<div id='canvas-core' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0;left:0;'></div><div id='canvas-ui' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0;left:0;'></div><div id='loadmsg'>加载基础代码中</div>";e.innerHTML+="<div id='hiscore' style='position:absolute;top:64px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#aaa;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='topscore' style='position:absolute;top:97px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#ddd;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='score' style='position:absolute;top:130px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#ddd;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='misscut' style='position:absolute;top:166px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#9f9;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div></div><div id='miss' style='position:absolute;top:202px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#f99;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div>";if(!document.createElement("canvas").getContext("experimental-webgl")){alert("你的浏览器并不能很好的支持本游戏。\n请更换为chrome");WEHOUCORE.time=-10}WEHOUCORE.initcoreenv(document.getElementById("canvas-core"));var e=document.getElementById("canvas-ui");var d=e.clientWidth;var a=e.clientHeight;WEHOUGAME.ui={};WEHOUGAME.ui.renderer=new THREE.WebGLRenderer({antialias:true});WEHOUGAME.ui.renderer.setSize(d,a);e.appendChild(WEHOUGAME.ui.renderer.domElement);WEHOUGAME.ui.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-20000,20000);WEHOUGAME.ui.camera.lookAt(new THREE.Vector3(0,0,0));WEHOUGAME.ui.scene=new THREE.Scene();WEHOUGAME.myimglist.add(["img/sysimg_01.png"],1,0);WEHOUGAME.myimglist.add(["img/img_player.png"],0,0);WEHOUGAME.addSe("se/se_pldead00.ogg",0);WEHOUGAME.myplalist.add(108,108,WEHOUGAME.myimglist.l[0],{cut:[0,1/4,5/8,7/8]});WEHOUGAME.myplalist.l[0].position.set(0,0,-2000);WEHOUGAME.myplalist.add(40,50,WEHOUGAME.myimglist.l[1]);WEHOUGAME.myplalist.add(77,77,WEHOUGAME.myimglist.l[0],{cut:[0,1/8,7/8,1]});WEHOUGAME.myplalist.l[2].position.set(0,0,20000);WEHOUGAME.myplalist.add(55,55,WEHOUGAME.myimglist.l[0],{cut:[1/8,1/4,7/8,1]});WEHOUGAME.myplalist.l[3].position.set(0,0,-500);WEHOUGAME.myplalist.l[1].add(WEHOUGAME.myplalist.l[2]);WEHOUGAME.myplalist.l[1].add(WEHOUGAME.myplalist.l[3]);WEHOUCORE.webgl.scene.add(WEHOUGAME.myplalist.l[1]);my2dpiclist=new Array();var c=new Image();c.src=WEHOUCORE.regimg("img/sysimg_01.png");my2dpiclist.push(c);c=new Image();c.src=WEHOUCORE.regimg("img/imgend.png");my2dpiclist.push(c);WEHOUGAME.tempcanvas[0]=document.createElement("canvas");WEHOUGAME.tempcanvas[0].width=455;WEHOUGAME.tempcanvas[0].height=40;WEHOUGAME.tempmesh[0]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[0]);WEHOUGAME.tempcanvas[1]=document.createElement("canvas");WEHOUGAME.tempcanvas[1].width=280;WEHOUGAME.tempcanvas[1].height=100;WEHOUGAME.tempmesh[1]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[1]);WEHOUGAME.tempcanvas[2]=document.createElement("canvas");WEHOUGAME.tempcanvas[2].width=300;WEHOUGAME.tempcanvas[2].height=50;WEHOUGAME.tempmesh[2]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[2]);WEHOUGAME.tempcanvas[3]=document.createElement("canvas");WEHOUGAME.tempcanvas[3].width=300;WEHOUGAME.tempcanvas[3].height=300;WEHOUGAME.tempmesh[3]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[3]);WEHOUGAME.tempcanvas[4]=document.createElement("canvas");WEHOUGAME.tempcanvas[4].width=500;WEHOUGAME.tempcanvas[4].height=550;WEHOUGAME.tempmesh[4]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[4]);WEHOUGAME.tempcanvas[5]=document.createElement("canvas");WEHOUGAME.tempcanvas[5].width=280;WEHOUGAME.tempcanvas[5].height=100;WEHOUGAME.tempmesh[5]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[5]);var b=WEHOUGAME.tempcanvas[4].getContext("2d");b.font="bold 40px 黑体";b.textBaseline="hanging";b.textAlign="center";b.fillStyle="rgba(255,255,255,1)";b.lineWidth=2;b.strokeText("少女加载中",200,240);b.fillText("少女加载中",200,240);WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[4]);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);WEHOUGAME.userInt();var c=new Image();c.src=WEHOUCORE.regimg("img/imgload.png");c.onload=function(){var i=function(){var j=WEHOUGAME.tempcanvas[4].getContext("2d");j.clearRect(0,0,500,550);j.drawImage(c,0,0,500,550);WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);var l=function(o){o.stopPropagation();o.preventDefault();inrepstart=1;var n=new FileReader();n.readAsDataURL(o.dataTransfer.files[0]);n.onload=function(s){var r=this.result;var q=WEHOUGAME.tempcanvas[3].getContext("2d");var p=new Image();p.src=r;p.onload=function(){q.drawImage(p,0,0);WEHOUGAME.repdata=q.getImageData(0,0,300,300);var t="",u="";for(k=0;WEHOUGAME.repdata.data[k*2+10]!=255;k++){t+=String.fromCharCode(WEHOUGAME.repdata.data[k*2+10])}for(k=0;WEHOUGAME.repdata.data[k*2+64]!=255;k++){u+=String.fromCharCode(WEHOUGAME.repdata.data[k*2+64])}var v=WEHOUGAME.repdata.data[256-6]*65536+WEHOUGAME.repdata.data[256-4]*256+WEHOUGAME.repdata.data[256-2]*1;WEHOUCORE.randomseed=v;WEHOUGAME.inrep=true;if(t==WEHOUGAME.mainstory.name){alert("游戏地图为"+t+"的机师为"+u+"的一个replay加载成功")}else{alert("replay加载成功,但本游戏地图（"+WEHOUGAME.mainstory.name+"）与存档（"+t+"）不对应")}WEHOUGAME.gamestart()}};return false};var m=function(n){n.stopPropagation();n.preventDefault()};document.getElementById("canvas-ui").addEventListener("drop",l,false);document.getElementById("canvas-ui").addEventListener("dragover",m,false);document.body.onkeydown=function(n){if(n.keyCode==90){WEHOUGAME.gamestart()}else{if(n.keyCode==67){WEHOUCORE.cheat=1}}}};var g=WEHOUCORE.imglist;var h=document.getElementById("loadmsg");h.innerHTML="0/"+g.length;var f=function(l){if(l<=g.length){h.innerHTML=l+"/"+g.length;var j=new Image();j.src=g[l-1];j.onload=f(l+1);j.onerror=function(){alert("资源"+g[l-1]+"加载失败")}}else{h.innerHTML="";i()}};f(1)};var b=WEHOUGAME.tempcanvas[1].getContext("2d");b.font="bold 24px Tahoma";b.textBaseline="hanging";b.textAlign="center";b.fillStyle="#ffffff";b.lineWidth=2;b=WEHOUGAME.tempcanvas[0].getContext("2d");b.font="bold 21px 黑体";b.textBaseline="hanging";b.textAlign="right";b.fillStyle="#ffffff";b.lineWidth=2;b=WEHOUGAME.tempcanvas[2].getContext("2d");b.font="bold 19px 黑体";b.textBaseline="hanging";b.textAlign="center";b.fillStyle="#000000";b=WEHOUGAME.tempcanvas[5].getContext("2d");b.font="bold 8px Tahoma";b.textBaseline="hanging";b.textAlign="left";b.fillStyle="#a8f085";b.lineWidth=1;WEHOUGAME.mainstory.actlist[0]=function(j,i,h){var g;if(i==h){if(j==""){g=WEHOUGAME.tempcanvas[0].getContext("2d");g.clearRect(0,0,555,40);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[0])}else{g=WEHOUGAME.tempcanvas[0].getContext("2d");g.clearRect(0,0,555,40);g.drawImage(my2dpiclist[0],0,128+64,400,50,200,0,400,50);g.strokeText(j,450,8);g.fillText(j,450,8);WEHOUGAME.tempmesh[0].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[0])}}if(i<=h+100&&i>h+20){WEHOUGAME.tempmesh[0].position.x=24;WEHOUGAME.tempmesh[0].position.y=WEHOUCORE.slowmove[0](i-h-20,-250,506,80)}else{if(i<h+20){var f=h+19-i;WEHOUGAME.tempmesh[0].position.x=24-f*50;WEHOUGAME.tempmesh[0].position.y=-250;WEHOUGAME.tempmesh[0].scale.x=f/5+1;WEHOUGAME.tempmesh[0].scale.y=f/5+1;WEHOUGAME.tempmesh[0].material.opacity=(19-f)/20}}};WEHOUGAME.mainstory.actlist[1]=function(l,i,h){var g=l.length/2;if(i-h<=g*110){if((i-h)%110==0){var f=l,j=(i-h)/110;if(j<g){b=WEHOUGAME.tempcanvas[2].getContext("2d");b.clearRect(0,0,400,70);if(f[j*2]==1){b.drawImage(my2dpiclist[0],0,256,256,44,0,0,300,50);b.fillText(f[j*2+1],150,23);WEHOUGAME.tempmesh[2].material.map.needsUpdate=true;WEHOUGAME.tempmesh[2].position.x=WEHOUCORE.bspos[0].x;WEHOUGAME.tempmesh[2].position.y=WEHOUCORE.bspos[0].y-50;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[2])}else{b.drawImage(my2dpiclist[0],0,304,256,44,0,0,300,50);b.fillText(f[j*2+1],150,7);WEHOUGAME.tempmesh[2].material.map.needsUpdate=true;WEHOUGAME.tempmesh[2].position.x=WEHOUCORE.lmpos.x;WEHOUGAME.tempmesh[2].position.y=WEHOUCORE.lmpos.y+50;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[2])}}else{b=WEHOUGAME.tempcanvas[2].getContext("2d");b.clearRect(0,0,400,70);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[2])}}}};WEHOUGAME.mainstory.actlist[2]=function(h,g,f){if(g==f){WEHOUGAME.gotime=h;WEHOUGAME.tempmesh[1].position.y=250;WEHOUGAME.tempmesh[1].material.opacity=0}};WEHOUGAME.mainstory.actlist[3]=function(h,g,f){if(g==f){WEHOUGAME.power=h}};WEHOUGAME.mainstory.actlist[4]=function(i,g,f){if(g==f){var h=WEHOUGAME.myplalistbos.l[i[0]];h.geometry.faceVertexUvs[0][0][0].u=h.geometry.faceVertexUvs[0][0][1].u=i[1][0];h.geometry.faceVertexUvs[0][0][2].u=h.geometry.faceVertexUvs[0][0][3].u=i[1][1];h.geometry.faceVertexUvs[0][0][0].v=h.geometry.faceVertexUvs[0][0][3].v=i[1][2];h.geometry.faceVertexUvs[0][0][1].v=h.geometry.faceVertexUvs[0][0][2].v=i[1][3];h.geometry.uvsNeedUpdate=true}};WEHOUGAME.mainstory.actlist[5]=function(h,g,f){if(g==f){h[0].currentTime=h[1];h[0].play()}if(h[0].currentTime>=h[2]){if(h[3]==0){h[0].pause()}else{h[0].currentTime=h[1];h[0].play()}}};WEHOUGAME.mainstory.actlist[6]=function(i,o,m){if(o==m){if(i[0]!=""){var n=WEHOUGAME.tempcanvas[5].getContext("2d");n.clearRect(0,0,280,100);n.strokeText(i[0],0,8);n.fillText(i[0],0,8);var g,f,l="",j=Math.floor(i[1]/10),h=i[1]%10;for(g=1;g<=j;g++){l="★★★★★★★★★★";n.strokeText(l,0,8+g*14);n.fillText(l,0,8+g*14)}l="";for(f=0;f<h;f++){l+="★"}n.strokeText(l,0,8+g*14);n.fillText(l,0,8+g*14);WEHOUGAME.tempmesh[5].position.x=-106;WEHOUGAME.tempmesh[5].position.y=232;WEHOUGAME.tempmesh[5].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[5])}else{WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[5])}}if(o<m+100&&i[2]==1){WEHOUGAME.tempmesh[5].position.y=232+(m+100-o)*0.2;WEHOUGAME.tempmesh[5].material.opacity=1-(m+100-o)*0.01}};WEHOUGAME.mainstory.actlist[7]=function(i,h,g){if(h==g){WEHOUGAME.topscore+=WEHOUGAME.score;if(WEHOUGAME.miss==0){WEHOUGAME.topscore+=WEHOUGAME.score*0.5}if(WEHOUGAME.topscore>WEHOUGAME.hiscore){WEHOUGAME.hiscore=WEHOUGAME.topscore;if(window.localStorage){localStorage.hs=WEHOUGAME.hiscore;WEHOUGAME.hiscore=localStorage.hs}}WEHOUGAME.miss=0;WEHOUGAME.misscut=i[1];WEHOUGAME.score=i[0];if(i[2]){WEHOUGAME.timecut=i[2]}else{WEHOUGAME.timecut=0}document.getElementById("topscore").innerHTML=WEHOUGAME.topscore;document.getElementById("hiscore").innerHTML=WEHOUGAME.hiscore;document.getElementById("miss").innerHTML="";var f=document.getElementById("misscut");if(WEHOUGAME.misscut<1){f.innerHTML=WEHOUGAME.misscut*100+"%"}else{f.innerHTML=""}}};WEHOUCORE.deal.cheathit=WEHOUCORE.deal.hit=function(){if(!WEHOUGAME.misscd){WEHOUGAME.getSe(0).currentTime=0;WEHOUGAME.getSe(0).play();WEHOUGAME.misscd=60;WEHOUGAME.miss++;if(WEHOUGAME.misscut<1){WEHOUGAME.score=Math.floor(WEHOUGAME.misscut*WEHOUGAME.score);document.getElementById("miss").innerHTML=WEHOUGAME.miss}}};WEHOUCORE.deal.graze=function(){};WEHOUCORE.webgl.renderer.clear()};WEHOUGAME.gamestart=function(){var a=WEHOUGAME.tempcanvas[4].getContext("2d");a.clearRect(0,0,800,600);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[4]);if(window.localStorage&&localStorage.hs){WEHOUGAME.hiscore=localStorage.hs}WEHOUGAME.kd=[0,0,0,0,0,0];if(!WEHOUGAME.inrep){document.body.onkeydown=function(b){if(b.keyCode==37){WEHOUGAME.kd[0]=1}if(b.keyCode==38){WEHOUGAME.kd[1]=1}if(b.keyCode==39){WEHOUGAME.kd[2]=1}if(b.keyCode==40){WEHOUGAME.kd[3]=1}if(b.keyCode==90){WEHOUGAME.kd[5]=1}if(b.keyCode==88){history.go(0)}WEHOUGAME.kd[4]=b.shiftKey};document.body.onkeyup=function(b){if(b.keyCode==37){WEHOUGAME.kd[0]=0}if(b.keyCode==38){WEHOUGAME.kd[1]=0}if(b.keyCode==39){WEHOUGAME.kd[2]=0}if(b.keyCode==40){WEHOUGAME.kd[3]=0}if(b.keyCode==90){WEHOUGAME.kd[5]=0}WEHOUGAME.kd[4]=b.shiftKey}}else{document.body.onkeydown=function(b){if(b.keyCode==88){history.go(0)}};document.body.onkeyup=function(b){}}a=WEHOUGAME.tempcanvas[3].getContext("2d");if(!WEHOUGAME.inrep){WEHOUGAME.repdata=a.createImageData(300,300)}else{}WEHOUGAME.render()};WEHOUGAME.gameover=function(){cxt=WEHOUGAME.tempcanvas[4].getContext("2d");cxt.drawImage(my2dpiclist[1],0,0,500,550);cxt.font="normal 22px Tahoma";cxt.textAlign="left";cxt.fillStyle="#ddd";cxt.lineWidth=6;cxt.strokeText(WEHOUGAME.topscore,266,230);cxt.fillText(WEHOUGAME.topscore,266,230);if(window.localStorage){localStorage.hs=WEHOUGAME.hiscore}WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[4]);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);document.body.onkeydown=function(d){if(d.keyCode==90){history.go(0)}else{if(d.keyCode==67){var b=WEHOUCORE.randomseed;var c=prompt("请输入您的名字:");if(!c){history.go(0);return}if(c.length>30){c=c.substr(0,30)}for(k=0;k<WEHOUGAME.mainstory.name.length;k++){WEHOUGAME.repdata.data[k*2+10]=WEHOUGAME.mainstory.name.charCodeAt(k);WEHOUGAME.repdata.data[k*2+11]=255}WEHOUGAME.repdata.data[k*2+10]=255;WEHOUGAME.repdata.data[k*2+11]=255;WEHOUGAME.repdata.data[k*2+12]=255;WEHOUGAME.repdata.data[k*2+13]=255;for(k=0;k<c.length;k++){WEHOUGAME.repdata.data[k*2+64]=c.charCodeAt(k);WEHOUGAME.repdata.data[k*2+65]=255}WEHOUGAME.repdata.data[k*2+64]=255;WEHOUGAME.repdata.data[k*2+65]=255;WEHOUGAME.repdata.data[k*2+66]=255;WEHOUGAME.repdata.data[k*2+67]=255;WEHOUGAME.repdata.data[256-8]=255;WEHOUGAME.repdata.data[256-7]=255;WEHOUGAME.repdata.data[256-6]=(b&16711680)/65536;WEHOUGAME.repdata.data[256-5]=255;WEHOUGAME.repdata.data[256-4]=(b&65280)/256;WEHOUGAME.repdata.data[256-3]=255;WEHOUGAME.repdata.data[256-2]=(b&255)/1;WEHOUGAME.repdata.data[256-1]=255;var a=WEHOUGAME.tempcanvas[3].getContext("2d");a.putImageData(WEHOUGAME.repdata,0,0);alert("正在输出replay图片，右键保存此图片即可");window.open(WEHOUGAME.tempcanvas[3].toDataURL("image/png"));history.go(0)}}}};WEHOUGAME.render=function(){if(!WEHOUCORE.gameover){requestAnimationFrame(WEHOUGAME.render)}else{WEHOUGAME.gameover();return 0}var j;if(WEHOUGAME.inrep){var e=WEHOUGAME.repdata.data[WEHOUCORE.time*2+256];if(e&1){WEHOUGAME.kd[0]=1}else{WEHOUGAME.kd[0]=0}if(e&2){WEHOUGAME.kd[1]=1}else{WEHOUGAME.kd[1]=0}if(e&4){WEHOUGAME.kd[2]=1}else{WEHOUGAME.kd[2]=0}if(e&8){WEHOUGAME.kd[3]=1}else{WEHOUGAME.kd[3]=0}if(e&16){WEHOUGAME.kd[4]=1}else{WEHOUGAME.kd[4]=0}if(e&32){WEHOUGAME.kd[5]=1}else{WEHOUGAME.kd[5]=0}}else{WEHOUGAME.repdata.data[WEHOUCORE.time*2+256-1]=255;WEHOUGAME.repdata.data[WEHOUCORE.time*2+256]=(WEHOUGAME.kd[0]*1+WEHOUGAME.kd[1]*2+WEHOUGAME.kd[2]*4+WEHOUGAME.kd[3]*8+WEHOUGAME.kd[4]*16+WEHOUGAME.kd[5]*32);WEHOUGAME.repdata.data[WEHOUCORE.time*2+256+1]=255;WEHOUGAME.repdata.data[WEHOUCORE.time*2+256+3]=255}if(WEHOUGAME.kd[4]){j=2}else{j=6}if(WEHOUGAME.kd[0]+WEHOUGAME.kd[1]+WEHOUGAME.kd[2]+WEHOUGAME.kd[3]>=2){j*=0.707}if(WEHOUGAME.kd[0]){WEHOUCORE.lmpos.x-=j}if(WEHOUGAME.kd[1]){WEHOUCORE.lmpos.y+=j}if(WEHOUGAME.kd[2]){WEHOUCORE.lmpos.x+=j}if(WEHOUGAME.kd[3]){WEHOUCORE.lmpos.y-=j}if(WEHOUGAME.power){var h=(WEHOUGAME.power.x>=10000)?WEHOUCORE.lmpos.x+WEHOUGAME.power.x-20000:WEHOUGAME.power.x;var f=(WEHOUGAME.power.y>=10000)?WEHOUCORE.lmpos.y+WEHOUGAME.power.y-20000:WEHOUGAME.power.y;var i=WEHOUGAME.power.z,a=Math.sqrt((h-WEHOUCORE.lmpos.x)*(h-WEHOUCORE.lmpos.x)+(f-WEHOUCORE.lmpos.y)*(f-WEHOUCORE.lmpos.y));if(i<a){WEHOUCORE.lmpos.x+=(h-WEHOUCORE.lmpos.x)/a*i;WEHOUCORE.lmpos.y+=(f-WEHOUCORE.lmpos.y)/a*i}else{WEHOUCORE.lmpos.x=h;WEHOUCORE.lmpos.y=f}}var d=WEHOUCORE.w/2-30,c=WEHOUCORE.h/2-30;if(WEHOUCORE.lmpos.x>d){WEHOUCORE.lmpos.x=d}if(WEHOUCORE.lmpos.x<-d){WEHOUCORE.lmpos.x=-d}if(WEHOUCORE.lmpos.y>c){WEHOUCORE.lmpos.y=c}if(WEHOUCORE.lmpos.y<-c){WEHOUCORE.lmpos.y=-c}WEHOUGAME.mainstory.deal(WEHOUCORE.time);WEHOUGAME.selfcont.runGroup(WEHOUGAME.kd[5]);WEHOUGAME.myplalist.l[1].position.set(WEHOUCORE.lmpos.x,WEHOUCORE.lmpos.y,1.5);WEHOUGAME.myplalist.l[2].rotation.z+=0.02;WEHOUGAME.myplalist.l[3].rotation.z-=0.02;WEHOUCORE.time++;if(WEHOUGAME.gotime>0){if(WEHOUGAME.gotime==999999){var b="∞"}else{WEHOUGAME.gotime--;var b=(WEHOUGAME.gotime/60).toFixed(1)}cxt=WEHOUGAME.tempcanvas[1].getContext("2d");cxt.clearRect(0,0,280,100);cxt.strokeText(b+"s",150,2);cxt.fillText(b+"s",150,2);WEHOUGAME.tempmesh[1].material.map.needsUpdate=true;if(WEHOUGAME.tempmesh[1].position.y>200){WEHOUGAME.tempmesh[1].position.y-=0.5;WEHOUGAME.tempmesh[1].material.opacity+=0.008}else{WEHOUGAME.tempmesh[1].position.y=200}WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[1])}else{if(WEHOUGAME.gotime==0){WEHOUGAME.gotime=-1;cxt=WEHOUGAME.tempcanvas[1].getContext("2d");cxt.clearRect(0,0,180,100);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[1])}}WEHOUGAME.misscd>0?WEHOUGAME.misscd--:0;if(WEHOUGAME.score+WEHOUGAME.timecut>0){WEHOUGAME.score+=WEHOUGAME.timecut}else{WEHOUGAME.score=0}document.getElementById("score").innerHTML=WEHOUGAME.score;if(WEHOUCORE.time%WEHOUGAME.renderintime==1){WEHOUCORE.webgl.renderer.render(WEHOUCORE.webgl.scene,WEHOUCORE.webgl.camera);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera)}};