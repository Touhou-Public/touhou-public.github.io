var WEHOUCORE={};WEHOUCORE.w=500;WEHOUCORE.h=550;WEHOUCORE.time=0;WEHOUCORE.cheat=0;WEHOUCORE.lmpos=new THREE.Vector2(0,-270);WEHOUCORE.bspos=[new THREE.Vector2(0,-350),new THREE.Vector2(0,-350),new THREE.Vector2(0,-350)];WEHOUCORE.bshit=[-1,-1,-1];WEHOUCORE.webgl={};WEHOUCORE.gameover=0;WEHOUCORE.deal={};WEHOUCORE.deal.graze=function(){};WEHOUCORE.deal.hit=function(){WEHOUCORE.gameover=1};WEHOUCORE.deal.cheathit=function(){};WEHOUCORE.deal.hitting=function(){};WEHOUCORE.nowstory={};WEHOUCORE.noweffect={};WEHOUCORE.nowself={};WEHOUCORE.randomseed=new Date().getTime()%1000000;WEHOUCORE.randomuse=0;WEHOUCORE.imglist=[];WEHOUCORE.regimg=function(a){WEHOUCORE.imglist.push(a);return a};WEHOUCORE.zcount=2;WEHOUCORE.zcounter=function(a){if(a){WEHOUCORE.zcount=a}else{WEHOUCORE.zcount+=1}return WEHOUCORE.zcount};WEHOUCORE.random=function(){var a=WEHOUCORE.randomseed+WEHOUCORE.randomuse*178279;a=(a/1000)*(a%1000);var a=a%1000/1000;WEHOUCORE.randomuse++;if(WEHOUCORE.randomuse>100){WEHOUCORE.randomuse=0}return a};WEHOUCORE.initcoreenv=function(c){var b=c.clientWidth;var a=c.clientHeight;WEHOUCORE.webgl.renderer=new THREE.WebGLRenderer({antialias:true});WEHOUCORE.webgl.renderer.setSize(b,a);c.appendChild(WEHOUCORE.webgl.renderer.domElement);WEHOUCORE.webgl.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-60000,60000);WEHOUCORE.webgl.scene=new THREE.Scene()};WEHOUCORE.a2a=function(d,b){var c=new THREE.Vector2();c.x=d.x*Math.cos(b)-d.y*Math.sin(b);c.y=d.x*Math.sin(b)+d.y*Math.cos(b);return c};WEHOUCORE.p2p=function(f,c,b,e){if(b<=0){return 0}var a=(f.x-c.x)*(f.x-c.x)+(f.y-c.y)*(f.y-c.y);if(b==9999){return Math.sqrt(a)}else{if(!e&&(a<b*b+200)){WEHOUCORE.deal.graze();if(a>b*b){return 2}else{return 1}}if(a>b*b){return 0}else{return 1}}};WEHOUCORE.p2l=function(e,h,g,i){var q=WEHOUCORE.p2p(e,h,9999,1),o=WEHOUCORE.p2p(e,g,9999,1),n=WEHOUCORE.p2p(g,h,9999,1),f=0;if(q*q>=o*o+n*n){f=o}else{if(o*o>=q*q+n*n){f=q}else{var r=(q+o+n)/2;r=Math.sqrt(r*(r-q)*(r-o)*(r-n));f=2*r/n}}if(i){if(f>i){return 0}else{return 1}}else{return f}};WEHOUCORE.slowmove=[];WEHOUCORE.slowmove[0]=function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e*e+a}return g/2*((e-=2)*e*e+2)+a};WEHOUCORE.slowmove[1]=function(e,a,g,f){return g*e/f+a};WEHOUCORE.slowmove[2]=function(e,a,g,f){return g*((e=e/f-1)*e*e+1)+a};WEHOUCORE.slowmove[3]=function(e,a,h,g,f){if(f==undefined){f=1.70158}return h*((e=e/g-1)*e*((f+1)*e+f)+1)+a};WEHOUCORE.canvas2mesh=function(c,a,e,d){var b=new THREE.Mesh(new THREE.PlaneGeometry(a||c.width,e||c.height,0,0),new THREE.MeshBasicMaterial({map:new THREE.Texture(c),transparent:true,depthWrite:false,depthTest:false}));b.material.map.needsUpdate=true;return b};WEHOUCORE.imgSet=function(){this.l=new Array()};WEHOUCORE.imgSet.prototype.add=function(o,d,g,a,b){for(var e=0;e<o.length;e++){WEHOUCORE.imglist.push(o[e]);var f=THREE.ImageUtils.loadTexture(o[e]);if(a){f.minFilter=THREE.NearestFilter}if(b){var h=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(o[e])})}else{var h=new THREE.ShaderMaterial({uniforms:{texture1:{type:"t",value:f}},vertexShader:"varying vec2 vUv;varying float alphas;void main(){	vUv=uv;	mat4 mv=modelMatrix;	alphas=mv[2][2];	if(mv[0][2]>0.0){		vUv.x=vUv.x+mv[0][2]*floor(mv[2][0]);		vUv.y=vUv.y-mv[0][2]*floor(mv[2][1]);	}else if(mv[0][2]<0.0){		vUv.x=fract(mv[2][0])+fract(mv[2][1])-vUv.x;		vUv.x=vUv.x-mv[0][2]*floor(mv[2][0]);		vUv.y=vUv.y+mv[0][2]*floor(mv[2][1]);	}	mv[0][2]=0.0;	mv[2][0]=0.0;	mv[2][1]=0.0;	gl_Position=projectionMatrix*mv*vec4(position,1.0);}",fragmentShader:"uniform sampler2D texture1;varying vec2 vUv;varying float alphas;void main(){	vec2 uv=vUv;	vec4 fc=texture2D(texture1,uv);	fc[3]=fc[3]*alphas;	gl_FragColor=fc;}"})}h.transparent=true;if(d==1){h.blending=THREE.AdditiveBlending}else{if(d==2){h.blending=THREE.SubtractiveBlending}}var n=new Array();n.push(h);this.l.push(h)}};WEHOUCORE.shaderSet=function(){this.l=new Array()};WEHOUCORE.shaderSet.prototype.add=function(d,a,c){var b=new THREE.ShaderMaterial(d);b.transparent=true;if(c){b.blending=THREE.AdditiveBlending}if(a){b.action=a}this.l.push(b);return this.l.length-1};WEHOUCORE.shaderSet.prototype.deal=function(){for(var a=0;a<this.l.length;a++){if(this.l[a].action){this.l[a].action(this.l[a].uniforms)}}};WEHOUCORE.planeSet=function(){this.l=new Array()};WEHOUCORE.planeSet.prototype.add=function(b,e,c,f){var g=new THREE.PlaneGeometry(b,e,0,0);if(f){if(f.d){g.d=f.d}g.cut=[0,1];if(f.cut&&f.cut.length==4){g.cut=[f.cut[1],f.cut[0]-f.cut[1]];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][1].u=f.cut[0];g.faceVertexUvs[0][0][2].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][3].v=f.cut[2];g.faceVertexUvs[0][0][1].v=g.faceVertexUvs[0][0][2].v=f.cut[3];if(f.rt){g.faceVertexUvs[0][0][1].u=g.faceVertexUvs[0][0][2].u=f.cut[0];g.faceVertexUvs[0][0][0].u=g.faceVertexUvs[0][0][3].u=f.cut[1];g.faceVertexUvs[0][0][0].v=g.faceVertexUvs[0][0][1].v=f.cut[2];g.faceVertexUvs[0][0][2].v=g.faceVertexUvs[0][0][3].v=f.cut[3]}}if(f.end&&f.end!=0){g.vertices[2].y-=g.vertices[0].y;g.vertices[0].y=0;g.vertices[3].y-=g.vertices[1].y;g.vertices[1].y=0}if(f.rep!=1){var a=0;if(f.rep>8){f.rep/=3;a=1}g.rep=[f.rep,Math.abs(f.cut[0]-f.cut[1]),a,f.cut[0],f.cut[1]]}}var d=new THREE.Mesh(g,c);this.l.push(d);return this.l.length-1};WEHOUCORE.bberSet=function(){this.l=new Array()};WEHOUCORE.bberSet.prototype.add=function(c,b,a){var d=a||1;this.l.push(new WEHOUCORE["Bb"+d](c,b))};WEHOUCORE.lineSet=function(a,b){this.l=new Array();this.bl=b;this.bl.parent=this;this.st=new Array();this.ms=a.mesh||null;this.delms=(a.delmesh==undefined)?true:a.delmesh;if(this.ms==null){this.delms=false}this.slx=a.slowx||0;this.sly=a.slowy||0;this.hit=(a.hit==undefined)?99999:a.hit;this.hit_dis=(a.hit_dis==undefined)?60:a.hit_dis;if(!this.ms){this.ms={};this.ms.position=new THREE.Vector2()}this.times=0;this.alltimes=0;this.player=a.player||"act";this.lt=new THREE.Vector2();this.eve=a.reload||[]};WEHOUCORE.lineSet.prototype.addline=function(a){this.l=this.l.concat(a)};WEHOUCORE.lineSet.prototype.addst=function(a){this.st=this.st.concat(a)};WEHOUCORE.lineSet.prototype.gogogo=function(g,f){if(this.alltimes&&(this.alltimes==this.l[this.l.length-1])){this.st=[[]];this.l=[0,new THREE.Vector2(-9998,-9998),new THREE.Vector2(0,0),50,new THREE.Vector2(-500,400),new THREE.Vector2(0,0),0];this.t=null;this.times=0}for(var e=0;e<this.eve.length;e++){if(this.eve[e][0]=="h"?this.ms.hit<this.eve[e][1]:this.eve[e][0]=="t"?this.alltimes>=this.eve[e][1]:0){this.st=this.eve[e][2];this.eve[e][1]=this.eve[e][0]=="h"?-1000:100000}}if(f){for(var e=3;e<this.l.length-2;e+=3){if(this.times>=this.l[e-3]&&this.times<this.l[e]){if(this.times==this.l[e-3]){this.t=this.t||new THREE.Vector2(this.l[1].x==-9998?this.ms.position.x:this.l[1].x,this.l[1].y==-9998?this.ms.position.y:this.l[1].y);this.lt.x=this.t.x;this.lt.y=this.t.y;this.t.x=(this.l[e+1].x==-9999)?((Math.abs(WEHOUCORE.lmpos.x)<=(WEHOUCORE.w/2-80))?WEHOUCORE.lmpos.x:Math.abs(WEHOUCORE.lmpos.x)/WEHOUCORE.lmpos.x*(WEHOUCORE.w/2-80)):(this.l[e+1].x==-9998)?this.lt.x:this.l[e+1].x;this.t.y=(this.l[e+1].y==-9999)?((Math.abs(WEHOUCORE.lmpos.y)<=(WEHOUCORE.h/2-80))?WEHOUCORE.lmpos.y:Math.abs(WEHOUCORE.lmpos.y)/WEHOUCORE.lmpos.y*(WEHOUCORE.h/2-80)):(this.l[e+1].y==-9998)?this.lt.y:this.l[e+1].y;if(this.l[e+2]){this.t.x+=-WEHOUCORE.random()*(this.l[e+2].x+5)+this.l[e+2].x/2;this.t.y+=-WEHOUCORE.random()*(this.l[e+2].y+5)+this.l[e+2].y/2}}var d=this.st[(e-3)/3];var c=WEHOUCORE.slowmove[this.slx](this.times-this.l[e-3],this.lt.x,this.t.x-this.lt.x,this.l[e]-this.l[e-3]);var a=WEHOUCORE.slowmove[this.sly](this.times-this.l[e-3],this.lt.y,this.t.y-this.lt.y,this.l[e]-this.l[e-3]);this.ms.position.set(c,a,WEHOUCORE.zcounter());WEHOUCORE.bspos[g].x=c;WEHOUCORE.bspos[g].y=a;for(var b=0;b<d.length;b++){this.bl.l[d[b]].p.x=this.bl.l[d[b]].pl?this.bl.l[d[b]].gp.x+c:(this.bl.l[d[b]].gp.x>10000?this.bl.l[d[b]].gp.x-20000+WEHOUCORE.lmpos.x:this.bl.l[d[b]].gp.x);this.bl.l[d[b]].p.y=this.bl.l[d[b]].pl?this.bl.l[d[b]].gp.y+a:(this.bl.l[d[b]].gp.y>10000?this.bl.l[d[b]].gp.y-20000+WEHOUCORE.lmpos.y:this.bl.l[d[b]].gp.y);this.bl.l[d[b]].bread()}break}}}for(var e=0;e<this.bl.l.length;e++){this.bl.l[e].going(g*50+e+2)}if(this.ms[this.player]){this.ms[this.player](this.alltimes)}this.times++;this.alltimes++;if(this.times>this.l[this.l.length-4]){this.times=0}};WEHOUCORE.lineSet.prototype.show=function(){if(this.ms){WEHOUCORE.webgl.scene.add(this.ms);this.ms.hit=this.hit;this.ms.hit_dis=this.hit_dis;if(this.ms.hit){WEHOUCORE.nowself.addHiter(this.ms)}else{WEHOUCORE.nowself.delHiter(this.ms)}}};WEHOUCORE.lineSet.prototype.clear=function(b){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clear(this.ms.position,800,b)}};WEHOUCORE.lineSet.prototype.clean=function(){for(var a=0;a<this.bl.l.length;a++){this.bl.l[a].clean()}if(this.delms){WEHOUCORE.webgl.scene.remove(this.ms);if(this.ms.hit){WEHOUCORE.nowself.delHiter(this.ms)}this.ms.deallocate()}};WEHOUCORE.selfSet=function(){this.l=new Array();this.useGroup=0;this.hitlist=[];WEHOUCORE.nowself=this};WEHOUCORE.selfSet.prototype.add=function(c){var a=new WEHOUCORE.bberSet();for(var b=0;b<c.length;b++){a.add(a,c[b])}this.l.push(a)};WEHOUCORE.selfSet.prototype.addHiter=function(a){this.hitlist.push(a)};WEHOUCORE.selfSet.prototype.delHiter=function(b){var a=this.hitlist.indexOf(b);if(a!==-1){this.hitlist.splice(a,1)}};WEHOUCORE.selfSet.prototype.runGroup=function(){var b=this.l[this.useGroup];for(var a=0;a<b.l.length;a++){if(WEHOUGAME.kd[5]){b.l[a].p.x=b.l[a].gp.x+WEHOUCORE.lmpos.x;b.l[a].p.y=b.l[a].gp.y+WEHOUCORE.lmpos.y;b.l[a].bread()}b.l[a].going(1)}};WEHOUCORE.effectSet=function(){this.l=new Array();this.useGroup=0;this.pushlist=[];WEHOUCORE.noweffect=this};WEHOUCORE.effectSet.prototype.add=function(c){var a=new WEHOUCORE.bberSet();for(var b=0;b<c.length;b++){a.add(a,c[b],2)}this.l.push(a)};WEHOUCORE.effectSet.prototype.push=function(b,a){this.pushlist.push([b,a.x,a.y])};WEHOUCORE.effectSet.prototype.runGroup=function(){var b=this.l[this.useGroup];for(var a=0;a<this.pushlist.length;a++){var c=this.pushlist[a][0];b.l[c].p.x=this.pushlist[a][1];b.l[c].p.y=this.pushlist[a][2];b.l[c].ot=0;b.l[c].bread()}for(var a=0;a<b.l.length;a++){b.l[a].going(1)}this.pushlist=[]};WEHOUCORE.storySet=function(a){this.name=a;this.l=new Array();this.s=new Array();this.t=0;this.at=0;this.p=0;this.self=new WEHOUCORE.selfSet();this.effect=new WEHOUCORE.effectSet()};WEHOUCORE.storySet.prototype.setName=function(a){this.name=a};WEHOUCORE.storySet.prototype.add=function(g,f,e,d){var b=new WEHOUCORE.bberSet();for(var c=0;c<f.length;c++){b.add(b,f[c])}var a=new WEHOUCORE.lineSet(g,b);a.addline(e);a.addst(d);this.l.push(a)};WEHOUCORE.storySet.prototype.adds=function(a){this.s.push(a)};WEHOUCORE.storySet.prototype.actlist=new Array();WEHOUCORE.storySet.prototype.deal=function(){WEHOUCORE.zcounter(2);WEHOUCORE.nowstory=this;var c=this.s[this.p];var b=c.time+30;if(c.group){for(var a=0;a<c.group.length;a++){var d=this.l[c.group[a]];if(this.t==0){d.show();d.gogogo(a,true)}else{if(this.t==b-1){d.clean();WEHOUGAME.slowtime=1;WEHOUCORE.bshit[a]=-2}else{if(this.t>=b-30){if(c.circleclear){d.clear(1-(b-this.t)/30);WEHOUGAME.slowtime=4;WEHOUGAME.mainstory.effect.push(1,WEHOUCORE.bspos[0])}else{d.clear(1.2)}d.gogogo(a,false);WEHOUCORE.bshit[a]=-1}else{d.gogogo(a,true);if((!c.bt)&&d.ms&&d.ms.hit_dis){WEHOUCORE.bshit[a]=d.ms.hit/d.hit;if(d.ms.hit<=0){d.ms.hit=d.hit;this.storyCT("jumpnext");WEHOUCORE.bshit[a]=-3}}}}}}}this.self.runGroup();this.effect.runGroup();if(c.act){for(var a=0;a<c.act.length;a+=2){if(c.act[a]==9999){WEHOUCORE.lmpos.x=9999;WEHOUCORE.gameover=1}else{this.actlist[c.act[a]](c.act[a+1],this.at,c.time)}}}if(this.at<c.time){this.at++}if(!c.statics){this.t++}else{this.t=1}if(this.t==b){this.p++;this.t=0;this.at=0}};WEHOUCORE.storySet.prototype.storyCT=function(a){if(a=="jumpnext"){this.at=this.t=this.s[this.p].time;this.s[this.p].statics=false}};WEHOUCORE.Ball=function(q,n,h,f,g,e,d,c,o,i){this.ms=q;this.ms.addMatrix=new THREE.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);if(this.ms.geometry&&this.ms.geometry.rep){this.ms.adsta=0}this.bp=new THREE.Vector2(this.ms.position.x,this.ms.position.y);this.t=new THREE.Vector2(n.x-this.bp.x,n.y-this.bp.y);var b=Math.sqrt((this.t.x)*(this.t.x)+(this.t.y)*(this.t.y));this.t.x=(this.t.x)*this.tdis/b+this.bp.x;this.t.y=(this.t.y)*this.tdis/b+this.bp.y;this.v=h;this.va=f;this.a=g;this.btime=0;this.bb=e||[];this.gz=0;this.alpha=d||1;this.valpha=c||0;this.vsize=i||new THREE.Vector2(0,0);if(o){this.ms.scale.x=o.x;this.ms.scale.y=o.y}};WEHOUCORE.Ball.prototype.tdis=3600;WEHOUCORE.Bb1=function(c,d){this.parent=c;this.type=d.type||"ball";this.motion=d.motion||"normal";if(this.type=="line"){this.lmat=d.linematerial||null;this.cut=d.materialcut||[0,1];this.llong=d.linelong||50;this.ms=null;this.aptime=d.appeartime||0}else{if(this.type=="laser"){this.ms=d.mesh||null;var a=this.ms.geometry?this.ms.geometry:this.ms[0].geometry;this.longl=Math.abs(a.vertices[2].y);this.shortl=Math.abs(a.vertices[0].x)*2;this.att=(d.appearline==undefined)?30:d.appearline;if(this.att<=10){this.att=0}this.rnum=d.numberrandom||0;this.rat=1}else{this.ms=d.mesh||null;this.rnum=d.numberrandom||0;this.rat=(d.rotating==undefined)?1:d.rotating;this.outer=d.outfield||false;if(this.type=="self"){this.dmg=d.damage}else{if(this.type=="enemy"){this.hit=d.hitblood||40;this.hit_dis=d.hitdistance||20}}}}if(this.motion!="mesh"){this.gp=d.position||new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.rp=d.positionrandom||new THREE.Vector2(0,0);this.pl=(d.positionlock===undefined)?true:d.positionlock;this.v=d.speed||[3];this.ve=d.speedchange||[0,0];this.rv=d.speedrandom||0;this.t=d.target||WEHOUCORE.lmpos;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}this.rt=d.targetrandom||0;if(this.motion=="normal"){this.va=d.palstance||[0];this.a=d.acceleration||[0];this.rva=d.palstancerandom||0;this.rvauto=d.autopalstance||false}else{if(this.motion=="gravity"){this.g=d.gravity||new THREE.Vector2(0,-0.03);this.f=d.decay||new THREE.Vector2(0.7,0.8)}}this.num=d.number||1;this.ne=d.numberchange||[0,0];this.angle=d.angle||[-360];this.aoff=d.angleoffset||0;this.ae=d.anglechange||[0,0];this.rangle=d.anglerandom||0;this.tangle=d.anglefactor||[];this.aall=[0,0,0,0,0];this.ds=d.distance||0}else{this.gp=new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.pl=true;this.vert=d.vert||[];this.num=this.vert.length;for(k=0;k<this.num;k++){this.vert[k]=new THREE.Vector4(this.vert[k].x,this.vert[k].y,this.vert[k].z,1)}this.bk=d.goback||0;this.fout=d.faceout||false;var b=new THREE.Matrix4();if(d.setmove){b.setPosition(d.setmove)}if(d.setrotate){b.setRotationFromEuler(d.setrotate,THREE.Object3D.defaultEulerOrder)}if(d.setsize){b.scale(d.setsize)}for(k=0;k<this.num;k++){this.vert[k]=b.multiplyVector4(this.vert[k])}this.meshv=d.meshmove||new THREE.Vector3(0,0,0);this.meshr=d.meshrotate||new THREE.Vector3(0,0,0);this.meshs=d.meshsize||new THREE.Vector3(1,1,1);this.tmat4=new THREE.Matrix4();this.tmat4.setPosition(this.meshv);this.tmat4.setRotationFromEuler(this.meshr,THREE.Object3D.defaultEulerOrder);this.tmat4.scale(this.meshs)}this.lock=d.locked||false;if(this.lock){this.changep=new THREE.Vector2(0,0)}this.bt=d.lifetime||300;this.time=d.period||30;this.dwf=d.diewithfather||false;this.protect=d.protect||false;this.ot=0;this.toff=d.timeoffset||0;this.ballbox=new Array();this.event=d.bulletevents||[];this.myeve=d.myevents||[];this.deve=d.dieevents||[];this.se=d.birthse||0;this.secount=0;this.sep=d.seperiod||1};WEHOUCORE.Bb1.prototype.bread=function(t){var u;if((this.ot-this.toff>=0)&&(this.ot-this.toff)%this.time==0){if(this.se&&WEHOUCORE.nowstory.seplay&&this.secount%this.sep==0){WEHOUCORE.nowstory.seplay(this.se-1)}this.secount++;if(this.motion!="mesh"){var d=new THREE.Vector2();d.x=this.t.x;d.y=this.t.y;if(d.x==30000){d.x=this.parentball.t.x}if(d.y==30000){d.y=this.parentball.t.y}d.sub(d,this.p);if(Math.abs(d.x)<2&&Math.abs(d.y)<2){d.y=-100}var s=this.num+(this.rnum?-Math.floor(WEHOUCORE.random()*this.rnum):0)+Math.floor(this.aall[2]);var r=(this.rp.x>0),h;if(!r&&this.rp.x){h=-WEHOUCORE.random()*this.rp.x+this.rp.x/2}var o=(this.rp.x>0),g;if(!o&&this.rp.y){g=-WEHOUCORE.random()*this.rp.y+this.rp.y/2}}else{s=this.num}for(var u=0;u<s;u++){if(this.ms){if(!this.ms.position){var y=Math.floor(WEHOUCORE.random()*this.ms.length);var c=this.ms[y].clone()}else{var c=this.ms.clone()}}else{var c=new Object();c.position=new Object()}if(this.type=="enemy"){c.hit=this.hit;c.hit_dis=this.hit_dis;WEHOUCORE.nowself.addHiter(c)}if(this.motion!="mesh"){c.position.x=this.p.x+(this.rp.x?(r?(WEHOUCORE.random()*this.rp.x-this.rp.x/2):h):0);c.position.y=this.p.y+(this.rp.y?(o?(WEHOUCORE.random()*this.rp.y-this.rp.y/2):g):0);c.position.z=2;if(d.x>=10000){d.x=c.position.x+d.x-20000}if(d.y>=10000){d.y=c.position.y+d.y-20000}var a=0,x;if(this.angle.length==1&&this.angle[0]<0){x=[(-this.angle[0])/s]}else{x=this.angle}if(s%2==1){if(u==(s-1)/2){a=0}else{if(u<(s-1)/2){for(j=u;j<(s-1)/2;j++){a+=(x[j]===undefined?x[0]:x[j])}}else{if(u>(s-1)/2){for(j=u-1;j>(s-1)/2-1;j--){a-=(x[j]===undefined?x[0]:x[j])}}}}}else{if(u<s/2){for(j=u;j<=s/2-1;j++){a+=(x[j]===undefined?x[0]:x[j]);if(j==s/2-1){a-=(x[j]===undefined?x[0]:x[j])/2}}}else{if(u>=s/2){for(j=u-1;j>=s/2-1;j--){a-=(x[j]===undefined?x[0]:x[j]);if(j==s/2-1){a+=(x[j]===undefined?x[0]:x[j])/2}}}}}a+=this.rangle?Math.floor(WEHOUCORE.random()*this.rangle-this.rangle/2):0;a+=this.aall[0];a+=this.aoff;if(this.tangle.length){a+=Math.sin(WEHOUCORE.time/this.tangle[0])*this.tangle[1]}var v=WEHOUCORE.a2a(d,a/180*Math.PI);v.add(v,this.p);this.rt?v.add(v,new THREE.Vector2(WEHOUCORE.random()*this.rt-this.rt/2,WEHOUCORE.random()*this.rt-this.rt/2)):0}else{c.position.x=this.vert[u].x;c.position.y=this.vert[u].y;c.position.z=2}if(this.rat==3&&this.ms){c.rotation.z=WEHOUCORE.random()*Math.PI*2}if(this.motion=="normal"){var e=new WEHOUCORE.Ball(c,v,(this.v[u]||this.v[0])+this.aall[1]+(this.rv?(WEHOUCORE.random()*this.rv-this.rv/2):0),(this.va[u]||this.va[0])+(this.rva?(WEHOUCORE.random()*this.rva-this.rva/2):0),this.a[u]||this.a[0])}else{if(this.motion=="gravity"){var f=(this.v[u]||this.v[0])+this.aall[1]+(this.rv?(WEHOUCORE.random()*this.rv-this.rv/2):0);var q=Math.sqrt(v.x*v.x+v.y*v.y);var e=new WEHOUCORE.Ball(c,v,new THREE.Vector2(v.x*f/q,v.y*f/q),0,new THREE.Vector2(this.g.x,this.g.y))}else{if(this.motion=="mesh"){var e=new WEHOUCORE.Ball(c,new THREE.Vector2(0,0),this.tmat4,0,this.vert[u].clone())}}}if(this.type=="line"){var b=new THREE.PlaneGeometry(1,1,0,this.llong-1);for(m=0;m<this.llong*2;m++){b.vertices[m].x=e.bp.x;b.vertices[m].y=e.bp.y}for(m=0;m<this.llong-1;m++){var n=b.faceVertexUvs[0][m];for(p=0;p<2;p++){n[p].u=n[p].v;n[p].v=this.cut[0]}for(p=2;p<4;p++){n[p].u=n[p].v;n[p].v=this.cut[1]}}e.lms=new THREE.Mesh(b,this.lmat);e.lms.position.z=20;e.lms.geometry.uvsNeedUpdate=true;e.lms.geometry.verticesNeedUpdate=true;e.lms.geometry.dynamic=true;WEHOUCORE.webgl.scene.add(e.lms)}if(this.lock){e.lockp=new THREE.Vector2(this.p.x,this.p.y);e.changp=new THREE.Vector2(0,0)}if(this.parentball){e.parentball=this.parentball}this.ballbox.push(e);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}if(this.motion!="mesh"){this.aall[0]+=this.ae[0];if((this.ae[0]>0&&this.aall[0]>this.ae[1])||(this.ae[0]<0&&this.aall[0]<this.ae[1])){this.aall[0]=0}this.aall[1]+=this.ve[0];if((this.ve[0]>0&&this.aall[1]>this.ve[1])||(this.ve[0]<0&&this.aall[1]<this.ve[1])){this.aall[1]=0}this.aall[2]+=this.ne[0];if((this.ne[0]>0&&this.aall[2]>this.ne[1])||(this.ne[0]<0&&this.aall[2]<this.ne[1])){this.aall[2]=0}}}for(l=0;l<this.myeve.length;l++){if(this.ot==this.myeve[l][0]){if(this.myeve[l][1]=="t"){this.t.x=this.myeve[l][2].x;this.t.y=this.myeve[l][2].y;if(this.t.x==29999&&this.t.y==29999){this.t.x=WEHOUCORE.lmpos.x;this.t.y=WEHOUCORE.lmpos.y}}else{this[this.myeve[l][1]]=this.myeve[l][2]}}}this.ot++;return 11};WEHOUCORE.Bb1.prototype.going=function(c){for(var A=0;A<this.ballbox.length;A++){var G=this.ballbox[A];if(G.btime<this.bt){if(this.outer&&(G.ms.position.x>(WEHOUCORE.w/2+30)||G.ms.position.x<-(WEHOUCORE.w/2+30)||G.ms.position.y>(WEHOUCORE.h/2+30)||G.ms.position.y<-(WEHOUCORE.h/2+30))){G.btime=this.bt+11;if(this.ms){G.ms.scale.x=0;G.ms.scale.y=0}continue}if(this.dwf&&G.parentball&&G.parentball.dieflag){G.btime=this.bt}for(l=0;l<this.event.length;l++){if(this.event[l][0]=="t"?G.btime==this.event[l][1]:this.event[l][0]=="-x"?G.ms.position.x<=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.x+(this.event[l][1]-20000):this.event[l][1]):this.event[l][0]=="+x"?G.ms.position.x>=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.x+(this.event[l][1]-20000):this.event[l][1]):this.event[l][0]=="+y"?G.ms.position.y>=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.y+(this.event[l][1]-20000):this.event[l][1]):this.event[l][0]=="-y"?G.ms.position.y<=(this.event[l][1]>=30000?WEHOUCORE.bspos[0].x+(this.event[l][1]-40000):this.event[l][1]>=10000?WEHOUCORE.lmpos.y+(this.event[l][1]-20000):this.event[l][1]):this.event[l][0]=="nt"?G.btime&&((G.btime-this.event[l][1][1])%this.event[l][1][0])==0:this.event[l][0]=="ds"&&(!G.gds)?WEHOUCORE.p2p(G.ms.position,this.event[l][1][0],this.event[l][1][1],1)==1&&(G.gds=1):this.event[l][0]=="-ds"&&(!G.gds)?!(WEHOUCORE.p2p(G.ms.position,this.event[l][1][0],this.event[l][1][1],1)==1)&&(G.gds=1):this.event[l][0]=="ft"?G.parentball.btime==this.event[l][1]:0){var H=this.event[l][2];for(z=0;z<H.length;z+=3){if(H[z]=="a"){if(this.motion=="normal"){G.a=H[z+1]+WEHOUCORE.random()*H[z+2]-H[z+2]/2}else{if(this.motion=="gravity"){G.a.x=H[z+1].x;G.a.y=H[z+1].y}else{G.a=H[z+1]}}}else{if(H[z]=="v"){if(this.motion=="normal"){G.v=H[z+1]+WEHOUCORE.random()*H[z+2]-H[z+2]/2}else{if(this.motion=="gravity"){if(H[z+1].x){G.v.x=H[z+1].x;G.v.y=H[z+1].y}else{var I=G.t;var x=Math.sqrt(I.x*I.x+I.y*I.y);G.v.x=I.x*H[z+1]/x;G.v.y=I.y*H[z+1]/x}}else{G.v=H[z+1]}}}else{if(H[z]=="va"){G.va=H[z+1]+WEHOUCORE.random()*H[z+2]-H[z+2]/2}else{if(H[z]=="t"){G.t=H[z+1].clone();if(G.t.x>=10000){if(G.t.x==29999){G.t.x=G.ms.position.x+WEHOUCORE.lmpos.x-G.bp.x}else{G.t.x=G.ms.position.x+G.t.x-20000}}if(G.t.y>=10000){if(G.t.y==29999){G.t.y=G.ms.position.y+WEHOUCORE.lmpos.y-G.bp.y}else{G.t.y=G.ms.position.y+G.t.y-20000}}G.bp.x=G.ms.position.x;G.bp.y=G.ms.position.y;H[z+2].x?(G.t.x+=+WEHOUCORE.random()*H[z+2].x-H[z+2].x/2):0;H[z+2].y?(G.t.y+=+WEHOUCORE.random()*H[z+2].y-H[z+2].y/2):0;G.t.sub(G.t,G.ms.position);var x=Math.sqrt((G.t.x)*(G.t.x)+(G.t.y)*(G.t.y));G.t.x=(G.t.x)*G.tdis/x+G.ms.position.x;G.t.y=(G.t.y)*G.tdis/x+G.ms.position.y}else{if(H[z]=="ms"){var y=G.ms.position.clone();WEHOUCORE.webgl.scene.remove(G.ms);G.ms.deallocate();G.ms=H[z+1].clone();G.ms.position=y;WEHOUCORE.webgl.scene.add(G.ms)}else{if(H[z]=="bb"){if(H[z+1]){G.bb=[H[z+1][0],H[z+1][1]];this.parent.l[G.bb[0]].p.x=G.ms.position.x;this.parent.l[G.bb[0]].p.y=G.ms.position.y;if(H[z+2]){G.bb[2]=H[z+2]}}else{G.bb=0}}else{if(H[z]=="p"){if(H[z+1].x!=29999){G.ms.position.x=H[z+1].x}if(H[z+1].y!=29999){G.ms.position.y=H[z+1].y}}else{if(H[z]=="-x"){if(!G.gx){if(this.event[l][0]=="+x"||this.event[l][0]=="-x"){G.ms.position.x=this.event[l][1]*2-G.ms.position.x;G.t.x=2*this.event[l][1]-G.t.x;G.bp.x=2*this.event[l][1]-G.bp.x}else{G.t.x=2*G.ms.position.x-G.t.x;G.bp.x=2*G.ms.position.x-G.bp.x}G.gx=1}}else{if(H[z]=="-y"){if(!G.gy){if(this.event[l][0]=="+y"||this.event[l][0]=="-y"){G.ms.position.y=this.event[l][1]*2-G.ms.position.y;G.t.y=2*this.event[l][1]-G.t.y;G.bp.y=2*this.event[l][1]-G.bp.y}else{G.t.y=2*G.ms.position.y-G.t.y;G.bp.y=2*G.ms.position.y-G.bp.y}G.gy=1}}else{if(H[z]=="jumpnext"){WEHOUCORE.nowstory.storyCT("jumpnext")}else{if(H[z]=="se"){WEHOUCORE.nowstory.seplay(H[z+1]-1)}else{if(H[z]=="die"){G.btime=this.bt-1}else{G[H[z]]=H[z+1]}}}}}}}}}}}}}}}var s=0;if(G.btime==0){s=this.ds}if(G.btime<10&&this.ms&&this.type!="laser"&&this.type!="self"){var F=3-(G.btime+1)*0.2;G.alpha=G.btime/9;G.ms.scale.x=F;G.ms.scale.y=F}if(this.type=="laser"&&(this.att==0)&&G.btime*this.v[0]<=this.longl){G.ms.scale.y=G.btime*G.v/this.longl}else{if(this.type=="laser"&&(this.att>0)&&G.btime==0){G.ms.scale.x=0}else{if(this.type=="laser"&&(this.att>0)&&G.btime==1){G.ms.scale.x=4/this.shortl}else{if(this.type=="laser"&&(this.att>0)&&G.btime>this.att-10&&G.btime<this.att){G.ms.scale.x=(10-this.att+G.btime)/10}else{if(this.type=="laser"&&(this.att>0)&&G.btime==this.att){G.ms.scale.x=1}}}}}if(this.motion=="normal"){G.v+=G.a;if(this.lock){G.ms.position.x-=G.changp.x;G.ms.position.y-=G.changp.y}G.t.sub(G.t,G.bp);var q=(G.t.x)*(G.v+s)/G.tdis,o=(G.t.y)*(G.v+s)/G.tdis;G.ms.position.x+=q?q:0;G.ms.position.y+=o?o:0;G.ms.position.z=WEHOUCORE.zcounter();if(G.va){if(G.va>1000){var E=G.va-2000;var a=new THREE.Vector2(G.t.x,G.t.y);G.t=WEHOUCORE.a2a(G.t,E/180*Math.PI);a.sub(G.t,a);a.multiplyScalar(Math.sqrt((G.ms.position.x-G.bp.x)*(G.ms.position.x-G.bp.x)+(G.ms.position.y-G.bp.y)*(G.ms.position.y-G.bp.y))/G.tdis);G.ms.position.x+=a.x;G.ms.position.y+=a.y;q+=a.x;o+=a.y}else{var D=0;if(this.rvauto){var d=(G.t.x-WEHOUCORE.lmpos.x)*(G.ms.position.y-WEHOUCORE.lmpos.y)-(G.t.y-WEHOUCORE.lmpos.y)*(G.ms.position.x-WEHOUCORE.lmpos.x);if(d>0){D=-G.va}else{if(d<0){D=G.va}}}else{D=G.va}G.t=WEHOUCORE.a2a(G.t,D/180*Math.PI)}}if(this.lock){G.t.add(G.t,G.bp)}else{G.t.add(G.t,G.bp)}if(this.lock){if(!G.parentball){G.changp.x=this.parent.parent.ms.position.x-G.lockp.x;G.changp.y=this.parent.parent.ms.position.y-G.lockp.y}else{G.changp.x=G.parentball.ms.position.x-G.lockp.x;G.changp.y=G.parentball.ms.position.y-G.lockp.y}G.ms.position.x+=G.changp.x;G.ms.position.y+=G.changp.y}}else{if(this.motion=="gravity"){G.v.x+=G.a.x;G.v.y+=G.a.y;var q=G.v.x*this.f.x,o=G.v.y*this.f.y;G.ms.position.x+=q;G.ms.position.y+=o;G.ms.position.z=WEHOUCORE.zcounter()}else{if(this.motion=="mesh"){G.a=G.v.multiplyVector4(G.a);q=G.ms.position.x;o=G.ms.position.y;G.ms.position.x=G.a.x;G.ms.position.y=G.a.y;if(this.lock){var e=new THREE.Vector2();if(!G.parentball){e.x=this.parent.parent.ms.position.x;e.y=this.parent.parent.ms.position.y}else{e.x=G.parentball.ms.position.x;e.y=G.parentball.ms.position.y}G.ms.position.x+=e.x;G.ms.position.y+=e.y}if(this.bk){var C=G.a.z>=this.bk[0]?1:(G.a.z<=this.bk[1]?0:(G.a.z-this.bk[1])/(this.bk[0]-this.bk[1]));G.alpha=(G.btime<10)?(C>G.alpha?G.alpha:C):C}if(this.fout){q=G.a.x;o=G.a.y}else{q=G.ms.position.x-q;o=G.ms.position.y-o}G.ms.position.z=WEHOUCORE.zcounter()}}}if((!(this.type=="line"))&&this.ms){G.ms.scale.z=G.alpha;if(G.ms.geometry.rep){G.ms.addMatrix.elements[2]=G.ms.geometry.rep[1];G.ms.addMatrix.elements[8]=Math.floor(G.btime/10)%G.ms.geometry.rep[0];if(G.ms.geometry.rep[2]){if(Math.abs(q)>0.3){if(G.ms.adsta<15){G.ms.addMatrix.elements[9]=1;G.ms.addMatrix.elements[8]=Math.floor(G.ms.adsta/5);G.ms.adsta++}else{G.ms.addMatrix.elements[9]=2}}else{if(G.ms.adsta>0){G.ms.addMatrix.elements[9]=1;G.ms.addMatrix.elements[8]=Math.floor(G.ms.adsta/5);G.ms.adsta--}else{G.ms.addMatrix.elements[9]=0}}if(q<0){G.ms.addMatrix.elements[8]+=G.ms.geometry.rep[3];G.ms.addMatrix.elements[9]+=G.ms.geometry.rep[4];G.ms.addMatrix.elements[2]=-G.ms.addMatrix.elements[2]}}}}if(this.rat==1&&this.ms){G.ms.rotation.z=(q!=0?Math.PI/2+Math.atan(o/q):Math.PI);if(this.type=="ball"){G.ms.rotation.z+=Math.PI}if((q>0&&o<0)||(q>=0&&o>=0)){G.ms.rotation.z+=Math.PI}}else{if(this.rat==2&&this.ms){G.ms.rotation.z+=0.1}}var n=0;if(this.type=="line"){G.lms.scale.z=G.alpha;var h=Math.sqrt(q*q+o*o),z=0;var b=new THREE.Vector2(5*o/h,-5*q/h);var B=new THREE.Vector2((G.lms.geometry.vertices[z].x+G.lms.geometry.vertices[z+1].x)/2,(G.lms.geometry.vertices[z].y+G.lms.geometry.vertices[z+1].y)/2);for(z=0;z<this.llong*2-2;z+=2){G.lms.geometry.vertices[z].x=G.lms.geometry.vertices[z+2].x;G.lms.geometry.vertices[z].y=G.lms.geometry.vertices[z+2].y;G.lms.geometry.vertices[z+1].x=G.lms.geometry.vertices[z+3].x;G.lms.geometry.vertices[z+1].y=G.lms.geometry.vertices[z+3].y;var v=new THREE.Vector2((G.lms.geometry.vertices[z+2].x+G.lms.geometry.vertices[z+3].x)/2,(G.lms.geometry.vertices[z+2].y+G.lms.geometry.vertices[z+3].y)/2);if(WEHOUCORE.p2l(WEHOUCORE.lmpos,B,v,5)==1){n=1}B=v}if(G.btime<this.aptime){n=0;G.lms.scale.z=G.alpha<0.5?G.alpha:0.5}G.lms.geometry.vertices[z].x=G.ms.position.x+b.x;G.lms.geometry.vertices[z].y=G.ms.position.y+b.y;G.lms.geometry.vertices[z].z=0;G.lms.geometry.vertices[z+1].x=G.ms.position.x-b.x;G.lms.geometry.vertices[z+1].y=G.ms.position.y-b.y;G.lms.geometry.vertices[z+1].z=0;G.lms.position.z=WEHOUCORE.zcounter();G.lms.geometry.verticesNeedUpdate=true}if(this.type=="laser"&&G.btime>=this.att&&G.ms.geometry.d){var g=WEHOUCORE.a2a(new THREE.Vector2(0,-this.longl*G.ms.scale.y+G.ms.geometry.d+20),G.ms.rotation.z);var f=WEHOUCORE.a2a(new THREE.Vector2(0,-G.ms.geometry.d-20),G.ms.rotation.z);if(WEHOUCORE.p2l(WEHOUCORE.lmpos,new THREE.Vector2(G.ms.position.x+g.x,G.ms.position.y+g.y),new THREE.Vector2(G.ms.position.x+f.x,G.ms.position.y+f.y),G.ms.geometry.d)){n=1}}if(this.type=="self"){var u=WEHOUCORE.nowself.hitlist;for(w=0;w<u.length;w++){if(WEHOUCORE.p2p(G.ms.position,u[w].position,u[w].hit_dis,1)){G.btime=this.bt-1;u[w].hit-=this.dmg;WEHOUCORE.deal.hitting();break}}}if(this.type=="enemy"){if(G.ms.hit<0){G.btime=this.bt-1;WEHOUCORE.nowself.delHiter(G.ms)}}if(G.bb&&G.bb.length){if(G.bb[2]==5||G.bb[2]==9){this.parent.l[G.bb[0]].p.x=this.parent.l[G.bb[0]].gp.x;this.parent.l[G.bb[0]].p.y=this.parent.l[G.bb[0]].gp.y}else{this.parent.l[G.bb[0]].p.x=G.ms.position.x;this.parent.l[G.bb[0]].p.y=G.ms.position.y}this.parent.l[G.bb[0]].ot=G.bb[1];this.parent.l[G.bb[0]].parentball=G;this.parent.l[G.bb[0]].bread();G.bb[1]++;if(G.bb[2]==1||G.bb[2]==5){G.bb=0}}if((G.btime>10&&G.alpha>0.95)&&(((this.type=="ball"||this.type=="enemy")&&this.ms&&G.ms.geometry.d&&((G.gz=WEHOUCORE.p2p(G.ms.position,WEHOUCORE.lmpos,G.ms.geometry.d,G.gz))==1)))||n==1){if(WEHOUCORE.cheat==0){WEHOUCORE.deal.hit();if((!this.protect)&&(this.type=="ball"||this.type=="enemy")){G.btime=this.bt-1}}else{WEHOUCORE.deal.cheathit();if((!this.protect)&&(this.type=="ball"||this.type=="enemy")){G.btime=this.bt-1}}}G.btime++}else{if(G.btime-this.bt<=10){if(G.btime==this.bt){G.dieflag=true;for(l=0;l<this.deve.length;l++){if(this.deve[l][0]=="bb"){G.bb=[this.deve[l][1][0],this.deve[l][1][1]]}else{if(this.deve[l][0]=="eff"){WEHOUCORE.noweffect.push(this.deve[l][1],G.ms.position.x,G.ms.position.y)}else{this[this.deve[l][0]]=this.deve[l][1]}}}}if(G.bb&&G.bb.length){this.parent.l[G.bb[0]].p.x=G.ms.position.x;this.parent.l[G.bb[0]].p.y=G.ms.position.y;this.parent.l[G.bb[0]].ot=G.bb[1];this.parent.l[G.bb[0]].parentball=G;this.parent.l[G.bb[0]].bread();G.bb[1]++}if((this.type=="ball"||this.type=="enemy")&&this.ms){var F=(10-G.btime+this.bt)*0.1;G.ms.scale.x=F;G.ms.scale.y=F}else{if(this.type=="laser"){G.ms.scale.x=(10-G.btime+this.bt)/10}else{if(this.type=="line"){G.lms.scale.z-=0.1}else{if(this.type=="self"){G.ms.position.y+=(10-G.btime+this.bt)*1;if(G.btime-this.bt==10){G.ms.scale.x=0}}}}}G.btime++}}}for(var A=0;A<this.ballbox.length;){if(this.ballbox[A].btime>this.bt+10){if(this.type=="ball"||this.type=="laser"||this.type=="self"||this.type=="enemy"){var r=this.ballbox.shift().ms;if(this.type=="enemy"){WEHOUCORE.nowself.delHiter(r)}if(this.ms){WEHOUCORE.webgl.scene.remove(r);r.deallocate()}}else{if(this.type=="line"){var r=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(r);r.deallocate()}}}else{break}}return 22};WEHOUCORE.Bb1.prototype.clear=function(g,e,d){var c=this.ballbox.length;for(var f=0;f<c;f++){var b=this.ballbox[f];if(((b.ms.position.x-g.x)*(b.ms.position.x-g.x)+(b.ms.position.y-g.y)*(b.ms.position.y-g.y)<=e*e*d*d)&&this.ballbox[f].btime<=this.bt){this.ballbox[f].btime=this.bt+1}}};WEHOUCORE.Bb1.prototype.clean=function(){var b=this.ballbox.length;for(var d=0;d<b;d++){if(this.type=="ball"||this.type=="laser"||this.type=="enemy"||this.type=="self"){var c=this.ballbox.shift().ms;WEHOUCORE.nowself.delHiter(c);if(this.ms){WEHOUCORE.webgl.scene.remove(c);c.deallocate()}}else{if(this.type=="line"){var c=this.ballbox.shift().lms;WEHOUCORE.webgl.scene.remove(c);c.deallocate()}}}};WEHOUCORE.Bb2=function(a,b){this.parent=a;this.ms=b.mesh||null;this.rnum=b.numberrandom||0;this.lock=b.locked||false;this.gp=b.position||new THREE.Vector2(0,0);this.p=new THREE.Vector2();this.rp=b.positionrandom||new THREE.Vector2(0,0);this.pl=(b.positionlock===undefined)?true:b.positionlock;this.num=b.number||1;this.ds=b.distance||0;this.bt=b.lifetime||300;this.time=b.period||30;this.ot=0;this.ballbox=new Array();this.alpha=b.alpha||9;this.valpha=b.valpha||0;this.size=b.vsize||new THREE.Vector2(1,1);this.vsize=b.vsize||new THREE.Vector2(0,0);this.asize=b.asize||0;this.angle=b.angle||0;this.rangle=b.anglerandom||0};WEHOUCORE.Bb2.prototype.bread=function(g){var d;if(this.ot%this.time==0){var a=this.num+(this.rnum?-Math.floor(WEHOUCORE.random()*this.rnum):0);var n=(this.rp.x>0),f;if(!n&&this.rp.x){f=-WEHOUCORE.random()*this.rp.x+this.rp.x/2}var h=(this.rp.x>0),e;if(!h&&this.rp.y){e=-WEHOUCORE.random()*this.rp.y+this.rp.y/2}for(var d=0;d<a;d++){var o;if(this.ms){if(!this.ms.position){var b=Math.floor(WEHOUCORE.random()*this.ms.length);o=this.ms[b].clone();o.ms=this.ms[b].ms}else{o=this.ms.clone();if(this.ms.ms){o.ms=this.ms.ms}}}else{o=new Object();o.position=new Object()}o.position.x=this.p.x+(this.rp.x?(n?(WEHOUCORE.random()*this.rp.x-this.rp.x/2):f):0);o.position.y=this.p.y+(this.rp.y?(h?(WEHOUCORE.random()*this.rp.y-this.rp.y/2):e):0);o.position.z=2;o.rotation.z=(this.angle+WEHOUCORE.random()*this.rangle)*Math.PI/180;var c=new WEHOUCORE.Ball(o,new THREE.Vector2(1000,1000),0,0,0,[],this.alpha,this.valpha,this.size,this.vsize.clone());if(this.parentball){c.parentball=this.parentball}this.ballbox.push(c);if(this.ms){WEHOUCORE.webgl.scene.add(this.ballbox[this.ballbox.length-1].ms)}}}this.ot++;return 11};WEHOUCORE.Bb2.prototype.going=function(d){for(var b=0;b<this.ballbox.length;b++){var c=this.ballbox[b];c.vsize.x+=this.asize;c.vsize.y+=this.asize;if(c.vsize.x){c.ms.scale.x+=c.vsize.x}if(c.vsize.y){c.ms.scale.y+=c.vsize.y}if(c.valpha){c.alpha+=c.valpha}if(c.alpha>1){c.alpha=1}if(c.alpha<0){c.alpha=0}c.ms.scale.z=c.alpha;c.ms.position.z=WEHOUCORE.zcounter();c.btime++}for(var b=0;b<this.ballbox.length;){if(this.ballbox[b].btime>this.bt){var a=this.ballbox.shift().ms;if(this.ms){WEHOUCORE.webgl.scene.remove(a);a.deallocate()}}else{break}}return 22};WEHOUCORE.Bb2.prototype.clear=function(){var b=this.ballbox.length;for(var c=0;c<b;c++){if(this.ballbox[c].btime<this.bt){this.ballbox[c].btime=this.bt}}};