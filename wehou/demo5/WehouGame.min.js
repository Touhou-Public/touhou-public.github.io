var WEHOUGAME={};WEHOUGAME.mainstory=new WEHOUCORE.storySet("unknown");WEHOUGAME.renderintime=2;WEHOUGAME.rendereachtime=1;WEHOUGAME.slowtime=1;WEHOUGAME.onpause=false;WEHOUGAME.gotime=0;WEHOUGAME.lastshowtime=0;WEHOUGAME.power=0;WEHOUGAME.graze=0;WEHOUGAME.miss=0;WEHOUGAME.missall=0;WEHOUGAME.misscd=0;WEHOUGAME.misscut=0;WEHOUGAME.timecut=0;WEHOUGAME.score=0;WEHOUGAME.topscore=0;WEHOUGAME.hiscore=0;WEHOUGAME.kd=[];WEHOUGAME.lmturn=0;WEHOUGAME.inrep=false;WEHOUGAME.onsp=false;WEHOUGAME.repdata;WEHOUGAME.tempcanvas=new Array();WEHOUGAME.tempmesh=new Array();WEHOUGAME.tempspbg=new Array();WEHOUGAME.myplalist=new WEHOUCORE.planeSet();WEHOUGAME.myimglist=new WEHOUCORE.imgSet();WEHOUGAME.myshaderlist=new WEHOUCORE.shaderSet();WEHOUGAME.myplalistbre=new WEHOUCORE.planeSet();WEHOUGAME.myplalistot=new WEHOUCORE.planeSet();WEHOUGAME.myplalistsdr=new WEHOUCORE.planeSet();WEHOUGAME.myimglistbre=new WEHOUCORE.imgSet();WEHOUGAME.myplalistbos=new WEHOUCORE.planeSet();WEHOUGAME.myimglistbos=new WEHOUCORE.imgSet();WEHOUGAME.mymusiclist=new Array();WEHOUGAME.mymusicon=[];WEHOUGAME.myselist=new Array();WEHOUGAME.myaudio=new AudioContext()||NULL;WEHOUGAME.addBulletImg=function(b,a){WEHOUGAME.myimglistbre.add(b,a===undefined?1:a,1,1);return WEHOUGAME.myimglistbre.l.length-1};WEHOUGAME.getBulletImg=function(a){return WEHOUGAME.myimglistbre.l[a]};WEHOUGAME.addBullet=function(c,b,f,l,e,j,g,a){WEHOUGAME.myplalistbre.add(b,f,c,{d:l,end:(e=="laser"?1:0),rep:j||1,cut:(g?g:null),rt:(a?1:0)});return WEHOUGAME.myplalistbre.l.length-1};WEHOUGAME.getBullet=function(a){return WEHOUGAME.myplalistbre.l[a]};WEHOUGAME.addPla=function(c,b,d,e,a){WEHOUGAME.myplalistot.add(b,d,c,{end:0,cut:(e?e:null),rt:(a?1:0)});return WEHOUGAME.myplalistot.l.length-1};WEHOUGAME.getPla=function(a){return WEHOUGAME.myplalistot.l[a]};WEHOUGAME.addShader=function(c,b,d,f,a,e){WEHOUGAME.myplalistsdr.add(b,d,WEHOUGAME.myshaderlist.l[WEHOUGAME.myshaderlist.add({uniforms:{texture1:{type:"t",value:c.map}},vertexShader:f,fragmentShader:a})],{cut:e});return WEHOUGAME.myplalistsdr.l.length-1};WEHOUGAME.getShader=function(a){return WEHOUGAME.myplalistsdr.l[a]};WEHOUGAME.addBossImg=function(a){WEHOUGAME.myimglistbos.add(a,0,0);return WEHOUGAME.myimglistbos.l.length-1};WEHOUGAME.getBossImg=function(a){return WEHOUGAME.myimglistbos.l[a]};WEHOUGAME.addBoss=function(b,a,c,d){var e=WEHOUGAME.myplalistbos.add(a,c,b,{cut:d});WEHOUGAME.myplalistbos.l[e].add(WEHOUGAME.myplalist.l[0].clone());WEHOUGAME.myplalistbos.l[e].add(WEHOUGAME.myplalist.l[4].clone());WEHOUGAME.myplalistbos.l[e].add(WEHOUGAME.myplalist.l[5].clone());WEHOUGAME.myplalistbos.l[e].act=function(g){var f=Math.sin(WEHOUCORE.time/50)*0.4;var h=this.children[0];h.rotation.z+=0.1;h.scale.x=2.35+f;h.scale.y=2.35+f;if(g==1){var h=this.children[1];h.scale.x=0;h.scale.y=0;var h=this.children[2];h.scale.x=0;h.scale.y=0}};WEHOUGAME.myplalistbos.l[e].sp=function(h){var g=Math.sin(WEHOUCORE.time/50)*0.4;var j=this.children[0];j.rotation.z+=0.1;j.scale.x=2.35+g;j.scale.y=2.35+g;this.children[1].rotation.z-=0.02;this.children[2].rotation.z+=0.02;if(h<60){var f=WEHOUCORE.slowmove[3](h,0,1,60);var j=this.children[1];j.scale.x=j.scale.y=f;var j=this.children[2];j.scale.x=j.scale.y=f}};WEHOUGAME.myplalistbos.l[e].end=function(f){var g=this.children[0];g.rotation.z+=0.1;g.scale.x+=0.05;g.scale.y+=0.05;if(f==1){var g=this.children[1];g.scale.x=0;g.scale.y=0;var g=this.children[2];g.scale.x=0;g.scale.y=0}if(g.material.opacity>0){g.material.opacity-=0.005}}};WEHOUGAME.getBoss=function(a){return WEHOUGAME.myplalistbos.l[a]};WEHOUGAME.addMusic=function(b,a){var c=new Audio(b);if(a){c.loop=1}WEHOUGAME.mymusiclist.push(c)};WEHOUGAME.getMusic=function(a){return WEHOUGAME.mymusiclist[a]};WEHOUGAME.addSe=function(b){var a=new BufferLoader(WEHOUGAME.myaudio,b,function(c){WEHOUGAME.myselist=c});a.load()};WEHOUGAME.playSenow=new Array();WEHOUGAME.playSe=function(d,a,c){for(var b=0;b<WEHOUGAME.playSenow.length;b++){if(WEHOUGAME.playSenow[b][0]==d){return}}WEHOUGAME.playSenow.push([d,0,0])};if(WEHOUGAME.myaudio){WEHOUGAME.mainstory.seplay=WEHOUGAME.playSe;WEHOUGAME.playSenode=WEHOUGAME.myaudio.createGain();WEHOUGAME.playSenode.gain.value=0.15;WEHOUGAME.playSenode.connect(WEHOUGAME.myaudio.destination)}WEHOUGAME.runSe=function(){for(var a=0;a<WEHOUGAME.playSenow.length;a++){var b=WEHOUGAME.myaudio.createBufferSource();b.buffer=WEHOUGAME.myselist[WEHOUGAME.playSenow[a][0]];b.connect(WEHOUGAME.playSenode);b.start(0)}WEHOUGAME.playSenow=[]};WEHOUGAME.userInt=function(){};WEHOUGAME.intGame=function(e){e.innerHTML+="<div id='canvas-bg' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0px;left:0px;'></div><div id='canvas-core' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0;left:0;'></div><div id='canvas-ui' style='border:3px solid #000;width:"+(WEHOUCORE.w)+"px;height:"+(WEHOUCORE.h)+"px;position:absolute;top:0;left:0;'></div><div id='loadmsg'>加载基础代码中</div>";e.innerHTML+="<div id='hiscore' style='position:absolute;top:64px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#aaa;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='topscore' style='position:absolute;top:97px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#ddd;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='score' style='position:absolute;top:130px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#ddd;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div><div id='misscut' style='position:absolute;top:166px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#9f9;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div></div><div id='miss' style='position:absolute;top:202px;left:605px;width:130px;text-align:right;font-size:22px;font-family:Tahoma;color:#f99;font-weight:normal;text-shadow:#000 2px 0 0,#000 -2px 0 0,#000 0 2px 0,#000 0 -2px 0;'></div>";e.innerHTML+="<div id='game-talk' style='width:800px;height:600px;position:absolute;top:-25px;left:-30px;overflow:hidden;'></div>";if(!document.createElement("canvas").getContext("experimental-webgl")){alert("你的浏览器并不能很好的支持本游戏。\n请更换为chrome");WEHOUCORE.time=-10}WEHOUCORE.initcoreenv(document.getElementById("canvas-core"));WEHOUGAME.ui={};WEHOUGAME.ui.renderer=new THREE.WebGLRenderer({antialias:true});WEHOUGAME.ui.renderer.setSize(WEHOUCORE.w,WEHOUCORE.h);document.getElementById("canvas-ui").appendChild(WEHOUGAME.ui.renderer.domElement);WEHOUGAME.ui.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-20000,20000);WEHOUGAME.ui.camera.lookAt(new THREE.Vector3(0,0,0));WEHOUGAME.ui.scene=new THREE.Scene();document.getElementById("canvas-bg").appendChild(WEHOUGAME.bg.renderer.domElement);WEHOUGAME.bg.renderer.setClearColorHex(529450,1);WEHOUGAME.bg.scene=new THREE.Scene();WEHOUGAME.bg.camera=new THREE.OrthographicCamera(-WEHOUCORE.w/2,WEHOUCORE.w/2,WEHOUCORE.h/2,-WEHOUCORE.h/2,-2000,2000);WEHOUGAME.bg.rtt=new THREE.WebGLRenderTarget(500,550,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat});WEHOUGAME.bg.uniforms={texture1:{type:"t",value:WEHOUGAME.bg.rtt},texture2:{type:"t",value:0},uvb:{type:"v2",value:new THREE.Vector2(-1,-1)},move:{type:"v3",value:new THREE.Vector3(60,40,1.8)},is:{type:"f",value:-1},w:{type:"v2",value:new THREE.Vector2(WEHOUCORE.w,WEHOUCORE.h)},time:{type:"f",value:0},isover:{type:"f",value:0}};var p=new THREE.ShaderMaterial({uniforms:WEHOUGAME.bg.uniforms,vertexShader:"varying vec2 vUv;void main() {	vUv = uv;	gl_Position = projectionMatrix * modelViewMatrix * vec4( position,1.0 );}",fragmentShader:"uniform sampler2D texture1;uniform sampler2D texture2;uniform float is;uniform float isover;uniform float time;uniform vec3 move;uniform vec2 uvb;uniform vec2 w;varying vec2 vUv;void main(){	vec2 tuv=vec2(vUv.x*w.x-w.x/2.0,vUv.y*w.y-w.y/2.0);	vec2 uv2=vec2(vUv.x,vUv.y);	float dis=200.0;	if(is>0.0){		dis=sqrt((tuv.x-uvb.x)*(tuv.x-uvb.x)+(tuv.y-uvb.y)*(tuv.y-uvb.y));		if(dis<140.0){			uv2.x=uv2.x+(tuv.x-uvb.x)/1000.0*(140.0-dis)/140.0*sin(time+uv2.x*10.0);			uv2.y=uv2.y+(tuv.y-uvb.y)/1000.0*(140.0-dis)/140.0*sin(time+uv2.y*10.0);		}	}	vec4 fc=texture2D(texture1,uv2);	if(isover>0.5){		vec2 uv3=vec2(uv2.x*move.z+time/move.x,uv2.y*move.z+time/move.y);		vec4 fd=texture2D(texture2,uv3);		if(fd[3]>0.8){			fc.x=1.0-(1.0-fc.x)/fd.x;			fc.y=1.0-(1.0-fc.y)/fd.y;			fc.z=1.0-(1.0-fc.z)/fd.z;		}	}	if(is>0.0&&dis<80.0){		fc.x=fc.x+(1.0-fc.x)*(80.0-dis)/1280.0;		fc.z=fc.z+(1.0-fc.z)*(80.0-dis)/840.0;	}	gl_FragColor = fc;}"});WEHOUGAME.bg.face=new THREE.Mesh(new THREE.PlaneGeometry(WEHOUCORE.w,WEHOUCORE.h,0,0),p);WEHOUGAME.bg.scene.add(WEHOUGAME.bg.face);WEHOUGAME.addSe(["se/se_tan01.ogg","se/se_kira00.ogg","se/se_boon01.ogg","se/se_lazer01.ogg","se/se_timeout2.ogg","se/se_pldead00.ogg","se/se_cat00.ogg","se/se_enep01.ogg"]);WEHOUGAME.tempspbg[0]=THREE.ImageUtils.loadTexture("img/sp_1_bg.jpg");WEHOUGAME.tempspbg[1]=THREE.ImageUtils.loadTexture("img/sp_1_fl.png");WEHOUGAME.tempspbg[2]=THREE.ImageUtils.loadTexture("img/sp_2_bg.jpg");WEHOUGAME.tempspbg[3]=THREE.ImageUtils.loadTexture("img/sp_2_fl.png");WEHOUGAME.myimglist.add(["img/sysimg_01.png"],1,0);WEHOUGAME.myimglist.add(["img/img_player.png"],0,0);WEHOUGAME.myimglist.add(["img/eff_line.png"],1,0,0,1);WEHOUGAME.myimglist.l[2].map.wrapS=WEHOUGAME.myimglist.l[2].map.wrapT=THREE.RepeatWrapping;WEHOUGAME.myimglist.l[2].opacity=0.4;WEHOUGAME.myplalist.add(108,108,WEHOUGAME.myimglist.l[0],{cut:[0,1/4,5/8,7/8]});WEHOUGAME.myplalist.l[0].position.set(0,0,-2000);WEHOUGAME.myplalist.add(40,50,WEHOUGAME.myimglist.l[1],{cut:[0,1/8,1,13/16]});WEHOUGAME.myplalist.l[1].addMatrix=new THREE.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);WEHOUGAME.myplalist.l[1].addMatrix.elements[2]=1/8;WEHOUGAME.myplalist.add(77,77,WEHOUGAME.myimglist.l[0],{cut:[0,1/8,7/8,1]});WEHOUCORE.webgl.scene.add(WEHOUGAME.myplalist.l[1]);WEHOUCORE.webgl.scene.add(WEHOUGAME.myplalist.l[2]);var c=function(u,t,s){var r=new THREE.PlaneGeometry(400,12,u,0);for(i=0;i<u+1;i++){var q=WEHOUCORE.a2a(new THREE.Vector2(0,t),2*Math.PI/u*i);r.vertices[i].x=q.x;r.vertices[i].y=q.y}for(i=0;i<u+1;i++){var q=WEHOUCORE.a2a(new THREE.Vector2(0,s),2*Math.PI/u*i);r.vertices[i+u+1].x=q.x;r.vertices[i+u+1].y=q.y}return r};var o=c(59,190,210),a=[0,1,4/8,5/8];o.faceVertexUvs[0]=[];var h=59,f=1;for(iz=0;iz<1;iz++){for(ix=0;ix<59;ix++){o.faceVertexUvs[0].push([new THREE.UV((ix/h)*4,a[3]),new THREE.UV((ix/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[3])])}}WEHOUGAME.myplalist.l[4]=new THREE.Mesh(o,WEHOUGAME.myimglist.l[2]);WEHOUGAME.myplalist.l[4].position.set(0,0,-1500);o=c(59,212,232),a=[0,1,2/8,3/8];o.faceVertexUvs[0]=[];var h=59,f=1;for(iz=0;iz<1;iz++){for(ix=0;ix<59;ix++){o.faceVertexUvs[0].push([new THREE.UV((ix/h)*4,a[3]),new THREE.UV((ix/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[2]),new THREE.UV(((ix+1)/h)*4,a[3])])}}WEHOUGAME.myplalist.l[5]=new THREE.Mesh(o,WEHOUGAME.myimglist.l[2]);WEHOUGAME.myplalist.l[5].position.set(0,0,-1600);my2dpiclist=new Array();var g=new Image();g.src=WEHOUCORE.regimg("img/sysimg_01.png");my2dpiclist.push(g);g=new Image();g.src=WEHOUCORE.regimg("img/imgend.png");my2dpiclist.push(g);WEHOUGAME.tempcanvas[0]=document.createElement("canvas");WEHOUGAME.tempcanvas[0].width=455;WEHOUGAME.tempcanvas[0].height=40;WEHOUGAME.tempmesh[0]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[0]);WEHOUGAME.tempcanvas[1]=document.createElement("canvas");WEHOUGAME.tempcanvas[1].width=280;WEHOUGAME.tempcanvas[1].height=100;WEHOUGAME.tempmesh[1]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[1]);WEHOUGAME.tempcanvas[2]=document.createElement("canvas");WEHOUGAME.tempcanvas[2].width=300;WEHOUGAME.tempcanvas[2].height=50;WEHOUGAME.tempmesh[2]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[2]);WEHOUGAME.tempcanvas[3]=document.createElement("canvas");WEHOUGAME.tempcanvas[3].width=300;WEHOUGAME.tempcanvas[3].height=300;WEHOUGAME.tempmesh[3]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[3]);WEHOUGAME.tempcanvas[4]=document.createElement("canvas");WEHOUGAME.tempcanvas[4].width=500;WEHOUGAME.tempcanvas[4].height=550;WEHOUGAME.tempmesh[4]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[4]);WEHOUGAME.tempcanvas[5]=document.createElement("canvas");WEHOUGAME.tempcanvas[5].width=280;WEHOUGAME.tempcanvas[5].height=100;WEHOUGAME.tempmesh[5]=WEHOUCORE.canvas2mesh(WEHOUGAME.tempcanvas[5]);WEHOUGAME.tempcanvas[6]=document.createElement("canvas");WEHOUGAME.tempcanvas[6].width=300;WEHOUGAME.tempcanvas[6].height=6;WEHOUGAME.tempmesh[6]=new THREE.Mesh(c(59,66,72),new THREE.MeshBasicMaterial({map:new THREE.Texture(WEHOUGAME.tempcanvas[6]),transparent:true,depthWrite:false,depthTest:false}));var n=WEHOUGAME.tempcanvas[4].getContext("2d");n.font="bold 24px 黑体";n.textBaseline="hanging";n.textAlign="center";n.fillStyle="rgba(255,255,255,1)";n.lineWidth=2;n.strokeText("少女加载中",250,240);n.fillText("少女加载中",250,240);WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[4]);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);WEHOUGAME.userInt();var g=new Image();g.src=WEHOUCORE.regimg("img/imgload.png");g.onload=function(){var t=function(){var u=WEHOUGAME.tempcanvas[4].getContext("2d");u.clearRect(0,0,500,550);u.drawImage(g,0,0,500,550);WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);var v=function(y){y.stopPropagation();y.preventDefault();inrepstart=1;var x=new FileReader();x.readAsDataURL(y.dataTransfer.files[0]);x.onload=function(C){var B=this.result;var A=WEHOUGAME.tempcanvas[3].getContext("2d");var z=new Image();z.src=B;z.onload=function(){A.drawImage(z,0,0);WEHOUGAME.repdata=A.getImageData(0,0,300,300);var D="",E="";for(k=0;WEHOUGAME.repdata.data[k*2+10]!=255;k++){D+=String.fromCharCode(WEHOUGAME.repdata.data[k*2+10])}for(k=0;WEHOUGAME.repdata.data[k*2+64]!=255;k++){E+=String.fromCharCode(WEHOUGAME.repdata.data[k*2+64])}var F=WEHOUGAME.repdata.data[256-6]*65536+WEHOUGAME.repdata.data[256-4]*256+WEHOUGAME.repdata.data[256-2]*1;WEHOUCORE.randomseed=F;WEHOUGAME.inrep=true;if(D==WEHOUGAME.mainstory.name){alert("游戏地图为"+D+"的机师为"+E+"的一个replay加载成功")}else{alert("replay加载成功,但本游戏地图（"+WEHOUGAME.mainstory.name+"）与存档（"+D+"）不对应")}WEHOUGAME.gamestart()}};return false};var w=function(x){x.stopPropagation();x.preventDefault()};document.body.addEventListener("drop",v,false);document.body.addEventListener("dragover",w,false);document.body.onkeydown=function(x){if(x.keyCode==90){WEHOUGAME.gamestart()}else{if(x.keyCode==67){WEHOUCORE.cheat=1}}}};var r=WEHOUCORE.imglist;var s=document.getElementById("loadmsg");s.innerHTML="0/"+r.length;var q=function(v){if(v<=r.length){s.innerHTML=v+"/"+r.length;var u=new Image();u.src=r[v-1];u.onload=q(v+1);u.onerror=function(){alert("资源"+r[v-1]+"加载失败")}}else{s.innerHTML="";t()}};q(1)};var n=WEHOUGAME.tempcanvas[1].getContext("2d");n.font="bold 24px Tahoma";n.textBaseline="hanging";n.textAlign="center";n.fillStyle="#ffffff";n.lineWidth=2;n=WEHOUGAME.tempcanvas[0].getContext("2d");n.font="bold 21px 黑体";n.textBaseline="hanging";n.textAlign="right";n.fillStyle="#ffffff";n.lineWidth=2;n=WEHOUGAME.tempcanvas[2].getContext("2d");n.font="bold 19px 黑体";n.textBaseline="hanging";n.textAlign="center";n.fillStyle="#000000";n=WEHOUGAME.tempcanvas[5].getContext("2d");n.font="bold 8px Tahoma";n.textBaseline="hanging";n.textAlign="left";n.fillStyle="#a8f085";n.lineWidth=1;var l=WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(2),30,30,0,"ball",1,[3/8,4/8,7/8,6/8]);var j=WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(2),128,128,0,"ball",1,[8/16,9/16,15/16,1]);WEHOUGAME.mainstory.effect.add([{mesh:WEHOUGAME.getBullet(l),period:50,position:vec2(0,0),positionrandom:vec2(0,0),lifetime:100,valpha:-0.01,size:vec2(0,0),vsize:vec2(0.08,0.08),asize:-0.0008,anglerandom:360},{mesh:WEHOUGAME.getBullet(j),period:50,position:vec2(0,0),positionrandom:vec2(50,50),lifetime:100,valpha:-0.01,size:vec2(0,0),vsize:vec2(0.1,0.1),asize:-0.0005,anglerandom:360}]);WEHOUGAME.mainstory.actlist[0]=function(u,s){var r;if(s==0){if(u==""){r=WEHOUGAME.tempcanvas[0].getContext("2d");r.clearRect(0,0,555,40);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[0])}else{r=WEHOUGAME.tempcanvas[0].getContext("2d");r.clearRect(0,0,555,40);r.drawImage(my2dpiclist[0],0,128+64,400,50,200,0,400,50);r.strokeText(u,450,8);r.fillText(u,450,8);WEHOUGAME.tempmesh[0].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[0])}}if(s<=100&&s>20){WEHOUGAME.tempmesh[0].position.x=24;WEHOUGAME.tempmesh[0].position.y=WEHOUCORE.slowmove[0](s-20,-250,506,80)}else{if(s<20){var q=19-s;WEHOUGAME.tempmesh[0].position.x=24-q*50;WEHOUGAME.tempmesh[0].position.y=-250;WEHOUGAME.tempmesh[0].scale.x=q/5+1;WEHOUGAME.tempmesh[0].scale.y=q/5+1;WEHOUGAME.tempmesh[0].material.opacity=(19-q)/20}}};WEHOUGAME.mainstory.actlist[1]=function(v,s){var r=v.length/2;if(s<=r*110){if((s)%110==0){var q=v,u=(s)/110;if(u<r){n=WEHOUGAME.tempcanvas[2].getContext("2d");n.clearRect(0,0,400,70);if(q[u*2]==1){n.drawImage(my2dpiclist[0],0,256,256,44,0,0,300,50);n.fillText(q[u*2+1],150,23);WEHOUGAME.tempmesh[2].material.map.needsUpdate=true;WEHOUGAME.tempmesh[2].position.x=WEHOUCORE.bspos[0].x;WEHOUGAME.tempmesh[2].position.y=WEHOUCORE.bspos[0].y-50;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[2])}else{n.drawImage(my2dpiclist[0],0,304,256,44,0,0,300,50);n.fillText(q[u*2+1],150,7);WEHOUGAME.tempmesh[2].material.map.needsUpdate=true;WEHOUGAME.tempmesh[2].position.x=WEHOUCORE.lmpos.x;WEHOUGAME.tempmesh[2].position.y=WEHOUCORE.lmpos.y+50;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[2])}}else{n=WEHOUGAME.tempcanvas[2].getContext("2d");n.clearRect(0,0,400,70);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[2])}}}};WEHOUGAME.mainstory.actlist[2]=function(s,r,q){if(r==0){WEHOUGAME.gotime=s;WEHOUGAME.tempmesh[1].position.y=250;WEHOUGAME.tempmesh[1].material.opacity=0}else{if(r==q){WEHOUGAME.gotime=0}}};WEHOUGAME.mainstory.actlist[3]=function(r,q){if(q==0){WEHOUGAME.power=r}};WEHOUGAME.mainstory.actlist[4]=function(s,q){if(q==0){var r=WEHOUGAME.myplalistbos.l[s[0]];r.geometry.faceVertexUvs[0][0][0].u=r.geometry.faceVertexUvs[0][0][1].u=s[1][0];r.geometry.faceVertexUvs[0][0][2].u=r.geometry.faceVertexUvs[0][0][3].u=s[1][1];r.geometry.faceVertexUvs[0][0][0].v=r.geometry.faceVertexUvs[0][0][3].v=s[1][2];r.geometry.faceVertexUvs[0][0][1].v=r.geometry.faceVertexUvs[0][0][2].v=s[1][3];r.geometry.uvsNeedUpdate=true}};WEHOUGAME.mainstory.actlist[5]=function(r,q){if(q==0){if(!r){r=[]}WEHOUGAME.mymusicon=r;if(r.length){r[0].currentTime=r[1];r[0].volume=1;r[0].play()}}};WEHOUGAME.mainstory.actlist[6]=function(u,z,x){if(z==0){if(u[0]!=""){var y=WEHOUGAME.tempcanvas[5].getContext("2d");y.clearRect(0,0,280,100);y.strokeText(u[0],0,8);y.fillText(u[0],0,8);var r,q,w="",v=Math.floor(u[1]/10),s=u[1]%10;for(r=1;r<=v;r++){w="★★★★★★★★★★";y.strokeText(w,0,8+r*14);y.fillText(w,0,8+r*14)}w="";for(q=0;q<s;q++){w+="★"}y.strokeText(w,0,8+r*14);y.fillText(w,0,8+r*14);WEHOUGAME.tempmesh[5].position.x=-106;WEHOUGAME.tempmesh[5].position.y=232;WEHOUGAME.tempmesh[5].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[5])}else{WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[5])}}if(z<100&&u[2]==1){WEHOUGAME.tempmesh[5].position.y=232+(100-z)*0.2;WEHOUGAME.tempmesh[5].material.opacity=1-(100-z)*0.01}if(z==x&&u[3]){WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[5])}};WEHOUGAME.mainstory.actlist[7]=function(s,r){if(r==0){WEHOUGAME.topscore+=WEHOUGAME.score;if(WEHOUGAME.miss==0){WEHOUGAME.topscore+=WEHOUGAME.score*0.5}if(WEHOUGAME.topscore>WEHOUGAME.hiscore){WEHOUGAME.hiscore=WEHOUGAME.topscore;if(window.localStorage){localStorage.d5_hs=WEHOUGAME.hiscore;WEHOUGAME.hiscore=localStorage.d5_hs}}WEHOUGAME.miss=0;WEHOUGAME.misscut=s[1];WEHOUGAME.score=s[0];if(s[2]){WEHOUGAME.timecut=s[2]}else{WEHOUGAME.timecut=0}document.getElementById("topscore").innerHTML=WEHOUGAME.topscore;document.getElementById("hiscore").innerHTML=WEHOUGAME.hiscore;document.getElementById("miss").innerHTML="";var q=document.getElementById("misscut");if(WEHOUGAME.misscut<1){q.innerHTML=WEHOUGAME.misscut*100+"%"}else{q.innerHTML=""}}};WEHOUGAME.mainstory.actlist[8]=function(r,q){if(q==r[3]){r[0].position.set(0,60,10000);r[1].position.set(0,110,11000);r[2].position.set(140,60,9000);r[0].scale.z=0;r[1].scale.z=0;r[2].scale.z=0;WEHOUCORE.webgl.scene.add(r[0]);WEHOUCORE.webgl.scene.add(r[1]);WEHOUCORE.webgl.scene.add(r[2])}else{if(q==r[4]){WEHOUCORE.webgl.scene.remove(r[0]);WEHOUCORE.webgl.scene.remove(r[1]);WEHOUCORE.webgl.scene.remove(r[2])}else{if(q-r[3]<=50){r[1].scale.z=(q-r[3])/50;r[2].scale.z=(q-r[3])/50;r[2].rotation.z=(q-r[3])/50-1}if(q-r[3]<=90&&q-r[3]>40){r[0].scale.z=(q-r[3]-40)/50}if(r[4]-q<=50){r[0].scale.z=(r[4]-q)/50;r[1].scale.z=(r[4]-q)/50;r[2].scale.z=(r[4]-q)/50}}}};var d=0,m=0,b=0;WEHOUGAME.mainstory.actlist[9]=function(y,r,q){if(r==0){var x=document.getElementById("game-talk"),w="",s=0;d=0;m=0,b=0;for(var u=0;u<y[0].length-1;u++){w+="<div id=talkface_"+u+" style='background-image:url(img/face.png);background-position:-"+y[0][u][2]+"px -"+y[0][u][3]+"px;width:"+y[0][u][4]+"px;height:"+y[0][u][5]+"px;position:absolute;bottom:0;"+(y[0][u][1]==0?"left:0;":"right:"+(200-s*60)+"px;")+"'></div>";if(y[0][u][1]){s++}}w+="<div id=talkface_msg style='background-color:rgba(255,238,170,0.9);border:3px solid #000;position:absolute;bottom:100px;font-size:20px;font-family:黑体;padding:10px 20px;border-radius:14px;'>我说，这是测试的文字。<br>你明白我的意思啦~</div>";x.innerHTML=w;if(y[0][u][0]){b=99999}}else{if(r==q){document.getElementById("game-talk").innerHTML=""}}for(u=1;u<y.length;u++){if(r+m==y[u][0]){d=u;for(var v=0;v<y[0].length-1;v++){var x=document.getElementById("talkface_"+v);if(v==y[u][1]){x.style.opacity=1;x.style.margin="0"}else{x.style.opacity=0.75;x.style.margin="0 -50px -20px -50px"}}var x=document.getElementById("talkface_msg");if(y[0][y[u][1]][1]){x.style.right="300px";x.style.left=""}else{x.style.left="150px";x.style.right=""}x.innerHTML=y[u][2]}}if(WEHOUGAME.kd[5]){if(b){b--;return}if(y[d+1]){m=y[d+1][0]-r-1}else{WEHOUGAME.mainstory.storyCT("jumpnext");b=99999;return}b=10}};WEHOUGAME.mainstory.actlist[10]=function(y,w,u){var x=y[0],r=WEHOUCORE.bshit[x];var q=WEHOUGAME.tempcanvas[6].getContext("2d");var s=function(){for(xxx=1;xxx<y[1].length-1;xxx++){q.fillStyle="#63f";q.fillRect(300*y[1][xxx]-1,0,3,6);q.fillStyle="#fff";q.fillRect(300*y[1][xxx],1,1,4)}};if(w==0){q.clearRect(0,0,300,6);q.fillStyle="#f00";q.fillRect(0,1,300,1);q.fillRect(0,4,300,1);s();WEHOUGAME.tempmesh[6].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[6]);WEHOUGAME.tempmesh[6].position.z=-100}else{if(w==u&&y[3]){WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[6])}}if(r>=0){q.clearRect(0,2,300,2);q.fillStyle="#fff";if(y[2]!=99){q.fillRect(0,2,300*((y[1][y[2]]-y[1][y[2]+1])*r+y[1][y[2]+1]),2)}else{q.fillRect(0,2,300*r,2)}s();WEHOUGAME.tempmesh[6].material.map.needsUpdate=true}else{if(r==-3&&y[3]){WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[6])}}WEHOUGAME.tempmesh[6].position.x=WEHOUCORE.bspos[x].x;WEHOUGAME.tempmesh[6].position.y=WEHOUCORE.bspos[x].y};WEHOUGAME.mainstory.actlist[11]=function(s,r,q){if(r==1){WEHOUGAME.playSe(6);WEHOUGAME.onsp=true;WEHOUGAME.bg.uniforms.texture1.value=WEHOUGAME.tempspbg[2*s[0]];WEHOUGAME.bg.uniforms.texture2.value=WEHOUGAME.tempspbg[2*s[0]+1];WEHOUGAME.bg.uniforms.texture1.value.wrapS=WEHOUGAME.bg.uniforms.texture1.value.wrapT=THREE.RepeatWrapping;WEHOUGAME.bg.uniforms.texture2.value.wrapS=WEHOUGAME.bg.uniforms.texture2.value.wrapT=THREE.RepeatWrapping;WEHOUGAME.bg.uniforms.isover.value=1;if(s[1]){var r=WEHOUGAME.bg.uniforms.move.value;r.x=s[1].x;r.y=s[1].y;r.z=s[1].z}}if(r==q){WEHOUGAME.onsp=false;WEHOUGAME.bg.uniforms.texture1.value=WEHOUGAME.bg.rtt;WEHOUGAME.bg.uniforms.isover.value=0}};WEHOUCORE.deal.cheathit=WEHOUCORE.deal.hit=function(){if(!WEHOUGAME.misscd){WEHOUGAME.playSe(5);WEHOUGAME.misscd=60;WEHOUGAME.miss++;WEHOUGAME.missall++;if(WEHOUGAME.misscut<1){WEHOUGAME.score=Math.floor(WEHOUGAME.misscut*WEHOUGAME.score);document.getElementById("miss").innerHTML=WEHOUGAME.miss;WEHOUGAME.mainstory.effect.push(0,WEHOUCORE.lmpos)}}};WEHOUCORE.deal.graze=function(){};WEHOUCORE.deal.hitting=function(){if(!WEHOUGAME.timecut){WEHOUGAME.score+=130}};WEHOUCORE.webgl.renderer.clear()};WEHOUGAME.puase=function(){if(WEHOUGAME.onpause){WEHOUGAME.onpause=false;if(WEHOUGAME.mymusicon.length){WEHOUGAME.mymusicon[0].play()}WEHOUGAME.render()}else{WEHOUGAME.onpause=true;if(WEHOUGAME.mymusicon.length){WEHOUGAME.mymusicon[0].pause()}}};WEHOUGAME.gamestart=function(){var a=WEHOUGAME.tempcanvas[4].getContext("2d");a.clearRect(0,0,800,600);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[4]);if(window.localStorage&&localStorage.d5_hs){WEHOUGAME.hiscore=localStorage.d5_hs}WEHOUGAME.kd=[0,0,0,0,0,0];if(!WEHOUGAME.inrep){document.body.onkeydown=function(b){if(b.keyCode==37){WEHOUGAME.kd[0]=1}if(b.keyCode==38){WEHOUGAME.kd[1]=1}if(b.keyCode==39){WEHOUGAME.kd[2]=1}if(b.keyCode==40){WEHOUGAME.kd[3]=1}if(b.keyCode==90){WEHOUGAME.kd[5]=1}if(b.keyCode==88){WEHOUGAME.kd[4]=1;history.go(0)}if(b.keyCode==27){WEHOUGAME.puase()}WEHOUGAME.kd[4]=b.shiftKey};document.body.onkeyup=function(b){if(b.keyCode==37){WEHOUGAME.kd[0]=0}if(b.keyCode==38){WEHOUGAME.kd[1]=0}if(b.keyCode==39){WEHOUGAME.kd[2]=0}if(b.keyCode==40){WEHOUGAME.kd[3]=0}if(b.keyCode==90){WEHOUGAME.kd[5]=0}if(b.keyCode==88){WEHOUGAME.kd[4]=0}WEHOUGAME.kd[4]=b.shiftKey}}else{document.body.onkeydown=function(b){if(b.keyCode==88){history.go(0)}};document.body.onkeyup=function(b){}}a=WEHOUGAME.tempcanvas[3].getContext("2d");if(!WEHOUGAME.inrep){WEHOUGAME.repdata=a.createImageData(300,300)}else{}WEHOUGAME.render()};WEHOUGAME.gameover=function(){cxt=WEHOUGAME.tempcanvas[4].getContext("2d");cxt.drawImage(my2dpiclist[1],0,0,500,550);cxt.font="normal 22px Tahoma";cxt.textAlign="left";cxt.fillStyle="#ddd";cxt.lineWidth=6;cxt.strokeText(WEHOUGAME.topscore,266,230-5);cxt.fillText(WEHOUGAME.topscore,266,230-5);cxt.strokeText(WEHOUGAME.missall,266,270-10);cxt.fillText(WEHOUGAME.missall,266,270-10);if(window.localStorage){localStorage.d5_hs=WEHOUGAME.hiscore}WEHOUGAME.tempmesh[4].material.map.needsUpdate=true;WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[4]);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);document.body.onkeydown=function(d){if(d.keyCode==90){history.go(0)}else{if(d.keyCode==67){var b=WEHOUCORE.randomseed;var c=prompt("请输入您的名字:");if(!c){history.go(0);return}if(c.length>30){c=c.substr(0,30)}for(k=0;k<WEHOUGAME.mainstory.name.length;k++){WEHOUGAME.repdata.data[k*2+10]=WEHOUGAME.mainstory.name.charCodeAt(k);WEHOUGAME.repdata.data[k*2+11]=255}WEHOUGAME.repdata.data[k*2+10]=255;WEHOUGAME.repdata.data[k*2+11]=255;WEHOUGAME.repdata.data[k*2+12]=255;WEHOUGAME.repdata.data[k*2+13]=255;for(k=0;k<c.length;k++){WEHOUGAME.repdata.data[k*2+64]=c.charCodeAt(k);WEHOUGAME.repdata.data[k*2+65]=255}WEHOUGAME.repdata.data[k*2+64]=255;WEHOUGAME.repdata.data[k*2+65]=255;WEHOUGAME.repdata.data[k*2+66]=255;WEHOUGAME.repdata.data[k*2+67]=255;WEHOUGAME.repdata.data[256-8]=255;WEHOUGAME.repdata.data[256-7]=255;WEHOUGAME.repdata.data[256-6]=(b&16711680)/65536;WEHOUGAME.repdata.data[256-5]=255;WEHOUGAME.repdata.data[256-4]=(b&65280)/256;WEHOUGAME.repdata.data[256-3]=255;WEHOUGAME.repdata.data[256-2]=(b&255)/1;WEHOUGAME.repdata.data[256-1]=255;var a=WEHOUGAME.tempcanvas[3].getContext("2d");a.putImageData(WEHOUGAME.repdata,0,0);alert("正在输出replay图片，右键保存此图片即可");window.open(WEHOUGAME.tempcanvas[3].toDataURL("image/png"));history.go(0)}}}};WEHOUGAME.render=function(){if((!WEHOUCORE.gameover)&&(!WEHOUGAME.onpause)){requestAnimationFrame(WEHOUGAME.render)}else{if(WEHOUCORE.gameover){WEHOUGAME.gameover();return 0}}if(WEHOUCORE.time%WEHOUGAME.slowtime==0){var n;if(WEHOUGAME.inrep){var f=WEHOUGAME.repdata.data[WEHOUCORE.time*2+256];if(f&1){WEHOUGAME.kd[0]=1}else{WEHOUGAME.kd[0]=0}if(f&2){WEHOUGAME.kd[1]=1}else{WEHOUGAME.kd[1]=0}if(f&4){WEHOUGAME.kd[2]=1}else{WEHOUGAME.kd[2]=0}if(f&8){WEHOUGAME.kd[3]=1}else{WEHOUGAME.kd[3]=0}if(f&16){WEHOUGAME.kd[4]=1}else{WEHOUGAME.kd[4]=0}if(f&32){WEHOUGAME.kd[5]=1}else{WEHOUGAME.kd[5]=0}}else{WEHOUGAME.repdata.data[WEHOUCORE.time*2+256-1]=255;WEHOUGAME.repdata.data[WEHOUCORE.time*2+256]=(WEHOUGAME.kd[0]*1+WEHOUGAME.kd[1]*2+WEHOUGAME.kd[2]*4+WEHOUGAME.kd[3]*8+WEHOUGAME.kd[4]*16+WEHOUGAME.kd[5]*32);WEHOUGAME.repdata.data[WEHOUCORE.time*2+256+1]=255;WEHOUGAME.repdata.data[WEHOUCORE.time*2+256+3]=255}if(WEHOUGAME.kd[4]){n=2}else{n=6.8}if(WEHOUGAME.kd[0]+WEHOUGAME.kd[1]+WEHOUGAME.kd[2]+WEHOUGAME.kd[3]>=2){n*=0.707}if(WEHOUGAME.kd[0]){WEHOUCORE.lmpos.x-=n}if(WEHOUGAME.kd[1]){WEHOUCORE.lmpos.y+=n}if(WEHOUGAME.kd[2]){WEHOUCORE.lmpos.x+=n}if(WEHOUGAME.kd[3]){WEHOUCORE.lmpos.y-=n}if(WEHOUGAME.power){var l=(WEHOUGAME.power.x>=10000)?WEHOUCORE.lmpos.x+WEHOUGAME.power.x-20000:WEHOUGAME.power.x;var h=(WEHOUGAME.power.y>=10000)?WEHOUCORE.lmpos.y+WEHOUGAME.power.y-20000:WEHOUGAME.power.y;var m=WEHOUGAME.power.z,b=Math.sqrt((l-WEHOUCORE.lmpos.x)*(l-WEHOUCORE.lmpos.x)+(h-WEHOUCORE.lmpos.y)*(h-WEHOUCORE.lmpos.y));if(m<b){WEHOUCORE.lmpos.x+=(l-WEHOUCORE.lmpos.x)/b*m;WEHOUCORE.lmpos.y+=(h-WEHOUCORE.lmpos.y)/b*m}else{WEHOUCORE.lmpos.x=l;WEHOUCORE.lmpos.y=h}}var e=WEHOUCORE.w/2-20,d=WEHOUCORE.h/2-20;if(WEHOUCORE.lmpos.x>e){WEHOUCORE.lmpos.x=e}if(WEHOUCORE.lmpos.x<-e){WEHOUCORE.lmpos.x=-e}if(WEHOUCORE.lmpos.y>d){WEHOUCORE.lmpos.y=d}if(WEHOUCORE.lmpos.y<-d){WEHOUCORE.lmpos.y=-d}var j=WEHOUGAME.myplalist.l[1];j.position.set(WEHOUCORE.lmpos.x,WEHOUCORE.lmpos.y,1);if(WEHOUGAME.kd[0]&&WEHOUGAME.lmturn>-4){WEHOUGAME.lmturn--}else{if(WEHOUGAME.kd[2]&&WEHOUGAME.lmturn<4){WEHOUGAME.lmturn++}else{if(WEHOUGAME.lmturn<0){WEHOUGAME.lmturn++}else{if(WEHOUGAME.lmturn>0){WEHOUGAME.lmturn--}}}}if(WEHOUGAME.lmturn==0){j.addMatrix.elements[8]=Math.floor(WEHOUCORE.time/6)%8;j.addMatrix.elements[9]=0}else{if(WEHOUGAME.lmturn==4){j.addMatrix.elements[8]=Math.floor(WEHOUCORE.time/6)%4+4;j.addMatrix.elements[9]=4}else{if(WEHOUGAME.lmturn==-4){j.addMatrix.elements[8]=Math.floor(WEHOUCORE.time/6)%4+4;j.addMatrix.elements[9]=2}else{if(WEHOUGAME.lmturn>0){j.addMatrix.elements[8]=Math.floor(WEHOUGAME.lmturn);j.addMatrix.elements[9]=4}else{if(WEHOUGAME.lmturn<0){j.addMatrix.elements[8]=Math.floor(-WEHOUGAME.lmturn);j.addMatrix.elements[9]=2}}}}}var j=WEHOUGAME.myplalist.l[2];j.rotation.z+=0.02;WEHOUGAME.mainstory.deal();j.position.set(WEHOUCORE.lmpos.x,WEHOUCORE.lmpos.y,WEHOUCORE.zcounter());if(WEHOUGAME.gotime>0){if(WEHOUGAME.gotime==999999){var c="∞"}else{WEHOUGAME.gotime--;var c=(WEHOUGAME.gotime/60).toFixed(1)}if(c!=WEHOUGAME.lastshowtime){cxt=WEHOUGAME.tempcanvas[1].getContext("2d");cxt.clearRect(0,0,280,100);cxt.strokeText(c+"s",150,2);cxt.fillText(c+"s",150,2);WEHOUGAME.tempmesh[1].material.map.needsUpdate=true;WEHOUGAME.lastshowtime=c;if(c<10&&c%1==0){WEHOUGAME.playSe(4)}}if(WEHOUGAME.tempmesh[1].position.y>200){WEHOUGAME.tempmesh[1].position.y-=0.5;WEHOUGAME.tempmesh[1].material.opacity+=0.008}else{WEHOUGAME.tempmesh[1].position.y=200}WEHOUGAME.ui.scene.add(WEHOUGAME.tempmesh[1])}else{if(WEHOUGAME.gotime==0){WEHOUGAME.gotime=-1;cxt=WEHOUGAME.tempcanvas[1].getContext("2d");cxt.clearRect(0,0,180,100);WEHOUGAME.ui.scene.remove(WEHOUGAME.tempmesh[1])}}if(WEHOUGAME.mymusicon.length){var a=WEHOUGAME.mymusicon;if(a[0].currentTime>=a[2]){if(!a[3]){a[0].pause()}else{a[0].currentTime=a[3];a[0].play()}}}WEHOUGAME.misscd>0?WEHOUGAME.misscd--:0;if(WEHOUGAME.score+WEHOUGAME.timecut>0){WEHOUGAME.score+=WEHOUGAME.timecut}else{WEHOUGAME.score=0}document.getElementById("score").innerHTML=WEHOUGAME.score;var e=WEHOUCORE.w/2+30,d=WEHOUCORE.h/2+30;if(WEHOUCORE.bspos[0].x>-e&&WEHOUCORE.bspos[0].x<e&&WEHOUCORE.bspos[0].y>-d&&WEHOUCORE.bspos[0].y<d){WEHOUGAME.bg.uniforms.is.value=1.1}else{WEHOUGAME.bg.uniforms.is.value=-1.1}WEHOUGAME.bg.uniforms.time.value+=0.13;WEHOUGAME.bg.uniforms.uvb.value.x=WEHOUCORE.bspos[0].x;WEHOUGAME.bg.uniforms.uvb.value.y=WEHOUCORE.bspos[0].y;WEHOUGAME.bg.callback(WEHOUCORE.time)}if(WEHOUCORE.time%WEHOUGAME.renderintime==1){WEHOUGAME.runSe();WEHOUGAME.myshaderlist.deal();if(!WEHOUGAME.onsp){WEHOUGAME.bg.renderer.render(WEHOUGAME.bg.bscene,WEHOUGAME.bg.bcamera,WEHOUGAME.bg.rtt,true)}WEHOUGAME.bg.renderer.render(WEHOUGAME.bg.scene,WEHOUGAME.bg.camera);WEHOUCORE.webgl.renderer.render(WEHOUCORE.webgl.scene,WEHOUCORE.webgl.camera);WEHOUGAME.ui.renderer.render(WEHOUGAME.ui.scene,WEHOUGAME.ui.camera);stats.update()}WEHOUCORE.time++};