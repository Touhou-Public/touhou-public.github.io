<!DOCTYPE html>
<html>
<head>
<title>WEBGL弹幕游戏work-lrdcq.com</title>
<script src="Three.WH.min.js"></script>
<script src="stats.min.js"></script>
<script src="audio.min.js"></script>
<script src="WehouCore.js"></script>
<script src="WehouGame.js"></script>
</head>
<body style="background-image:url('img/bg.jpg');background-repeat:no-repeat;">
<div id="mygame"style='position:fixed;top:25px;left:30px;'></div>
</body>
<script type="text/javascript">
//帧频检测器
stats=new Stats();
stats.domElement.style.position='absolute';
stats.domElement.style.bottom='0px';
stats.domElement.style.zIndex=100;
document.body.appendChild(stats.domElement);

var vec2=function(x,y){
	return new THREE.Vector2(x,y);
}
var vec3=function(x,y,z){
	return new THREE.Vector3(x,y,z);
}

//自定义的背景模型渲染组
init2();
function init2() {
	WEHOUGAME.bg={}
	WEHOUGAME.bg.renderer=new THREE.WebGLRenderer({antialias:true});
	WEHOUGAME.bg.renderer.setSize(WEHOUCORE.w,WEHOUCORE.h);
	
	var camerap=new THREE.PerspectiveCamera(45,5/5.5, 1,25000 );
	camerap.position.set(0,0,70);
	var scenep=new THREE.Scene();

	scenep.add(new THREE.PointLight(0xffffff,1,5000));
	//齿轮1
	var gearc = [];
	for(i=0;i<100;i++){
		gearc.push(WEHOUCORE.a2a(vec2(0,(i%4<2)?300:330),2*Math.PI/100*i));
	}
	var gears1=new THREE.Shape(gearc);
	var count=4;
	for(j=0;j<count;j++){
		var x=[];
		for(i=0;i<24;i++){
			x.push(WEHOUCORE.a2a(vec2(0,240),2*Math.PI/100*(i+100/count*j+1)));
		}
		x.push(WEHOUCORE.a2a(vec2(-16,16),2*Math.PI/100*(100/count*j)));
		gears1.holes.push(new THREE.Path(x));
	}
	var mesh_g_1=new THREE.Mesh(new THREE.ExtrudeGeometry(gears1,{amount:50,bevelEnabled:false}),new THREE.MeshLambertMaterial({color:0x666666}));
	mesh_g_1.position.set(0,400,-2000);
	//齿轮2
	var gearc = [];
	for(i=0;i<100;i++){
		gearc.push(WEHOUCORE.a2a(vec2(0,330),2*Math.PI/100*i));
	}
	var gears2=new THREE.Shape(gearc);
	var gearc2 = [];
	for(i=0;i<100;i++){
		gearc2.push(WEHOUCORE.a2a(vec2(0,(i%4<2)?300:270),2*Math.PI/100*i));
	}
	gears2.holes.push(new THREE.Path(gearc2));
	var mesh_g_2=new THREE.Mesh(new THREE.ExtrudeGeometry(gears2,{amount:50,bevelEnabled:false}),new THREE.MeshLambertMaterial({color:0x666666}));
	mesh_g_2.position.set(0,400,-2000);
	//display
	var bearlist=[];
	for(i=0;i<5;i++){
		var bk=mesh_g_2.clone();
		bk.position.x=WEHOUCORE.random()*2400-1200;
		bk.position.y=400+WEHOUCORE.random()*800;
		bk.position.z=-8000/5*i;
		bk.rotation.x=Math.random()*Math.PI;
		bk.rotation.y=Math.random()*Math.PI;
		bk.rotation.z=Math.random()*Math.PI;
		scenep.add(bk);
		bearlist.push(bk);
	}
	for(i=0;i<10;i++){
		var bk=mesh_g_1.clone();
		bk.position.x=WEHOUCORE.random()*2400-1200;
		bk.position.y=400+WEHOUCORE.random()*800;
		bk.position.z=-8000/10*i;
		bk.rotation.x=Math.random()*Math.PI;
		bk.rotation.y=Math.random()*Math.PI;
		bk.rotation.z=Math.random()*Math.PI;
		scenep.add(bk);
		bearlist.push(bk);
	}
	//cloud
	var mt=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture('img/cloud_1.png')})
	mt.transparent=true;
	mt.opacity=0.3;
	var meshk=new THREE.Mesh(new THREE.PlaneGeometry(1000,800,0,0),mt);
	meshk.position.set(0,0,-9000)
	meshk.lookAt({x:0,y:0,z:0});
	var msklist=[],plist=[];
	for(i=0;i<100;i++){
		plist.push([Math.random()*4000-2000,-300-Math.random()*500,-15000/100*i]);
	}
	for(i=0;i<plist.length;i++){
		var msehks=meshk.clone();
		msehks.position.x=plist[i][0];
		msehks.position.y=plist[i][1];
		msehks.position.z=plist[i][2];
		scenep.add(msehks);
		msklist.push(msehks);
	}
	//fog
	scenep.fog = new THREE.Fog(0x08142a,1000,8000);
	//
	WEHOUGAME.bg.callback=function(timebg){
		//cloud
		for(i=0;i<msklist.length;i++){
			msklist[i].position.z+=16;
			if(msklist[i].position.z>0){msklist[i].position.z=-15000}
		}
		for(i=0;i<bearlist.length;i++){
			bearlist[i].position.z+=16;
			if(bearlist[i].position.z>0){bearlist[i].position.z=-8000}
			bearlist[i].rotation.z+=0.012;
		}
	}
	//注册背景
	WEHOUGAME.bg.bscene=scenep;
	WEHOUGAME.bg.bcamera=camerap;
	WEHOUCORE.randomuse=0;
}
</script>
<script type="text/javascript">
WEHOUGAME.userInt=function(){
	WEHOUGAME.addMusic("bgm.ogg",1);
	WEHOUGAME.addBulletImg(['img/bullet_1.png','img/bullet_2.png','img/sysimg_01.png'],1);
	WEHOUGAME.addBulletImg(['img/bullet_1.png','img/enemy.png'],0);
	WEHOUGAME.addBossImg(['img/boss.png']);
	WEHOUGAME.addBoss(WEHOUGAME.getBossImg(0),108,108,[0/2,1/2,1,1/2]);
	WEHOUGAME.addBoss(WEHOUGAME.getBossImg(0),108,108,[1/2,2/2,1,1/2]);
	//故事
	var lasttime=0;
	var story=WEHOUGAME.mainstory;
	//
	story.setName('demo5_20140606_end1');
	//
	WEHOUGAME.addPla(WEHOUGAME.getBulletImg(2),320,80,[1/16,11/16,8/32,3/32]);//id==0 关卡标题
	WEHOUGAME.addPla(WEHOUGAME.getBulletImg(2),160,16,[6/16,11/16,3/32,2/32]);//id==1 关卡标题2
	WEHOUGAME.addPla(WEHOUGAME.getBulletImg(2),160,160,[11/16,16/16,5/16,0/16]);//id==3 关卡图案
	//
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(2),16,64,0,'laser',1,[0,1/32,10/32,6/32]);//id==0  自机弹幕
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(4),36,36,8,'ball',12,[12/16,13/16,16/16,15/16]);//id=1 蓝色小妖精
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(4),36,36,8,'ball',12,[12/16,13/16,13/16,12/16]);//id=2 红色小妖精
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,6,'ball',1,[2/16,3/16,29/32,28/32]);//id=3 红色小玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,6,'ball',1,[7/16,6/16,29/32,28/32]);//id=4 蓝色小玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(4),48,48,10,'ball',12,[12/32,15/32,32/32,29/32]);//id=5 红色大妖精
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(4),48,48,10,'ball',12,[12/32,15/32,23/32,20/32]);//id=6 蓝色大妖精
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,6,'ball',1,[9/16,10/16,29/32,28/32]);//id=7 青绿色小玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,6,'ball',1,[14/16,15/16,29/32,28/32]);//id=8 青绿色小玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(4),64,64,16,'ball',12,[0/8,1/8,7/16,5/16]);//id=9 花蝴蝶
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),20,20,6,'ball',1,[7/16,6/16,29/32,28/32]);//id=10 蓝色小玉(光)
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),64,64,12,'ball',1,[4/4,3/4,0/8,1/8]);//id=11 蓝色大玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),48,48,10,'ball',1,[4/8,5/8,8/16,9/16]);//id=12 蓝色椭玉
	
	//生成一个环
	var make_c=function(n,r){
		var vv=[];
		for(i=0;i<n;i++){
			var x=WEHOUCORE.a2a(vec2(0,r),2*Math.PI/n*i);
			vv.push(vec3(x.x,x.y,0));
		}
		return vv;
	}
	var tm_1=make_c(32,250),tm_2=make_c(16,64),tm_3=make_c(48,350),tm_4=make_c(32,240);
	//
	story.add(//前半道中
		{},
		[
			{mesh:WEHOUGAME.getBullet(1),period:28,position:vec2(300,100),target:vec2(-1000,20000),positionlock:false,speed:[4],rotating:false,bulletevents:[['t',50,['v',3,0,'va',0.3,0,'bb',[2,0],0]]],type:'enemy',hitblood:15,dieevents:[['bb',[3,0]]]},//0 开场自机狙妖精
			{mesh:WEHOUGAME.getBullet(2),period:28,timeoffset:14,position:vec2(-300,150),target:vec2(1000,20000),positionlock:false,speed:[4],rotating:false,bulletevents:[['t',50,['v',3,0,'va',-0.3,0,'bb',[2,0],0]]],type:'enemy',hitblood:15,dieevents:[['bb',[3,0]]]},//1 开场自机狙妖精2
			{mesh:WEHOUGAME.getBullet(3),number:12,period:5000,speed:[5],bulletevents:[['t',8,['t',vec2(29999,29999),0]]],outfield:true,birthse:1},//2 开场自机狙妖精的弹幕
			{mesh:WEHOUGAME.getBullet(4),period:2,speed:[7],outfield:true},//3 开场自机狙妖精的死尸弹幕
			
			{mesh:WEHOUGAME.getBullet(5),period:370,position:vec2(0,300),target:vec2(20000,-1000),positionlock:false,speed:[1],rotating:false,bulletevents:[['t',1,['bb',[6,0],0]]],type:'enemy',hitblood:500,lifetime:700,hitdistance:30},//4 红色大妖精
			{mesh:WEHOUGAME.getBullet(6),period:370,position:vec2(0,300),target:vec2(20000,-1000),positionlock:false,speed:[1],rotating:false,bulletevents:[['t',1,['bb',[7,0],0]]],type:'enemy',hitblood:500,lifetime:700,timeoffset:185,hitdistance:30},//5 红色大妖精
			{vert:tm_1,motion:'mesh',meshrotate:vec3(Math.PI/240,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(4),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//6
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/240,-Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(7),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//7
			{mesh:WEHOUGAME.getBullet(5),period:370,position:vec2(-160,300),target:vec2(20000,-1000),positionlock:false,speed:[1],rotating:false,bulletevents:[['t',1,['bb',[11,0],0]]],type:'enemy',hitblood:300,lifetime:600,hitdistance:30},//8 红色大妖精
			{mesh:WEHOUGAME.getBullet(5),period:370,position:vec2(160,300),target:vec2(20000,-1000),positionlock:false,speed:[1],rotating:false,bulletevents:[['t',1,['bb',[11,0],0]]],type:'enemy',hitblood:300,lifetime:600,hitdistance:30},//9 红色大妖精
			{mesh:WEHOUGAME.getBullet(6),period:370,position:vec2(0,300),target:vec2(20000,-1000),positionlock:false,speed:[1],rotating:false,bulletevents:[['t',1,['bb',[12,0],0]]],type:'enemy',hitblood:300,lifetime:600,timeoffset:185,hitdistance:30},//10 红色大妖精
			{vert:tm_1,motion:'mesh',meshrotate:vec3(Math.PI/240,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(8),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//11
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/240,-Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(7),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//12
			
			{mesh:WEHOUGAME.getBullet(11),speed:[1],anglerandom:360,period:6,gravity:vec2(0,-0.003),decay:vec2(1,1),motion:'gravity',outfield:true,lifetime:600,bulletevents:[['t',160,['a',vec2(0,-0.05),0]]]},//13 蓝色重力弹
			{mesh:WEHOUGAME.getBullet(9),period:10000,position:vec2(-300,140),target:vec2(1000,20000),positionlock:false,speed:[5],rotating:false,bulletevents:[['t',1,['bb',[18,0],0]],['t',2,['bb',[20,0],0]],['t',30,['v',1.1,0,'va',-0.1,0,'bb',[13,0],0]],['t',330,['a',0.07,0,'va',0,0]]],type:'enemy',hitblood:450,lifetime:400,hitdistance:32},//14 花蝶 左
			{mesh:WEHOUGAME.getBullet(9),period:10000,position:vec2(300,140),target:vec2(-1000,20000),positionlock:false,speed:[5],rotating:false,bulletevents:[['t',1,['bb',[18,0],0]],['t',2,['bb',[20,0],0]],['t',30,['v',1.1,0,'va',0.1,0,'bb',[13,0],0]],['t',330,['a',0.07,0,'va',0,0]]],type:'enemy',hitblood:450,lifetime:400,timeoffset:370,hitdistance:32},//15 花蝶 右
			{mesh:WEHOUGAME.getBullet(9),period:10000,position:vec2(-300,140),target:vec2(1000,20000),positionlock:false,speed:[5],rotating:false,bulletevents:[['t',1,['bb',[18,0],0]],['t',2,['bb',[20,0],0]],['t',20,['v',0.5,0,'va',0.1,0,'bb',[13,0],0]],['t',430,['a',0.07,0,'va',0,0]]],type:'enemy',hitblood:450,lifetime:700,hitdistance:32},//16 花蝶 左
			{mesh:WEHOUGAME.getBullet(9),period:10000,position:vec2(300,140),target:vec2(-1000,20000),positionlock:false,speed:[5],rotating:false,bulletevents:[['t',1,['bb',[18,0],0]],['t',2,['bb',[20,0],0]],['t',20,['v',0.5,0,'va',-0.1,0,'bb',[13,0],0]],['t',430,['a',0.07,0,'va',0,0]]],type:'enemy',hitblood:450,lifetime:700,hitdistance:32},//17 花蝶 右
			{locked:true,period:50000,lifetime:700,speed:[0],bulletevents:[['t',1,['bb',[19,0],0]]],diewithfather:true},//18 发射弹幕
			{mesh:WEHOUGAME.getBullet(12),number:15,angle:[3],period:120,speed:[2.8,3.1,3.4,3.7,4,4.3,4.6,4.9,4.6,4.3,4,3.7,3.4,3.1,2.8],outfield:true,timeoffset:40,birthse:2},//19
			{vert:tm_2,motion:'mesh',meshrotate:vec3(Math.PI/240,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(10),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-20],diewithfather:true},//20
		],
		[0,vec2(300,500),vec2(0,0),
		141,vec2(-9998,-9998),vec2(0,0),//开场自机狙
		335,vec2(-9998,-9998),vec2(0,0),//标题时间
		519,vec2(-9998,-9998),vec2(0,0),//圈圈小怪开始
		1254,vec2(-9998,-9998),vec2(0,0),//
		1980,vec2(-9998,-9998),vec2(0,0),//主旋律
		2743,vec2(-9998,-9998),vec2(0,0),//
		3480,vec2(-9998,-9998),vec2(0,0),//
		0],
		[[],[1,0],[],[4,5],[8,9,10],[14,15],[17,16]]
	);
	story.adds({time:3470,group:[0],act:[5,[WEHOUGAME.getMusic(0),0,225,1],8,[WEHOUGAME.getPla(0),WEHOUGAME.getPla(1),WEHOUGAME.getPla(2),335,739],7,[0,0.5,0]],bt:true});
	
	story.add(//中BOSS入场对话
		{mesh:WEHOUGAME.getBoss(0),delmesh:false},
		[],
		[0,vec2(300,500),vec2(0,0),
		141,vec2(0,120),vec2(0,0),//boss入场
		1410,vec2(0,120),vec2(0,0),//
		0],
		[[],[]]
	);
	story.adds({time:700,group:[1],act:[9,[[['早喵',0,70,0,300,380],['梅丽',1,385,0,300,380],[1]],[0,0,'嗯？有人？'],[175,1,'请问，您知道离开这里的路么？'],[350,0,'嗯...啊？<br>你是什么人？怎么会在这里？<br>停下!'],[525,1,'唔，来者不善么。<br>我只有打破这个梦了(和以前一样)!']],7,[0,0,-1]],bt:true});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),48,48,9,'ball',1,[7/8,8/8,8/16,9/16]);//id=13 白色椭玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,4,'ball',1,[4/16,5/16,26/32,27/32]);//id=14 紫色链弹
	story.add(//中BOSS1符
		{mesh:WEHOUGAME.getBoss(0),hit:3000,player:'sp',delmesh:false},
		[
		{position:vec2(-390,150),positionlock:false,positionrandom:vec2(0,250),target:vec2(2000,20000),bulletevents:[['t',2,['bb',[2,0],0]]],period:90,timeoffset:100},
		{position:vec2(-390,-150),positionlock:false,positionrandom:vec2(0,250),target:vec2(2000,20000),bulletevents:[['t',2,['bb',[2,0],0]]],period:90,timeoffset:145},
		{mesh:WEHOUGAME.getBullet(13),number:48,speed:[55],speedrandom:90,bulletevents:[['t',1,['t',vec2(2000,20000),0,'v',2.5,0]],['ds',[WEHOUCORE.bspos[0],40],['t',vec2(0,0),vec2(1000,1000),'v',4,1]]],period:10000,lifetime:320}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		200,vec2(0,150),vec2(160,80),
		0],
		[[0,1]]
	);
	story.adds({time:3200,group:[2],act:[0,'梦游「平流云」',6,['Maribel Hearn',2,1,1],2,3200,10,[0,[1,0],0,1],11,[0],7,[100000,0.8,-12]]});
	
	story.add(//12符间隔
		{mesh:WEHOUGAME.getBoss(0),delmesh:false},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(0,50),vec2(0,0),
		0],
		[[]]
	);
	story.adds({time:100,group:[3],act:[0,'',7,[0,0,-1]]});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),64,64,12,'ball',1,[2/4,3/4,2/8,1/8]);//id=15 绿色大玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),48,48,8,'ball',1,[5/8,6/8,8/16,9/16]);//id=16 绿色椭玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),48,48,8,'ball',1,[1/8,2/8,8/16,9/16]);//id=17 红色椭玉
	story.add(//中BOSS2符
		{mesh:WEHOUGAME.getBoss(0),hit:3500,player:'sp',delmesh:false},
		[
		{target:vec2(0,250),number:5,outfield:true,angle:[32],mesh:WEHOUGAME.getBullet(15),period:100,bulletevents:[['-x',-250,['bb',[1,0],0,'die',0,0]],['+x',250,['bb',[1,0],0,'die',0,0]],['+y',275,['bb',[1,0],0,'die',0,0]]],birthse:2},
		{period:1000,palstancerandom:4,lifetime:110,bulletevents:[['t',50,['va',0,5]],['t',1,['bb',[2,0],0]]],outfield:true},
		{period:4,mesh:WEHOUGAME.getBullet(16),outfield:true,speed:[0.001],anglerandom:360,rotating:3,positionrandom:vec2(0,0),lifetime:600,bulletevents:[['t',200,['v',3,0,'a',vec2(0,-0.05),0]]],gravity:vec2(0,0),decay:vec2(0.6,0.4),motion:'gravity'},
		{period:30,speed:[0.001],angle:[-360],distance:20,number:7,positionrandom:vec2(-500,-300),positionlock:false,position:vec2(0,100),lifetime:500,bulletevents:[['t',200,['v',3,0]]],mesh:WEHOUGAME.getBullet(17),timeoffset:30,outfield:true}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(-9999,50),vec2(0,0),
		200,vec2(-9998,50),vec2(0,0),
		300,vec2(-9998,50),vec2(0,0),
		0],
		[[0],[3],[]]
	);
	story.adds({time:3600,group:[4],act:[0,'梦游「特洛伊群的密林」',6,['Maribel Hearn',1,1,1],2,3600,10,[0,[1,0],0,1],11,[0],7,[120000,0.8,-12]]});
	
	story.add(//23符间隔
		{mesh:WEHOUGAME.getBoss(0),delmesh:false},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(0,0),vec2(0,0),
		0],
		[[]]
	);
	story.adds({time:100,group:[5],act:[0,'',7,[0,0,-1]]});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,6,'ball',1,[4/16,5/16,29/32,28/32]);//id=18 紫色小玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),48,48,8,'ball',1,[2/8,3/8,8/16,9/16]);//id=19 紫色椭玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),64,64,12,'ball',1,[4/4,3/4,2/8,1/8]);//id=20 紫色大玉
	story.add(//中BOSS3符
		{mesh:WEHOUGAME.getBoss(0),hit:3800,player:'sp',delmesh:false},
		[
		{mesh:WEHOUGAME.getBullet(19),period:1,number:2,speed:[0.001],target:vec2(30000,30000),bulletevents:[['t',180,['a',0.05,0]]],outfield:true,lifetime:360,distance:0},
		{vert:[vec3(-40,40,40),vec3(40,40,40),vec3(40,40,-40),vec3(-40,-40,40),vec3(-40,-40,-40),vec3(40,-40,-40),vec3(-70,70,70),vec3(70,70,70),vec3(70,70,-70),vec3(-70,-70,70),vec3(-70,-70,-70),vec3(70,-70,-70)],motion:'mesh',meshrotate:vec3(Math.PI/240,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(4),setrotate:vec3(0,0,0),period:50000,lifetime:50000,timeoffset:0,protect:true,locked:true,goback:[-0,-100]},
		{vert:[vec3(40,-40,40),vec3(-40,40,-40),vec3(90,-90,90),vec3(-90,90,-90)],motion:'mesh',meshrotate:vec3(Math.PI/240,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(18),setrotate:vec3(0,0,0),period:50000,lifetime:50000,timeoffset:0,protect:true,locked:true,goback:[-0,-100]},
		{vert:[vec3(100,-100,100),vec3(-100,100,-100)],motion:'mesh',meshrotate:vec3(Math.PI/240,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),setrotate:vec3(0,0,0),period:50000,lifetime:50000,timeoffset:0,protect:true,locked:true,goback:[-0,-100],bulletevents:[['t',120,['bb',[4,0],0]]]},
		{period:100,speed:[20],target:vec2(0,0),bulletevents:[['ds',[WEHOUCORE.bspos[0],10],['btime',99,0]],['t',99,['va',20,0,'v',0,0]],['t',100,['v',1,0,'va',0,0,'bb',[0,0],0]],['t',101,['v',30,0]]],outfield:true,mesh:WEHOUGAME.getBullet(20),myevents:[[560,'time',50]],birthse:2}
		],
		[0,vec2(0,0),vec2(0,0),
		10000,vec2(0,0),vec2(0,0),
		0],
		[[1,2,3]]
	);
	story.adds({time:4000,group:[6],act:[0,'魔术「空间撕裂器」',6,['Maribel Hearn',0,1,1],2,4000,10,[0,[1,0],0,1],11,[0],7,[200000,0.8,-12]]});
	
	story.add(//中BOSS出场
		{mesh:WEHOUGAME.getBoss(0)},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(300,500),vec2(0,0),//
		1410,vec2(300,500),vec2(0,0),//
		0],
		[[],[]]
	);
	story.adds({time:200,group:[7],act:[9,[[['早喵',0,70,0,300,380],[1]],[0,0,'喂!(跑了?)'],[100,0,'等等!']],0,''],bt:true});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[1/16,2/16,27/32,28/32]);//id=21 红色礼弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[3/16,4/16,27/32,28/32]);//id=22 紫色礼弹
	story.add(//后半道中
		{},
		[
			{mesh:WEHOUGAME.getBullet(1),period:20,position:vec2(250,300),positionlock:false,speed:[4],rotating:false,bulletevents:[['t',50,['v',3,0,'bb',[2,0],0]]],type:'enemy',hitblood:20,dieevents:[['bb',[3,0]]]},//0 开场自机狙妖精
			{mesh:WEHOUGAME.getBullet(2),period:20,timeoffset:14,position:vec2(-250,300),positionlock:false,speed:[4],rotating:false,bulletevents:[['t',50,['v',3,0,'bb',[2,0],0]]],type:'enemy',hitblood:20,dieevents:[['bb',[3,0]]]},//1 开场自机狙妖精2
			{mesh:WEHOUGAME.getBullet(3),number:12,period:1000,speed:[5],bulletevents:[['t',8,['t',vec2(29999,29999),0]]],outfield:true,birthse:1},//2 开场自机狙妖精的弹幕
			{mesh:WEHOUGAME.getBullet(4),period:2,speed:[7],outfield:true},//3 开场自机狙妖精的死尸弹幕
			{position:vec2(250,300),positionlock:false,target:vec2(-2000,20000),speed:[1.6],bulletevents:[['t',1,['bb',[0,0],0]]],lifetime:300,period:1000},//4 牵引0号弹幕
			{position:vec2(-250,300),positionlock:false,target:vec2(2000,20000),speed:[1.6],bulletevents:[['t',1,['bb',[1,0],0]]],lifetime:300,period:1000},//5 牵引1号弹幕
			
			{mesh:WEHOUGAME.getBullet(5),period:370,position:vec2(0,300),positionlock:false,speed:[2],rotating:false,bulletevents:[['t',1,['bb',[8,0],0]],['t',2,['bb',[10,0],0]]],type:'enemy',hitblood:400,lifetime:320,hitdistance:30},//6 红色大妖精
			{mesh:WEHOUGAME.getBullet(6),period:370,position:vec2(0,300),positionlock:false,speed:[2],rotating:false,bulletevents:[['t',1,['bb',[9,0],0]],['t',2,['bb',[11,0],0]]],type:'enemy',hitblood:400,lifetime:320,timeoffset:185,hitdistance:30},//7 红色大妖精
			{vert:tm_1,motion:'mesh',meshrotate:vec3(Math.PI/2400,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(4),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//8
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/240,-Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(7),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//9
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/180,-Math.PI/240,-Math.PI/320),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(4),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//10
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/180,Math.PI/240,-Math.PI/320),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(7),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//11
			{mesh:WEHOUGAME.getBullet(5),period:370,position:vec2(-160,300),positionlock:false,speed:[2],rotating:false,bulletevents:[['t',1,['bb',[15,0],0]],['t',2,['bb',[17,0],0]]],type:'enemy',hitblood:250,lifetime:300,hitdistance:30},//12 红色大妖精
			{mesh:WEHOUGAME.getBullet(5),period:370,position:vec2(160,300),positionlock:false,speed:[2],rotating:false,bulletevents:[['t',1,['bb',[15,0],0]],['t',2,['bb',[17,0],0]]],type:'enemy',hitblood:250,lifetime:300,hitdistance:30},//13 红色大妖精
			{mesh:WEHOUGAME.getBullet(6),period:370,position:vec2(0,300),positionlock:false,speed:[2],rotating:false,bulletevents:[['t',1,['bb',[16,0],0]],['t',2,['bb',[18,0],0]]],type:'enemy',hitblood:250,lifetime:300,timeoffset:185,hitdistance:30},//14 红色大妖精
			{vert:tm_1,motion:'mesh',meshrotate:vec3(Math.PI/240,Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(8),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//15
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/240,-Math.PI/360,Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(7),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//16
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/180,-Math.PI/240,-Math.PI/320),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(8),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//17
			{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/180,Math.PI/240,-Math.PI/320),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(7),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],diewithfather:true},//18
			
			{mesh:WEHOUGAME.getBullet(9),period:10000,position:vec2(0,300),target:vec2(20000,-1000),positionlock:false,protect:true,speed:[3.75],rotating:false,bulletevents:[['t',80,['v',0.00001,0]],['t',81,['bb',[20,0],0]],['t',100,['bb',[21,0],0]],['t',101,['bb',[22,0],0]]],type:'enemy',hitblood:4500,lifetime:1300,hitdistance:32},//19 花蝶
			{vert:tm_3,motion:'mesh',meshrotate:vec3(Math.PI/340,Math.PI/460,Math.PI/400),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(3),setrotate:vec3(0,0,0),period:10000,lifetime:10000,protect:true,locked:true,goback:[-0,-150],diewithfather:true,birthse:3},//20
			{vert:tm_4,motion:'mesh',meshrotate:vec3(-Math.PI/240,Math.PI/360,-Math.PI/300),meshmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(18),setrotate:vec3(0,0,0),period:10000,lifetime:10000,protect:true,locked:true,goback:[-0,-150],diewithfather:true,birthse:3},//21
			{vert:[vec3(0,260,0),vec3(0,-260,0),vec3(260,0,0),vec3(-260,0,0)],motion:'mesh',meshrotate:vec3(-Math.PI/240,Math.PI/360,-Math.PI/300),meshmove:vec3(0,0,0),setrotate:vec3(0,0,0),period:10000,lifetime:10000,protect:true,locked:true,goback:[-0,-150],diewithfather:true,bulletevents:[['t',1,['bb',[23,0],0]]]},//22
			{mesh:WEHOUGAME.getBullet(22),speed:[4],period:3,target:vec2(0,0),lifetime:240,outfield:true},//23
		],
		[0,vec2(300,500),vec2(0,0),//自机狙小怪
		335,vec2(-9998,-9998),vec2(0,0),//圈圈小怪开始
		1070,vec2(-9998,-9998),vec2(0,0),//
		1796,vec2(-9998,-9998),vec2(0,0),//主旋律
		1900,vec2(-9998,-9998),vec2(0,0),//
		3500,vec2(-9998,-9998),vec2(0,0),//
		0],
		[[4,5],[6,7],[12,13,14],[],[19]]
		//[[19],[],[],[],[]]
	);
	story.adds({time:3400,group:[8],act:[7,[0,0.6,0]],bt:true});
	
	story.add(//BOSS入场对话
		{mesh:WEHOUGAME.getBoss(0),delmesh:false},
		[],
		[0,vec2(-300,500),vec2(0,0),
		141,vec2(-80,120),vec2(0,0),//boss入场
		14100,vec2(-80,120),vec2(0,0),//
		0],
		[[],[]]
	);
	story.add(//BOSS入场对话
		{mesh:WEHOUGAME.getBoss(1),delmesh:false},
		[],
		[0,vec2(300,500),vec2(0,0),
		141,vec2(80,120),vec2(0,0),//boss入场
		14100,vec2(80,120),vec2(0,0),//
		0],
		[[],[]]
	);
	story.adds({time:1800,group:[9,10],act:[4,[0,[1/2,0/2,1,1/2]],7,[0,0,-1],9,[[['早喵',0,70,0,300,380],['梅莉',1,385,0,300,380],['莲子',1,700,0,300,380],[]],
	[0,0,'喂?你们什么人啊'],
	[300,1,'唔，那个..'],
	[600,2,'梅莉，你累了就先走吧。'],
	[900,1,'可是..'],
	[1200,0,'我说，<br>这是什么情况?'],
	[1500,2,'以符卡决斗回应，这就是幻想乡么?<br>梅莉，你先走吧，我一会儿来找你。']
	]],bt:true});
	
	story.add(//BOSS入场对话
		{mesh:WEHOUGAME.getBoss(0)},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		141,vec2(-300,600),vec2(0,0),//boss入场
		14100,vec2(-9998,-9998),vec2(0,0),//
		0],
		[[],[]]
	);
	story.add(//BOSS入场对话
		{mesh:WEHOUGAME.getBoss(1),delmesh:false},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		141,vec2(0,120),vec2(0,0),//boss入场
		14100,vec2(-9998,-9998),vec2(0,0),
		0],
		[[],[]]
	);
	story.adds({time:150,group:[11,12],act:[7,[0,0,-1]],bt:true});
	
	story.add(//BOSS入场对话
		{mesh:WEHOUGAME.getBoss(1),delmesh:false},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		14100,vec2(-9998,-9998),vec2(0,0),
		0],
		[[]]
	);
	story.adds({time:2400,group:[13],act:[5,[WEHOUGAME.getMusic(0),0,0.1,0],7,[0,0,-1],9,[[['早喵',0,70,0,300,380],['莲子',1,700,0,300,380],[]],
	[0,1,'现在你的对手是我了'],
	[300,0,'你们难道是外面的人？'],
	[600,1,'嗯，是吧。<br>我们正是寻找这里(幻想乡)而来。'],
	[900,0,'那，你萌还是快回去吧...这里很危险的=。=||'],
	[1200,1,'危险是危险，我可是有备而来。'],
	[1500,0,'?'],
	[1800,1,'我可是好好研究了符卡规则而来的!<br>来吧，痛快的来一场符卡决斗!'],
	[2100,1,'让你见识一下，<br><strong>幻想外的(科学的)力量</strong>!']
	]],bt:true});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[6/16,7/16,23/32,24/32]);//id=23 蓝色铳弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[3/16,4/16,23/32,24/32]);//id=24 紫色铳弹
	story.add(//BOSS 1非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2000,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:4,number:6,angleoffset:30,anglefactor:[14,20],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2,0]]],cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:120,timeoffset:70,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		200,vec2(0,150),vec2(100,50),
		0],
		[[0,1]]
	);
	story.adds({time:3000,group:[14],act:[0,'',7,[100000,0.7,-12],2,3000,10,[0,[1,0.36,0],0,0],5,[WEHOUGAME.getMusic(0),225,409.591,225.133]]});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),28,2000,6,'laser',1,[3/16,4/16,31/32,32/32]);//id=25 紫色激光
	story.add(//BOSS1符
		{mesh:WEHOUGAME.getBoss(1),hit:3000,player:'sp',delmesh:false,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(24),palstance:[1.5],palstancerandom:3,speedrandom:2,period:1,outfield:true},
		{mesh:WEHOUGAME.getBullet(24),palstance:[-1.5],palstancerandom:3,speedrandom:2,period:1,outfield:true},
		{period:130,type:'laser',number:3,angle:[15],speed:[1000],mesh:WEHOUGAME.getBullet(25),appearline:60,lifetime:130,bulletevents:[['t',1,['v',0.0001,0]]],birthse:4}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(0,120),vec2(0,0),
		5000,vec2(0,120),vec2(0,0),
		0],
		[[],[0,1,2]]
	);
	story.adds({time:3900,group:[15],act:[0,'天象「中子星喷发」',7,[120000,0.5,-12],6,['Usami Renko',9,1,1],2,3900,10,[0,[1,0.36,0],1,0],11,[1,vec3(100,-100,1.2)]]});
	
	story.add(//BOSS 2非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2000,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:2,number:4,angleoffset:0,anglefactor:[16,60],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2,0]]],cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:60,timeoffset:65,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		200,vec2(0,150),vec2(100,50),
		0],
		[[0,1]]
	);
	story.adds({time:3000,group:[16],act:[0,'',7,[100000,0.7,-12],2,3000,10,[0,[1,0.32,0],0,0]]});
	
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[3/16,4/16,13/32,14/32]);//id=26 紫色锚弹
	story.add(//BOSS2符
		{mesh:WEHOUGAME.getBoss(1),hit:2400,player:'sp',delmesh:false,kick_dis:30},
		[
		{period:1,speed:[4.8],bulletevents:[['nt',[1,0],['t',WEHOUCORE.lmpos,0]],['t',1,['bb',[9,0],0]]],lifetime:150},
		{period:1,speed:[4.8],bulletevents:[['nt',[1,0],['t',WEHOUCORE.lmpos,0]],['t',1,['bb',[5,0],0]]],lifetime:150},
		{period:1,speed:[4.8],bulletevents:[['nt',[1,0],['t',WEHOUCORE.lmpos,0]],['t',1,['bb',[6,0],0]]],lifetime:150},
		{period:1,speed:[4.8],bulletevents:[['nt',[1,0],['t',WEHOUCORE.lmpos,0]],['t',1,['bb',[7,0],0]]],lifetime:150},
		{period:1,speed:[4.8],bulletevents:[['nt',[1,0],['t',WEHOUCORE.lmpos,0]],['t',1,['bb',[8,0],0]]],lifetime:150},
		{mesh:WEHOUGAME.getBullet(24),speed:[0.001],period:2,lifetime:500,bulletevents:[['t',200,['v',0.5,0]],['t',250,['a',0.035,0]]],target:vec2(20000,-1000),anglechange:[4,40000],outfield:true},
		{mesh:WEHOUGAME.getBullet(24),speed:[0.001],period:2,lifetime:500,bulletevents:[['t',200,['v',0.5,0]],['t',250,['a',0.035,0]]],target:vec2(20000,-1000),anglechange:[-4,-40000],outfield:true},
		{mesh:WEHOUGAME.getBullet(18),speed:[0.001],period:2,lifetime:600,bulletevents:[['t',300,['v',0.5,0]],['t',350,['a',0.035,0]]],target:vec2(20000,-1000),anglechange:[12,40000],outfield:true},
		{mesh:WEHOUGAME.getBullet(18),speed:[0.001],period:2,lifetime:600,bulletevents:[['t',300,['v',0.5,0]],['t',350,['a',0.035,0]]],target:vec2(20000,-1000),anglechange:[-12,-40000],outfield:true},
		{mesh:WEHOUGAME.getBullet(20),speed:[0.001],period:2,lifetime:200},
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(-9999,120),vec2(0,0),
		101,vec2(-9998,120),vec2(0,0),
		500,vec2(-9998,120),vec2(0,0),
		0],
		[[],[0,1,2,3,4],[]]
	);
	story.adds({time:4500,group:[17],act:[0,'物像「弦理论宇宙」',7,[120000,0.5,-12],6,['Usami Renko',8,1,1],2,4500,10,[0,[1,0.32,0],1,0],11,[1,vec3(100,-100,1.2)]]});
	
	story.add(//BOSS 3非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2000,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:2,number:4,lifetime:360,angleoffset:45,anglefactor:[12,25],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.2,0]],['+y',275,['-y',0,0]]],cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:60,timeoffset:65,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		50,vec2(0,120),vec2(0,0),
		5000,vec2(0,120),vec2(0,0),
		0],
		[[],[0,1]]
	);
	story.adds({time:3000,group:[18],act:[0,'',2,3000,7,[100000,0.7,-12],10,[0,[1,0.45,0],0,0]]});
	
	var hb_vert=[];
	for(var i=0;i<8;i++){
		var x=WEHOUCORE.a2a(vec2(0,45),2*Math.PI/8*i);
		for(var j=-2;j<=2;j++){
			hb_vert.push(vec3(x.x,x.y,j*40));
		}
	}
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),20,20,3,'ball',1,[7/16,8/16,28/32,29/32]);//id=27 色弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),20,20,3,'ball',1,[5/16,6/16,28/32,29/32]);//id=28 色弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),10,180,2,'laser',1,[6/16,7/16,28/32,29/32]);//id=29 蓝色短激光
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),24,24,4,'ball',1,[5/16,6/16,22/32,23/32]);//id=30 蓝色星弹
	story.add(//BOSS3符
		{mesh:WEHOUGAME.getBoss(1),hit:4000,player:'sp',delmesh:false,kick_dis:30},
		[
		{vert:hb_vert,motion:'mesh',mesh:WEHOUGAME.getBullet(27),meshrotate:vec3(0,-Math.PI/320,0),setrotate:vec3(Math.PI/5,0,0),period:50000,lifetime:50000,locked:true},
		{vert:new THREE.PlaneGeometry(240,80,4,2).vertices,motion:'mesh',mesh:WEHOUGAME.getBullet(28),meshrotate:vec3(0,-Math.PI/320,0),setrotate:vec3(Math.PI/5,0,0),period:50000,lifetime:50000,locked:true,setmove:vec3(140,0,0)},
		{vert:new THREE.PlaneGeometry(240,80,4,2).vertices,motion:'mesh',mesh:WEHOUGAME.getBullet(28),meshrotate:vec3(0,-Math.PI/320,0),setrotate:vec3(Math.PI/5,0,0),period:50000,lifetime:50000,locked:true,setmove:vec3(-140,0,0)},
		{vert:[vec3(0,0,80),vec3(0,0,-80)],motion:'mesh',meshrotate:vec3(0,-Math.PI/320,0),setrotate:vec3(Math.PI/5,0,0),period:50000,lifetime:50000,locked:true,bulletevents:[['t',1,['bb',[4,0],0]]]},
		{type:'laser',mesh:WEHOUGAME.getBullet(29),appearline:0,period:10,lifetime:100,speed:[4.5],target:vec2(0,0),bulletevents:[['+y',275,['bb',[5,0],0,'die',0,0]]],outfield:true},
		{mesh:WEHOUGAME.getBullet(30),number:8,angle:[0],rotating:2,outfield:true,speedrandom:3,speed:[2],palstancerandom:0.5,lifetime:450,bulletevents:[['t',300,['va',0,0,'a',0.03,0]]]}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(0,0),vec2(0,0),
		5000,vec2(-9998,-9998),vec2(0,0),
		0],
		[[],[0,1,2,3]]
	);
	story.adds({time:4500,group:[19],act:[0,'物像「失控的哈勃望远镜」',7,[150000,0.6,-12],6,['Usami Renko',7,1,1],2,4500,10,[0,[1,0.45,0],1,0],11,[1,vec3(100,-100,1.2)]]});
	
	story.add(//BOSS 4非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2000,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:2,number:4,lifetime:360,angleoffset:0,anglefactor:[12,48],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.2,0]]],cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:60,timeoffset:65,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		50,vec2(0,80),vec2(0,0),
		5000,vec2(0,80),vec2(0,0),
		0],
		[[],[0,1]]
	);
	story.adds({time:3000,group:[20],act:[0,'',7,[100000,0.7,-12],2,3000,10,[0,[1,0.45,0],0,0]]});
	
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),20,1800,5,'laser',1,[8/16,9/16,31/32,32/32]);//id=31 浅蓝色激光
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[9/16,10/16,23/32,24/32]);//id=32 青色铳弹
	story.add(//BOSS4符
		{mesh:WEHOUGAME.getBoss(1),hit:3600,player:'sp',delmesh:false,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(26),distance:120,speed:[0],palstance:[2000.5],locked:true,period:10000,lifetime:10000,protect:true,number:36},
		{type:'laser',mesh:WEHOUGAME.getBullet(31),target:vec2(20000,-1000),number:9,angle:[0],appearline:90,period:240,lifetime:180,speed:[1000],bulletevents:[['t',1,['v',0.001,0]],['t',100,['bb',[2,0],0]]],position:vec2(0,280),positionrandom:vec2(200,0),anglerandom:50,timeoffset:100,birthse:4},
		{speed:[-12],target:vec2(30000,30000),period:10000,lifetime:80,bulletevents:[['ds',[WEHOUCORE.bspos[0],120],['bb',[3,0],0]]]},
		{speed:[0.01],target:vec2(30000,30000),mesh:WEHOUGAME.getBullet(32),period:1,bulletevents:[['-ds',[WEHOUCORE.bspos[0],120],['die',0,0]],['ds',[WEHOUCORE.bspos[0],120],[]],['t',100,['v',2,2,'va',0,1]],['t',300,['a',0.035,0,'va',0,0]]],lifetime:400,outfield:true}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		300,vec2(0,100),vec2(300,50),
		0],
		[[0,1]]
	);
	story.adds({time:4500,group:[21],act:[0,'物像「光量子透镜」',7,[180000,0.8,-12],6,['Usami Renko',6,1,1],2,4500,10,[0,[1,0.45,0],1,0],11,[1,vec3(100,-100,1.2)]]});
	
	story.add(//BOSS 5非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2000,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:1,number:3,lifetime:360,angleoffset:0,anglefactor:[12,60],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.3,0]]],timeoffset:65,cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:30,timeoffset:65,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		65,vec2(-9999,100),vec2(0,0),
		0],
		[[0,1]]
	);
	story.adds({time:3000,group:[22],act:[0,'',7,[100000,0.7,-12],2,3000,10,[0,[1,0.4,0],0,0]]});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[13/16,14/16,23/32,24/32]);//id=33 黄色铳弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),24,24,4,'ball',1,[15/16,16/16,22/32,23/32]);//id=34 白色星弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),24,24,4,'ball',1,[3/16,4/16,22/32,23/32]);//id=35 紫色星弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),10,180,2,'laser',1,[15/16,16/16,28/32,29/32]);//id=36 白色短激光 29
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),10,180,2,'laser',1,[3/16,2/16,28/32,29/32]);//id=37 红色短激光
	story.add(//BOSS5符
		{mesh:WEHOUGAME.getBoss(1),hit:3000,player:'sp',delmesh:false,kick_dis:30},
		[
		{number:10,position:WEHOUCORE.lmpos,lifetime:40,speed:[-1],period:10,distance:130,mesh:WEHOUGAME.getBullet(33),positionlock:false,anglechange:[5,30000]},
		{number:10,lifetime:60,speed:[1],period:10,distance:30,mesh:WEHOUGAME.getBullet(33),anglechange:[5,30000]},
		{positionrandom:vec2(500,300),position:vec2(0,120),positionlock:false,lifetime:500,speed:[3.6],period:2,mesh:WEHOUGAME.getBullet(34),bulletevents:[['ds',[WEHOUCORE.lmpos,100],['p',WEHOUCORE.bspos[0],0,'die',0,0,'bb',[3,0],0]]],timeoffset:100,outfield:true,rotating:2},
		{mesh:WEHOUGAME.getBullet(35),speed:[2],target:vec2(30000,30000),rotating:2,bulletevents:[['t',100,['va',0,0.5]]]},
		{type:'laser',appearline:0,positionrandom:vec2(500,300),position:vec2(0,120),positionlock:false,lifetime:500,speed:[3.6],period:8,mesh:WEHOUGAME.getBullet(36),bulletevents:[['ds',[WEHOUCORE.lmpos,100],['p',WEHOUCORE.bspos[0],0,'die',0,0,'bb',[5,0],0]]],timeoffset:100,outfield:true},	
		{type:'laser',appearline:0,mesh:WEHOUGAME.getBullet(37),speed:[2],target:vec2(30000,30000)}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		200,vec2(0,200),vec2(400,50),
		500,vec2(-9998,-9998),vec2(0,0),
		0],
		[[0,1,2,4],[0,1]]
	);
	story.adds({time:4800,group:[23],act:[0,'镜像「虫洞效应」',7,[180000,0.6,-12],6,['Usami Renko',5,1,1],2,4800,10,[0,[1,0.4,0],1,0],11,[1,vec3(100,-100,1.2)]]});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[3/16,2/16,23/32,24/32]);//id=38 红色铳弹
	story.add(//BOSS 6非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2000,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:2,number:4,lifetime:360,angleoffset:45,anglefactor:[12,45],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.2,0]]],timeoffset:65,cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(38),period:2,number:4,lifetime:360,angleoffset:45,anglefactor:[12,-25],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.2,0]]],timeoffset:65,cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:120,timeoffset:65,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		65,vec2(-9999,100),vec2(0,0),
		0],
		[[0,1,2]]
	);
	story.adds({time:3000,group:[24],act:[0,'',7,[200000,0.7,-12],2,3000,10,[0,[1,0.34,0],0,0]]});
	
	var makeer=function(u, t) {
		u = u - 0.5;
		var v = 2 * Math.PI * t;
		var x, y, z;
		var a = 2;
		x = Math.cos(v) * (a + u * Math.cos(v/2));
		y = Math.sin(v) * (a + u * Math.cos(v/2));
		z = u * Math.sin(v/2);
		return vec3(x, y, z);
	}
	story.add(//BOSS6符
		{mesh:WEHOUGAME.getBoss(1),hit:3600,player:'sp',delmesh:false,kick_dis:30},
		[
		{vert:new THREE.ParametricGeometry(makeer,2,20).vertices,motion:'mesh',mesh:WEHOUGAME.getBullet(28),meshrotate:vec3(Math.PI/340,-Math.PI/840,-Math.PI/220),period:50000,lifetime:50000,locked:true,setsize:vec3(80,80,80),timeoffset:0},
		{vert:new THREE.ParametricGeometry(makeer,2,10).vertices,motion:'mesh',meshrotate:vec3(Math.PI/340,-Math.PI/840,-Math.PI/220),period:50000,lifetime:50000,locked:true,setsize:vec3(150,150,150),type:'line',linelong:50,linematerial:WEHOUGAME.getBulletImg(1),materialcut:[11/16,12/16],timeoffset:0,appeartime:60}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		50,vec2(-9998,-9998),vec2(0,0),
		200,vec2(-9999,50),vec2(100,100),
		0],
		[[],[0,1]]
	);
	story.adds({time:4800,group:[25],act:[0,'几何「旋转的莫比乌斯带」',7,[220000,0.8,-12],6,['Usami Renko',4,1,1],2,4800,10,[0,[1,0.34,0],1,0],11,[1,vec3(100,-100,1.2)]]});
	
	story.add(//BOSS 7非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2400,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:2,number:3,lifetime:260,angleoffset:45,anglefactor:[12,45],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.6,0]]],timeoffset:0,cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(38),period:1,number:3,lifetime:260,angleoffset:0,anglefactor:[66,-370],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.6,0]]],timeoffset:0,cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:120,timeoffset:65,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		65,vec2(0,100),vec2(0,0),
		6500,vec2(-9998,-9998),vec2(0,0),
		0],
		[[],[0,1,2]]
	);
	story.adds({time:3000,group:[26],act:[0,'',7,[200000,0.7,-12],2,3000,10,[0,[1,0.4,0],0,0]]});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),240,2000,0,'laser',1,[15/16,16/16,9/32,11/32]);//id=39 挡板
	story.add(//BOSS7符
		{mesh:WEHOUGAME.getBoss(1),hit:3800,player:'sp',delmesh:false,kick_dis:30},
		[
		{type:'laser',appearline:30,locked:true,mesh:WEHOUGAME.getBullet(39),period:10000,lifetime:10000,target:vec2(20000,-1000),speed:[1000],bulletevents:[['t',1,['v',0.0001,0]]]},
		{mesh:WEHOUGAME.getBullet(23),target:vec2(-1000,20000),position:vec2(255,0),period:1,number:1,angle:[0],positionrandom:vec2(0,550),positionlock:false,speed:[1.5],speedrandom:1,bulletevents:[['-x',40120,['die',0,0]]],outfield:true},
		{mesh:WEHOUGAME.getBullet(23),target:vec2(-1000,20000),position:vec2(255,-10),period:1,number:1,angle:[0],positionrandom:vec2(0,550),positionlock:false,speed:[2.5],speedrandom:1,outfield:true},
		{mesh:WEHOUGAME.getBullet(38),target:vec2(1000,20000),position:vec2(-255,0),period:1,number:1,angle:[0],positionrandom:vec2(0,550),positionlock:false,speed:[1.5],speedrandom:1,bulletevents:[['+x',39880,['die',0,0]]],outfield:true},
		{mesh:WEHOUGAME.getBullet(38),target:vec2(1000,20000),position:vec2(-255,-5),period:1,number:1,angle:[0],positionrandom:vec2(0,550),positionlock:false,speed:[2.5],speedrandom:1,outfield:true}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		50,vec2(-9998,-9998),vec2(0,0),
		200,vec2(-120,100),vec2(50,100),
		250,vec2(-9998,-9998),vec2(0,0),
		400,vec2(120,100),vec2(50,100),
		0],
		[[0],[1,1,2],[],[3,3,4]]
	);
	story.adds({time:4800,group:[27],act:[0,'镜像「隧穿阱」',7,[220000,0.5,-12],6,['Usami Renko',3,1,1],2,4800,10,[0,[1,0.4,0],1,0],11,[1,vec3(100,-100,1.2)]]});
	
	story.add(//BOSS 8非
		{mesh:WEHOUGAME.getBoss(1),delmesh:false,hit:2400,kick_dis:30},
		[
		{mesh:WEHOUGAME.getBullet(23),period:1,number:3,lifetime:260,angleoffset:0,anglefactor:[66,355],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.7,0]]],timeoffset:0,cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(38),period:1,number:3,lifetime:260,angleoffset:0,anglefactor:[66,-360],speed:[8],target:vec2(20000,-1000),outfield:true,bulletevents:[['t',10,['v',2.7,0]]],timeoffset:0,cloudprotect:false},
		{mesh:WEHOUGAME.getBullet(24),period:120,timeoffset:65,number:64,speed:[5],outfield:true,birthse:1,cloudprotect:false}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		65,vec2(0,100),vec2(0,0),
		6500,vec2(-9998,-9998),vec2(0,0),
		0],
		[[],[0,1,2]]
	);
	story.adds({time:3000,group:[28],act:[0,'',7,[200000,0.7,-12],2,3000,10,[0,[1,0.45,0],0,0]]});
	
	story.add(//BOSS8符
		{mesh:WEHOUGAME.getBoss(1),hit:3200,player:'sp',delmesh:false},
		[
		{mesh:WEHOUGAME.getBullet(23),period:2,number:1,lifetime:110,angleoffset:0,anglefactor:[66,180],speed:[-4],distance:440,target:vec2(20000,-1000),bulletevents:[],timeoffset:0,numberchange:[0.02,15],myevents:[[60,'ne',[0.006,15]]]},
		{mesh:WEHOUGAME.getBullet(24),distance:450,period:132,timeoffset:65,number:24,speed:[-2],lifetime:225}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		50,vec2(0,0),vec2(0,0),
		35000,vec2(0,0),vec2(0,0),
		0],
		[[],[0,1]]
	);
	story.adds({time:5400,group:[29],act:[0,'N维弦「塌陷空间」',7,[300000,0.5,-12],6,['Usami Renko',2,1,1],2,5400,10,[0,[1,0.45,0],1,1],11,[1,vec3(100,-100,1.2)]]});
	
	story.add(//BOSS引导9符
		{mesh:WEHOUGAME.getBoss(1)},
		[
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(0,0),vec2(0,0),
		0],
		[[]]
	);
	story.adds({time:100,group:[30],act:[0,'',3,vec3(0,0,5.2),7,[0,0,-1]],bt:true});
	
	
	var tm_1=make_c(24,240),tm_2=make_c(28,260),tm_3=make_c(32,280);
	var mat_rot=function(rmat){
		var t=new THREE.Matrix4();
		t.setPosition(vec3(0,0,0));
		t.setRotationFromEuler(rmat,THREE.Object3D.defaultEulerOrder);
		t.scale(vec3(1,1,1));
		return t;
	}
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,4,'ball',1,[5/16,6/16,30/32,29/32]);//id=40 深蓝色小玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),36,36,5,'ball',4,[0/8,1/8,5/16,6/16]);//id=41 红色炎弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),50,400,10,'laser',1,[4/16,5/16,29/32,28/32]);//id=42 紫色弹幕
	story.add(//BOSS9符
		{mesh:WEHOUGAME.getBoss(1),player:'sp',hit:0},
		[
		{vert:new THREE.IcosahedronGeometry(220,2).vertices,motion:'mesh',meshrotate:vec3(0,0,0),setrotate:vec3(0.1,0.1,0),mesh:WEHOUGAME.getBullet(40),period:50000,lifetime:50000,timeoffset:0,protect:true,locked:true,goback:[-0,-60],bulletevents:[
		['t',1800,['v',mat_rot(vec3(Math.PI/2000,Math.PI/2000,Math.PI/2000)),0,'se',3,0]],
		['t',1850,['v',mat_rot(vec3(Math.PI/1000,Math.PI/1000,Math.PI/1000)),0]],
		['t',2100,['v',mat_rot(vec3(Math.PI/700,Math.PI/700,Math.PI/700)),0,'se',3,0]],
		['t',2250,['v',mat_rot(vec3(Math.PI/460,Math.PI/460,Math.PI/460)),0]],
		['t',2400,['v',mat_rot(vec3(Math.PI/330,Math.PI/330,Math.PI/330)),0,'se',3,0]]
		]},
		
		{vert:tm_1,motion:'mesh',meshrotate:vec3(-Math.PI/800,Math.PI/800,-Math.PI/800),mesh:WEHOUGAME.getBullet(41),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],goback:[-0,-60],timeoffset:0,bulletevents:[
		['t',300,['v',mat_rot(vec3(-Math.PI/750,Math.PI/750,-Math.PI/750)),0]],
		['t',600,['v',mat_rot(vec3(-Math.PI/550,Math.PI/550,-Math.PI/550)),0,'se',3,0]],
		['t',900,['v',mat_rot(vec3(-Math.PI/375,Math.PI/375,-Math.PI/375)),0,'se',3,0]],
		['t',1800,['v',mat_rot(vec3(0,0,0)),0]],
		['t',3000,['v',mat_rot(vec3(-Math.PI/1500,Math.PI/1500,-Math.PI/1500)),0,'se',3,0]],
		['t',3600,['v',mat_rot(vec3(-Math.PI/900,Math.PI/900,-Math.PI/900)),0]],
		['t',3900,['v',mat_rot(vec3(-Math.PI/400,Math.PI/400,-Math.PI/400)),0,'se',3,0]]
		]},
		
		{vert:tm_2,motion:'mesh',meshrotate:vec3(Math.PI/800,Math.PI/800,-Math.PI/800),mesh:WEHOUGAME.getBullet(41),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],goback:[-0,-60],timeoffset:60,bulletevents:[
		['t',300-60,['v',mat_rot(vec3(Math.PI/750,Math.PI/750,-Math.PI/750)),0]],
		['t',600-60,['v',mat_rot(vec3(Math.PI/550,Math.PI/550,-Math.PI/550)),0]],
		['t',900-60,['v',mat_rot(vec3(Math.PI/375,Math.PI/375,-Math.PI/375)),0]],
		['t',1800-60,['v',mat_rot(vec3(0,0,0)),0]],
		['t',3000-60,['v',mat_rot(vec3(Math.PI/1500,Math.PI/1500,-Math.PI/1500)),0]],
		['t',3600-60,['v',mat_rot(vec3(Math.PI/900,Math.PI/900,-Math.PI/900)),0]],
		['t',3900-60,['v',mat_rot(vec3(Math.PI/400,Math.PI/400,-Math.PI/400)),0]]
		]},
		
		{vert:tm_3,motion:'mesh',meshrotate:vec3(-Math.PI/800,Math.PI/800,Math.PI/800),mesh:WEHOUGAME.getBullet(41),setrotate:vec3(0,0,0),period:50000,lifetime:50000,protect:true,locked:true,goback:[-0,-150],goback:[-0,-60],timeoffset:120,bulletevents:[
		['t',300-120,['v',mat_rot(vec3(-Math.PI/750,Math.PI/750,Math.PI/750)),0]],
		['t',600-120,['v',mat_rot(vec3(-Math.PI/550,Math.PI/550,Math.PI/550)),0]],
		['t',900-120,['v',mat_rot(vec3(-Math.PI/375,Math.PI/375,Math.PI/375)),0]],
		['t',1800-120,['v',mat_rot(vec3(0,0,0)),0]],
		['t',3000-120,['v',mat_rot(vec3(-Math.PI/1500,Math.PI/1500,Math.PI/1500)),0]],
		['t',3600-120,['v',mat_rot(vec3(-Math.PI/900,Math.PI/900,Math.PI/900)),0]],
		['t',3900-120,['v',mat_rot(vec3(-Math.PI/400,Math.PI/400,Math.PI/400)),0]]
		]},
		{mesh:WEHOUGAME.getBullet(42),speed:[0.0001],number:16,angleoffset:22.5/2,target:vec2(20000,1000),distance:600,protect:true,locked:true,type:'laser',period:50000,lifetime:50000}
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(-9999,-9999),vec2(0,0),
		0],
		[[0,1,2,3,4]]
	);
	story.adds({time:4200,group:[31],act:[0,'「格林尼治的天球仪」',7,[600000,0.8,-1],6,['Usami Renko',1,1,1],2,4200,4,[1,[1/2,2/2,1/2,0/2]],11,[1,vec3(100,-100,1.2)],3,vec3(0,0,0)],bt:true});
	
	story.add(//BOSS引导10符
		{mesh:WEHOUGAME.getBoss(1),delmesh:false},
		[
		],
		[0,vec2(-9998,-9998),vec2(0,0),
		100,vec2(0,100),vec2(0,0),
		0],
		[[]]
	);
	story.adds({time:100,group:[32],act:[0,'',4,[1,[1/2,2/2,2/2,1/2]],7,[0,0,-1]],bt:true});
	
	var make_roll=function(div,r){
		var g=[];
		for(w=-260;w<260;w+=div){
			var x=WEHOUCORE.a2a(vec2(0,r),2*Math.PI/32*w/div);
			g.push(vec3(x.x,x.y,w));
		}
		return g;
	}
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(3),20,20,3,'ball',1,[15/16,14/16,23/32,24/32]);//id=43 橙色铳弹
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),84,84,22,'ball',1,[1/4,0/4,0/8,1/8]);//id=44 蓝色光玉
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(0),84,84,22,'ball',1,[1/4,2/4,1/8,2/8]);//id=45 红色光玉
	story.add(//BOSS10符
		{mesh:WEHOUGAME.getBoss(1),hit:10000,player:'sp',delmesh:false,reload:[['h',7000,[[4,6,20,21]]],['h',4000,[[8,10,22,23]]],['h',1500,[[12,14,22,23]]],['t',6500,[[16,18,22,23]]]]},
		[
		//第一阶段
		{positionlock:false,position:vec2(0,270),target:vec2(20000,-1000),period:180,lifetime:450,bulletevents:[['t',1,['bb',[1,0],0]]],speed:[1.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(10,120),motion:'mesh',meshrotate:vec3(Math.PI/140,0,0),setrotate:vec3(0,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(33),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		{positionlock:false,position:vec2(0,250),target:vec2(20000,-1000),period:180,timeoffset:90,lifetime:450,bulletevents:[['t',1,['bb',[3,0],0]]],speed:[1.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(10,120),motion:'mesh',meshrotate:vec3(-Math.PI/140,0,0),setrotate:vec3(0,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(33),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		//
		{positionlock:false,position:vec2(0,270),target:vec2(20000,-1000),period:90,timeoffset:100,lifetime:450,bulletevents:[['t',1,['bb',[5,0],0]]],speed:[1.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(12,120),motion:'mesh',meshrotate:vec3(Math.PI/140,0,0),setrotate:vec3(0,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(43),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		{positionlock:false,position:vec2(0,250),target:vec2(20000,-1000),period:90,timeoffset:100,lifetime:450,bulletevents:[['t',1,['bb',[7,0],0]]],speed:[1.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(12,120),motion:'mesh',meshrotate:vec3(-Math.PI/140,0,0),setrotate:vec3(0,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(43),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		//
		{positionlock:false,position:vec2(0,270),target:vec2(20000,-1000),period:80,timeoffset:180,lifetime:300,bulletevents:[['t',1,['bb',[9,0],0]]],speed:[2.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(15,100),motion:'mesh',meshrotate:vec3(Math.PI/140,0,0),setrotate:vec3(Math.PI/1,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(38),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		{positionlock:false,position:vec2(0,250),target:vec2(20000,-1000),period:80,timeoffset:220,lifetime:300,bulletevents:[['t',1,['bb',[11,0],0]]],speed:[2.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(15,100),motion:'mesh',meshrotate:vec3(-Math.PI/140,0,0),setrotate:vec3(Math.PI/1,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(38),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		//
		{positionlock:false,position:vec2(0,270),target:vec2(20000,-1000),period:56,timeoffset:0,lifetime:300,bulletevents:[['t',1,['bb',[13,0],0]]],speed:[2.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(12,100),motion:'mesh',meshrotate:vec3(Math.PI/140,0,0),setrotate:vec3(Math.PI/1,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(24),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		{positionlock:false,position:vec2(0,250),target:vec2(20000,-1000),period:56,timeoffset:28,lifetime:300,bulletevents:[['t',1,['bb',[15,0],0]]],speed:[2.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(12,100),motion:'mesh',meshrotate:vec3(-Math.PI/140,0,0),setrotate:vec3(Math.PI/1,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(24),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		//爆发用
		{positionlock:false,position:vec2(0,270),target:vec2(20000,-1000),period:40,timeoffset:180,lifetime:300,bulletevents:[['t',1,['bb',[17,0],0]]],speed:[2.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(12,100),motion:'mesh',meshrotate:vec3(Math.PI/140,0,0),setrotate:vec3(Math.PI/1,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(24),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		{positionlock:false,position:vec2(0,250),target:vec2(20000,-1000),period:40,timeoffset:200,lifetime:300,bulletevents:[['t',1,['bb',[19,0],0]]],speed:[2.5],positionrandom:vec2(10,0),birthse:1},
		{vert:make_roll(12,100),motion:'mesh',meshrotate:vec3(-Math.PI/140,0,0),setrotate:vec3(Math.PI/1,Math.PI/2,0),setmove:vec3(0,0,0),mesh:WEHOUGAME.getBullet(24),period:50000,lifetime:50000,timeoffset:0,locked:true,bulletevents:[],diewithfather:true},
		//外面
		{positionlock:false,position:vec2(200,270),target:vec2(20000,-1000),period:30,speed:[1.5],lifetime:380,positionrandom:vec2(100,0),mesh:WEHOUGAME.getBullet(44)},
		{positionlock:false,position:vec2(-200,270),target:vec2(20000,-1000),period:30,speed:[1.5],lifetime:380,positionrandom:vec2(100,0),mesh:WEHOUGAME.getBullet(44)},
		{positionlock:false,position:vec2(200,270),target:vec2(20000,-1000),period:16,speed:[2.5],lifetime:230,positionrandom:vec2(100,0),mesh:WEHOUGAME.getBullet(45)},
		{positionlock:false,position:vec2(-200,270),target:vec2(20000,-1000),period:16,speed:[2.5],lifetime:230,positionrandom:vec2(100,0),mesh:WEHOUGAME.getBullet(45)}
		],
		[0,vec2(0,100),vec2(0,0),
		35000,vec2(0,100),vec2(0,0),
		0],
		[[0,2,20,21]]
	);
	story.adds({time:8000,group:[33],act:[0,'「弦论幻想乡」',7,[800000,0.7,-12],6,['Usami Renko',0,1,1],2,8000,10,[0,[1,0.7,0.4,0.15,0],99,1],11,[1,vec3(50,-100,1.2)]],circleclear:true});
	
	WEHOUGAME.addBullet(WEHOUGAME.getBulletImg(2),128,128,0,'ball',1,[8/16,9/16,15/16,1]);//46
	story.add(
		{mesh:WEHOUGAME.getBoss(1),delmesh:false},
		[{mesh:WEHOUGAME.getBullet(46),number:32,speed:[5],period:1000,rotating:2,speedrandom:5,birthse:8}],
		[0,vec2(-9998,-9998),vec2(0,0),
		14100,vec2(-9998,-9998),vec2(0,0),//
		0],
		[[0]]
	);
	story.adds({time:100,group:[34],act:[0,'',7,[0,0,-1]],bt:true});
	
	story.add(
		{mesh:WEHOUGAME.getBoss(0),delmesh:false},
		[],
		[0,vec2(-300,500),vec2(0,0),
		141,vec2(-80,120),vec2(0,0),//boss入场
		14100,vec2(-80,120),vec2(0,0),//
		0],
		[[],[]]
	);
	story.add(
		{mesh:WEHOUGAME.getBoss(1),delmesh:false},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		141,vec2(80,120),vec2(0,0),//boss入场
		14100,vec2(80,120),vec2(0,0),//
		0],
		[[],[]]
	);
	story.adds({time:1800,group:[36,35],act:[7,[0,0,-1],9,[[['早喵',0,70,0,300,380],['梅莉',1,385,0,300,380],['莲子',1,700,0,300,380],[]],
	[0,1,'莲子，你怎么这么慢啊？'],
	[300,2,'好好好，咱们这就走吧。'],
	[600,0,'那个...'],
	[900,2,'刚才真是战得痛快呢。<br>果然这是幻想乡。(满意~)'],
	[1200,1,'？？'],
	[1500,2,'好，我们走吧。']
	]],bt:true});
	
	story.add(
		{mesh:WEHOUGAME.getBoss(0)},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		141,vec2(-300,500),vec2(0,0),//boss入场
		14100,vec2(-9998,-9998),vec2(0,0),//
		0],
		[[],[]]
	);
	story.add(
		{mesh:WEHOUGAME.getBoss(1)},
		[],
		[0,vec2(-9998,-9998),vec2(0,0),
		141,vec2(-300,500),vec2(0,0),//boss入场
		14100,vec2(-9998,-9998),vec2(0,0),//
		0],
		[[],[]]
	);
	story.adds({time:900,group:[38,37],act:[7,[0,0,-1],9,[[['早喵',0,70,0,300,380],[]],
	[0,0,' = = |||'],
	[300,0,'这就走了...'],
	[600,0,'那...就当刚才什么都没发生过...吧？(笑)'],
	]],bt:true});
	
	story.adds({time:10,act:[7,[0,0,-1],9999,0]});
	story.p=26;
	//自机
	story.self.add([
		{mesh:WEHOUGAME.getBullet(0),speed:[20],period:3,target:vec2(20000,1000),position:vec2(9,18),lifetime:30,type:'self',damage:4,likelaser:true},
		{mesh:WEHOUGAME.getBullet(0),speed:[20],period:3,target:vec2(20000,1000),position:vec2(-9,18),lifetime:30,type:'self',damage:4,likelaser:true}
	]);
}
WEHOUGAME.intGame(document.getElementById("mygame"));
</script>
</html>
